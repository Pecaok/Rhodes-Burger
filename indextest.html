<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IndexTest • Rhodes Burgers</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{
      --primary:#625A45; --text:#111; --muted:#666; --bg:#f6f6f6; --card:#fff;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08); --ring:#eaeaea;
    }
    *{box-sizing:border-box;}
    html,body{margin:0;background:var(--bg);font-family:sans-serif;color:var(--text)}
    main{max-width:1000px;margin:auto;padding:1rem;}
    h1{font-size:1.5rem;text-align:center;margin-bottom:2rem;font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem}
    .card{
      background:var(--card);padding:1rem;border-radius:var(--radius);
      box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center;
    }
    .card img{width:100%;border-radius:12px;aspect-ratio:1.4;object-fit:cover;}
    .card h2{font-size:1rem;margin:.5rem 0 0;font-weight:600;text-align:center;}
    .card .price{color:var(--text);margin-bottom:.5rem;font-weight:500;}
    .card button{
      background:var(--primary);color:white;border:none;padding:.4rem 1rem;
      border-radius:var(--radius);cursor:pointer;font-weight:500;
    }

    #overlay{
      position:fixed;top:0;left:0;right:0;bottom:0;
      background:#0008;display:none;align-items:center;justify-content:center;
      z-index:1000;
    }
    #modal{
      background:white;padding:2rem;border-radius:var(--radius);
      max-width:400px;width:90%;
    }
    .row{display:flex;align-items:center;gap:1rem;margin:1rem 0}
    .row label{flex:1}
    .row input[type=number]{width:3rem;text-align:center;}
    .hidden{display:none}
  </style>
</head>
<body>
  <main>
    <h1>IndexTest • Rhodes Burgers</h1>
    <div class="grid" id="productGrid"></div>
  </main>

  <div id="overlay">
    <div id="modal">
      <h2 id="modTitle">Personalizar</h2>

      <div id="rowFries" class="row">
        <label>Papas:</label>
        <label><input type="radio" name="fries" value="sazonadas"> Sazonadas</label>
        <label><input type="radio" name="fries" value="con_sal"> Con sal</label>
        <label><input type="radio" name="fries" value="sin_sal"> Sin sal</label>
      </div>

      <div id="rowPatties" class="row">
        <label>Medallones extra:</label>
        <button id="patDec">-</button>
        <span id="patVal">0</span>
        <button id="patInc">+</button>
      </div>

      <div id="rowCheddar" class="row">
        <label>Cheddar extra:</label>
        <button id="cheDec">-</button>
        <span id="cheVal">0</span>
        <button id="cheInc">+</button>
      </div>

      <div class="row">
        <label style="flex:1">Notas:</label>
        <textarea id="notes" rows="2" style="width:100%" placeholder="Sin cebolla, etc"></textarea>
      </div>

      <div class="row">
        <button id="btnCancel">Cancelar</button>
        <button id="btnAdd">Agregar</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = { /* tu config Firebase */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const productGrid = document.getElementById("productGrid");

    const overlay = document.getElementById("overlay");
    const modTitle = document.getElementById("modTitle");

    const rowPatties = document.getElementById("rowPatties");
    const rowCheddar = document.getElementById("rowCheddar");
    const patVal = document.getElementById("patVal");
    const patInc = document.getElementById("patInc");
    const patDec = document.getElementById("patDec");
    const cheVal = document.getElementById("cheVal");
    const cheInc = document.getElementById("cheInc");
    const cheDec = document.getElementById("cheDec");
    const notes   = document.getElementById("notes");
    const btnCancel = document.getElementById("btnCancel");
    const btnAdd    = document.getElementById("btnAdd");

    function openCustomizer(item) {
      modTitle.textContent = `Personalizar: ${item.name}`;
      patVal.textContent = "0";
      cheVal.textContent = "0";
      notes.value = "";
      document.querySelectorAll("input[name='fries']").forEach(i=>i.checked=false);

      const kind = item.kind?.toLowerCase();
      if(kind === "double"){
        rowPatties.style.display = "flex";
        rowCheddar.style.display = "flex";
      } else if(kind === "chicken"){
        rowPatties.style.display = "none";
        rowCheddar.style.display = "flex";
      } else {
        rowPatties.style.display = "none";
        rowCheddar.style.display = "none";
      }

      overlay.style.display = "flex";
    }

    btnCancel.onclick = ()=> overlay.style.display = "none";

    const snapshot = await getDocs(collection(db, "products"));
    snapshot.forEach(doc => {
      const item = doc.data();
      if(!item.available) return;
      if(item.category !== "hamburguesas") return;

      const card = document.createElement("div");
      card.className = "card";

      if(item.img?.startsWith("data:image")){
        const img = document.createElement("img");
        img.src = item.img;
        card.appendChild(img);
      }

      const name = document.createElement("h2");
      name.textContent = item.name;
      card.appendChild(name);

      const price = document.createElement("div");
      price.className = "price";
      price.textContent = "$ " + (item.price || 0).toLocaleString("es-AR");
      card.appendChild(price);

      const btn = document.createElement("button");
      btn.textContent = "Agregar";
      btn.onclick = () => openCustomizer(item);
      card.appendChild(btn);

      productGrid.appendChild(card);
    });

    patInc.onclick = () => { let v = +patVal.textContent; if(v<2) patVal.textContent = v+1; };
    patDec.onclick = () => { let v = +patVal.textContent; if(v>0) patVal.textContent = v-1; };
    cheInc.onclick = () => { let v = +cheVal.textContent; if(v<3) cheVal.textContent = v+1; };
    cheDec.onclick = () => { let v = +cheVal.textContent; if(v>0) cheVal.textContent = v-1; };
  </script>
</body>
</html>
