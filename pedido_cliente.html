<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Confirmar Pedido - Rhodes</title>
</head>
<body>
  <h2>Tu pedido</h2>
  <div id="pedido-detalle"></div>
  <p id="total"></p>

  <input id="nombre" placeholder="Nombre y apellido"><br>
  <select id="metodo">
    <option value="efectivo">Efectivo</option>
    <option value="debito">DÃ©bito</option>
    <option value="mercado_pago">Mercado Pago</option>
  </select><br>
  <select id="entrega">
    <option value="take away">Take Away</option>
  </select><br>
  <textarea id="comentarios" placeholder="Comentarios"></textarea><br>
  <button id="confirmar">Confirmar Pedido</button>
  <p id="mensaje"></p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
      authDomain: "rhodes-burguers.firebaseapp.com",
      projectId: "rhodes-burguers",
      storageBucket: "rhodes-burguers.appspot.com",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e",
      measurementId: "G-LQVYTJWHSM"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const pedido = JSON.parse(localStorage.getItem("order") || "[]");
    const container = document.getElementById("pedido-detalle");
    let total = 0;
    pedido.forEach(p => {
      const div = document.createElement("div");
      div.textContent = `${p.quantity} x ${p.item} - $${p.quantity * p.price}`;
      total += p.quantity * p.price;
      container.appendChild(div);
    });
    document.getElementById("total").textContent = "Total: $" + total;

    document.getElementById("confirmar").addEventListener("click", async () => {
      const cliente = document.getElementById("nombre").value;
      const metodo = document.getElementById("metodo").value;
      const entrega = document.getElementById("entrega").value;
      const comentarios = document.getElementById("comentarios").value;
      const mensaje = document.getElementById("mensaje");

      if (!cliente || !pedido.length) {
        mensaje.textContent = "Faltan datos.";
        mensaje.style.color = "red";
        return;
      }

      await addDoc(collection(db, "pedidos"), {
        cliente,
        metodoPago: metodo,
        tipoEntrega: entrega,
        comentarios,
        pedido,
        fecha: new Date().toLocaleString(),
        timestamp: serverTimestamp()
      });

      localStorage.removeItem("order");
      mensaje.textContent = "Pedido confirmado";
      mensaje.style.color = "green";
    });
  </script>
</body>
</html>