<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Seguimiento de pedido â€¢ Rhodes Burgers</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{ --primary:#2ecc71; --text:#111; --muted:#666; --bg:#f6f6f6; --card:#fff;
           --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08); --ring:#eaeaea; }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
    header{position:sticky;top:0;z-index:10;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .topbar{max-width:900px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;text-decoration:none;color:inherit;font-weight:700}
    .brand img{width:32px;height:32px;border-radius:8px;background:#fff;object-fit:contain;margin-right:8px}
    main{max-width:900px;margin:24px auto;padding:0 12px;display:grid;gap:18px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    h1{font-size:24px;margin:6px 0 14px}
    .muted{color:var(--muted)}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--ring);font-weight:700}
    .row{display:flex;align-items:center;justify-content:space-between;margin:12px 0}
    .steps{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px}
    .step{padding:10px;border:1px dashed var(--ring);border-radius:12px;text-align:center;font-size:14px}
    .step.active{border-style:solid;border-color:var(--primary);box-shadow:0 0 0 3px rgba(46,204,113,.15)}
    .small{font-size:13px}
    .error{color:#b00020}
    .cta{display:inline-flex;align-items:center;gap:8px;border:2px solid var(--primary);background:var(--primary);color:#fff;padding:10px 16px;border-radius:999px;font-weight:700;text-decoration:none}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a class="brand" href="index.html"><img src="images/logo.png" alt="">Rhodes Burgers</a>
      <div style="flex:1"></div>
      <a class="cta" href="index.html">Volver al menÃº</a>
    </div>
  </header>

  <main>
    <section class="card" id="box">
      <h1>Seguimiento de tu pedido</h1>
      <div id="info" class="muted small">Cargandoâ€¦</div>

      <div class="row">
        <div id="badge" class="badge">Estado: â€”</div>
        <div id="num" class="muted">#â€”</div>
      </div>

      <div class="steps">
        <div class="step" id="st-pending_payment">Pago pendiente</div>
        <div class="step" id="st-accepted">Recibido</div>
        <div class="step" id="st-preparing">Preparando</div>
        <div class="step" id="st-ready_for_pickup">Listo para retirar</div>
        <div class="step" id="st-completed">Entregado</div>
      </div>

      <div style="margin-top:14px" class="small muted" id="time"></div>
    </section>

    <section class="card">
      <div class="small muted">
        Por tu privacidad, este link contiene un <strong>token Ãºnico</strong>. Guardalo para consultar el estado mÃ¡s tarde.
        Nadie puede listar los pedidos: solo ve este pedido quien tenga el link.
      </div>
    </section>
  </main>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // Config (igual que tu sitio)
    var firebaseConfig = {
      apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
      authDomain: "rhodes-burguers.firebaseapp.com",
      projectId: "rhodes-burguers",
      storageBucket: "rhodes-burguers.firebasestorage.app",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    var db = firebase.firestore();

    function $(s){ return document.querySelector(s); }
    function qs(name){
      const params = new URLSearchParams(location.search);
      return params.get(name) || "";
    }
    function fmt(ts){
      if(!ts) return "â€”";
      var d = ts.toDate();
      return d.toLocaleString("es-AR", { dateStyle:"medium", timeStyle:"short" });
    }
    function setActive(status){
      var ids = ["pending_payment","accepted","preparing","ready_for_pickup","completed"];
      ids.forEach(function(id){
        var el = $("#st-"+id);
        if(!el) return;
        if(id === status){ el.classList.add("active"); }
        else{ el.classList.remove("active"); }
      });
    }
    function statusLabel(s){
      return {
        pending_payment: "Pago pendiente",
        accepted: "Recibido",
        preparing: "Preparando",
        ready_for_pickup: "Listo para retirar",
        completed: "Entregado",
        cancelled: "Cancelado"
      }[s] || "â€”";
    }

    var token = qs("t");
    if(!token){
      $("#info").innerHTML = '<span class="error">Link invÃ¡lido: falta el token.</span>';
    }else{
      $("#info").textContent = "Conectando al pedidoâ€¦";
      // Escucha en tiempo real al documento pÃºblico:
      db.collection("order_public").doc(token).onSnapshot(function(snap){
        if(!snap.exists){
          $("#info").innerHTML = '<span class="error">No encontramos este pedido. VerificÃ¡ el link.</span>';
          return;
        }
        var d = snap.data();
        $("#info").innerHTML = "Hola <strong>"+(d.nombre||"Cliente")+"</strong> ðŸ‘‹";
        $("#badge").textContent = "Estado: "+statusLabel(d.status);
        $("#num").textContent   = "#"+(d.orderNumber||"â€”");
        $("#time").textContent  = "Ãšltima actualizaciÃ³n: "+fmt(d.updatedAt || d.createdAt);
        setActive(d.status);
      }, function(err){
        $("#info").innerHTML = '<span class="error">Error de conexiÃ³n: '+(err && err.message ? err.message : err)+'</span>';
      });
    }
  </script>
</body>
</html>
