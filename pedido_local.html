<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pedidos - Rhodes Burguers</title>
  <style>
    body{
      font-family: Arial, sans-serif; margin:0; padding-top:80px;
      background-image:url('background.jpg'); background-size: contain;
      background-repeat:no-repeat; background-position:center; background-attachment:fixed; background-color:#f0f0f0;
    }
    header{
      background:white; position:fixed; top:0; width:100%; padding:10px 24px;
      display:flex; justify-content:space-between; align-items:center; z-index:10;
      box-shadow:0 2px 5px rgba(0,0,0,.1);
    }
    header img{ height:50px; }
    header a{ background:#28a745; color:#fff; text-decoration:none; padding:8px 16px; border-radius:6px; font-weight:bold; }
    .total-dia{
      font-size: 20px; text-align:center; margin: 20px auto; font-weight:700;
      background:#fff; padding:12px; border-radius:10px; max-width:420px;
      box-shadow:0 2px 5px rgba(0,0,0,.2); border:2px solid #000;
    }
    .pedido{
      background:#fff; border-radius:10px; padding:16px; margin: 16px auto; max-width:720px;
      box-shadow:0 2px 5px rgba(0,0,0,.2); border:2px solid #000;
    }
    .pedido p{ margin:6px 0; }
    ul{ padding-left:20px; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
      authDomain: "rhodes-burguers.firebaseapp.com",
      projectId: "rhodes-burguers",
      storageBucket: "rhodes-burguers.appspot.com",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const contenedor = document.getElementById("contenedor-pedidos");
    const totalMesEl = document.getElementById("total-mes");
    let totalMes = 0;

    const pedidosRef = collection(db, "pedidos");
    const pedidosQuery = query(pedidosRef, orderBy("timestamp", "desc"));

    onSnapshot(pedidosQuery, (snapshot) => {
      contenedor.innerHTML = "";
      totalMes = 0;
      snapshot.forEach(doc => {
        const data = doc.data();
        const fecha = data.timestamp?.toDate ? data.timestamp.toDate() : new Date((data.timestamp?.seconds || 0) * 1000);
        const totalPedido = (data.pedido || []).reduce((acc, item) => acc + (item.price * item.quantity), 0);
        totalMes += totalPedido;

        const div = document.createElement("div");
        div.className = "pedido";
        div.innerHTML = `
          <p><strong>Cliente:</strong> ${data.nombre || "-"}</p>
          <p><strong>Fecha:</strong> ${fecha.toLocaleString()}</p>
          <p><strong>Método de pago:</strong> ${data.metodo || "-"}</p>
          <p><strong>Tipo de entrega:</strong> ${data.entrega || "-"}</p>
          <p><strong>Comentarios:</strong> ${data.comentarios || "-"}</p>
          <p><strong>Productos:</strong></p>
          <ul>
            ${(data.pedido || []).map(p => `<li>${p.quantity} x ${p.item} - $${p.price * p.quantity}</li>`).join('')}
          </ul>
          <p><strong>Total del pedido:</strong> $${totalPedido}</p>
        `;
        contenedor.appendChild(div);
      });
      totalMesEl.textContent = `Total acumulado del mes: $${totalMes}`;
    });
  </script>
</head>
<body>
  <header>
    <img src="logo.jpg" alt="Rhodes Burguers">
    <a href="index.html">Menú</a>
  </header>

  <div class="total-dia" id="total-mes">Total acumulado del mes: $0</div>
  <div id="contenedor-pedidos"></div>
</body>
</html>
