<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pedidos — Rhodes Burgers</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{
      --primary:#2ecc71;
      --text:#111;
      --muted:#666;
      --bg:#f6f6f6;
      --card:#fff;
      --radius:18px;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --ring:#eaeaea;
      --chip:#f1f1f1;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
    header{
      position:sticky;top:0;z-index:10;background:#fff;
      box-shadow:0 2px 12px rgba(0,0,0,.06)
    }
    .topbar{max-width:1100px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
    .brand img{width:40px;height:40px;border-radius:10px;background:#fff;object-fit:contain}
    .spacer{flex:1}
    .container{max-width:1100px;margin:24px auto;padding:0 12px}
    h1{font-size:34px;margin:14px 4px 18px}

    /* Cards de pedidos */
    .pedido-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin:12px 0}
    .pedido-card .header{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .pedido-card .title{font-weight:800;font-size:18px}
    .pedido-card .amount{font-weight:800}
    .pedido-card .sub{margin-top:4px}
    .muted{color:var(--muted)}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .chip{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border-radius:999px;padding:6px 10px;font-size:13px;color:#333}
    ul.items{margin:6px 0 0 20px}
    ul.items li{margin:6px 0}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="#" class="brand" aria-label="Rhodes Burgers">
        <img src="images/logo.png" alt="">
      </a>
      <div class="spacer"></div>
      <strong>Pedidos</strong>
    </div>
  </header>

  <main class="container">
    <h1>Pedidos</h1>
    <div id="listaPedidos"></div>
  </main>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // === Usa la misma config que en pedido_cliente (no tocar) ===
    const firebaseConfig = {
      apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
      authDomain: "rhodes-burguers.firebaseapp.com",
      projectId: "rhodes-burguers",
      storageBucket: "rhodes-burguers.firebasestorage.app",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const $ = s => document.querySelector(s);
    const money = n => (Number(n)||0).toLocaleString("es-AR", {style:"currency",currency:"ARS",maximumFractionDigits:0});

    // Render de cada pedido
    function renderPedido(id, o, cont){
      const nroTxt = (typeof o.nro === "number" && o.nro > 0) ? `#${o.nro}` : "#(s/n)";
      const nombre = o.nombre || "Cliente";
      const total  = money(o.total);
      const fecha  = o.createdAt?.toDate ? o.createdAt.toDate() : new Date();
      const fstr   = fecha.toLocaleString("es-AR");

      const chips = [];
      chips.push(`Retiro: ${o.entrega || "-"}`);
      if (o.telefono) chips.push(`Tel: ${o.telefono}`);
      chips.push(`Pago: ${o.pago || "-"}`);

      const lines = [];
      (o.items || []).forEach(it => {
        if (it.type === "burger") {
          const ex = [];
          if (it.extras?.patty)   ex.push(`+${it.extras.patty} medallón(es)`);
          if (it.extras?.cheddar) ex.push(`+${it.extras.cheddar} cheddar`);
          lines.push(`
            <li>
              <b>${it.qty}× ${it.name}</b>
              <div class="muted">Papas: ${it.fries==="con_sazon"?"Con sazón":"Sin sazonar"}${ex.length ? " — " + ex.join(" / ") : ""}</div>
              ${it.price ? `<div class="muted">Unit: ${money(it.price)} — Subtotal: ${money((Number(it.price)||0)*(Number(it.qty)||1))}</div>` : ""}
            </li>
          `);
        } else if (it.type === "drink") {
          lines.push(`<li><b>${it.qty}× ${it.name}</b>${it.price?` <span class="muted">— ${money(it.price)}</span>`:""}</li>`);
        } else {
          // fallback genérico
          const unit = Number(it.price)||0;
          const q    = Number(it.qty)||1;
          lines.push(`<li><b>${q}× ${it.name||"Item"}</b> ${unit?`<span class="muted">— ${money(unit)}</span>`:""}</li>`);
        }
      });

      const el = document.createElement("div");
      el.className = "pedido-card";
      el.innerHTML = `
        <div class="header">
          <div class="title">${nroTxt} — ${nombre}</div>
          <div class="amount">${total}</div>
        </div>
        <div class="sub muted">${fstr}</div>
        <div class="chips">
          ${chips.map(c => `<span class="chip">${c}</span>`).join("")}
        </div>
        <ul class="items">${lines.join("")}</ul>
      `;
      cont.appendChild(el);
    }

    // Suscripción en tiempo real
    db.collection("orders")
      .orderBy("createdAt", "desc")
      .onSnapshot((snap)=>{
        const cont = $("#listaPedidos");
        cont.innerHTML = "";
        snap.forEach(doc => renderPedido(doc.id, doc.data(), cont));
      });
  </script>
</body>
</html>
