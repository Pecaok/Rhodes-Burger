<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pedidos • Rhodes Burgers</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{
      --primary:#2ecc71; --text:#111; --muted:#666; --bg:#f6f6f6; --card:#fff;
      --radius:22px; --shadow:0 12px 34px rgba(0,0,0,.10); --ring:#eaeaea;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
    header{position:sticky; top:0; z-index:10; background:#fff; box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .topbar{max-width:1100px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;text-decoration:none;color:inherit;font-weight:700}
    .brand img{width:36px;height:36px;border-radius:10px;background:#fff;object-fit:contain;margin-right:8px}
    .container{max-width:1100px;margin:24px auto;padding:0 12px}
    h1{font-size:28px;margin:10px 0 18px}

    .order{background:var(--card);border-radius:18px;box-shadow:var(--shadow);padding:16px 18px;margin:14px 0}
    .order-head{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .order-title{font-weight:800}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .chip{background:#f3f3f3;border:1px solid var(--ring);color:#333;border-radius:999px;padding:6px 10px;font-size:13px}
    .muted{color:var(--muted)}
    .right-total{font-weight:800;font-size:18px;white-space:nowrap}
    .items{margin-top:10px}
    .item{margin:8px 0 6px 0}
    .item strong{font-weight:700}
    .item .sub{color:var(--muted);font-size:13px;margin-top:3px}
    .money{white-space:nowrap}
    .divider{height:1px;background:#efefef;margin:10px 0}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a class="brand" href="#">
        <img src="images/logo.png" alt="Rhodes Burgers">
        Pedidos
      </a>
      <div style="flex:1"></div>
    </div>
  </header>

  <main class="container">
    <h1>Últimos pedidos</h1>
    <div id="orders"></div>
  </main>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // === MISMA CONFIG QUE EL SITIO ===
    const firebaseConfig = {
      apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
      authDomain: "rhodes-burguers.firebaseapp.com",
      projectId: "rhodes-burguers",
      storageBucket: "rhodes-burguers.firebasestorage.app",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const $ = s => document.querySelector(s);
    const money = n => (Number(n)||0).toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});

    function unitWithExtras(item){
      const base = item.price || 0;
      const pz = (item.extras?.patty||0)   * (item.extras?.EXTRA_PRICE_PATTY||0);
      const ch = (item.extras?.cheddar||0) * (item.extras?.EXTRA_PRICE_CHEDDAR||0);
      return base + pz + ch;
    }

    function renderOrder(doc){
      const o = doc.data();
      const when = o.createdAt?.toDate ? o.createdAt.toDate() : null;
      const dt   = when
        ? when.toLocaleDateString('es-AR') + ', ' + when.toLocaleTimeString('es-AR')
        : '—';

      const items = Array.isArray(o.items) ? o.items : [];

      // Construyo líneas por ítem con papas y extras
      const lines = items.map(it=>{
        if(it.type === "burger"){
          const unit = unitWithExtras(it);
          const subtotal = unit * (it.qty||0);
          const friesTxt = it.fries==="con_sazon" ? "Con sazón" : (it.fries==="sin_sazon" ? "Sin sazonar" : "—");
          const extras = [];
          if(it.extras?.patty)   extras.push(`+${it.extras.patty} med`);
          if(it.extras?.cheddar) extras.push(`+${it.extras.cheddar} cheddar`);
          const notes = it.notes ? ` · Notas: ${it.notes}` : "";
          return `
            <div class="item">
              <div>• <strong>${it.qty||0}× ${it.name}</strong></div>
              <div class="sub">
                Papas: ${friesTxt}${extras.length?` · ${extras.join(" · ")}`:""}${notes}
                <div>Unit: <span class="money">${money(unit)}</span> — Subtotal: <span class="money">${money(subtotal)}</span></div>
              </div>
            </div>`;
        }else{
          const subtotal = (it.price||0) * (it.qty||0);
          return `
            <div class="item">
              <div>• <strong>${it.qty||0}× ${it.name}</strong></div>
              <div class="sub">Unit: <span class="money">${money(it.price||0)}</span> — Subtotal: <span class="money">${money(subtotal)}</span></div>
            </div>`;
        }
      }).join("");

      const telChip = o.telefono ? `<span class="chip">Tel: ${o.telefono}</span>` : "";

      return `
        <div class="order">
          <div class="order-head">
            <div>
              <div class="order-title">#${o.orderNumber ?? '—'} — ${o.nombre ?? 'Cliente'}</div>
              <div class="muted">${dt}</div>
              <div class="chips">
                <span class="chip">Retiro: ${o.entrega||'—'}</span>
                ${telChip}
                <span class="chip">Pago: ${o.pago||'—'}</span>
              </div>
            </div>
            <div class="right-total">${money(o.total||0)}</div>
          </div>
          <div class="divider"></div>
          <div class="items">
            ${lines || '<div class="muted">Sin ítems.</div>'}
          </div>
        </div>`;
    }

    function mount(){
      const host = $("#orders");
      db.collection("orders").orderBy("createdAt","desc").limit(100)
        .onSnapshot(snap=>{
          host.innerHTML = snap.empty
            ? '<p class="muted">No hay pedidos.</p>'
            : snap.docs.map(renderOrder).join("");
        });
    }
    mount();
  </script>
</body>
</html>
