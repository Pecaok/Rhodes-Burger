<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mostrador • Rhodes Burgers</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{
      --primary:#625A45; --text:#111; --muted:#666; --bg:#f5f5f5; --card:#fff;
      --ring:#e8e8e8; --shadow:0 10px 30px rgba(0,0,0,.08); --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
    header{position:sticky;top:0;z-index:20;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .topbar{max-width:1200px;margin:0 auto;padding:10px 14px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit;font-weight:800}
    .brand img{width:36px;height:36px;border-radius:10px;object-fit:contain}

    .layout{max-width:1200px;margin:20px auto;padding:0 14px;display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media (max-width:1024px){ .layout{grid-template-columns:1fr} .cart{position:static} }

    h1{font-size:26px;margin:0 0 10px}
    h2{font-size:20px;margin:18px 0 10px}

    /* Menú en 2 columnas (pares) */
    .menu-grid{display:grid;grid-template-columns:repeat(2, minmax(250px, 1fr));gap:16px}
    @media (max-width:640px){ .menu-grid{grid-template-columns:1fr} }

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;aspect-ratio:16/10;object-fit:cover;background:#f0f0f0}
    .card .body{padding:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .price{font-weight:800}
    .actions{display:flex;gap:8px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:9px 12px;border-radius:999px;border:1px solid var(--ring);background:#fff;cursor:pointer;font-weight:700;color:#333;text-decoration:none}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn.ghost{background:#fff;border-color:#e7e7e7}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    /* Carrito */
    .cart{position:sticky;top:84px;background:var(--card);border-radius:20px;box-shadow:var(--shadow);padding:14px}
    .cart h3{margin:0 0 8px}
    .cart .total{display:flex;align-items:center;justify-content:space-between;font-weight:800;margin:6px 0 10px}
    .item{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;padding:10px 0;border-bottom:1px solid #eee}
    .muted{color:var(--muted);font-size:13px}
    input,select,textarea{width:100%;padding:10px;border:1px solid var(--ring);border-radius:12px;font:inherit}
    textarea{min-height:70px}

    /* Modal */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.25);display:none;align-items:center;justify-content:center;z-index:40}
    .overlay.open{display:flex}
    .modal{background:#fff;border-radius:20px;box-shadow:var(--shadow);width:560px;max-width:92vw;padding:16px}
    .modal h4{margin:0 0 10px}
    .rowx{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:10px 0}
    .qtybox{display:inline-flex;align-items:center;gap:10px;border:1px solid var(--ring);border-radius:999px;padding:6px 10px}
    .qtybox button{width:28px;height:28px;border:1px solid #e5e5e5;background:#fff;border-radius:999px;font-weight:900;cursor:pointer}

    /* Radios con botón a la derecha */
    .choice{display:flex;gap:10px;flex-wrap:wrap}
    .choice label{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--ring);border-radius:999px;padding:8px 12px;cursor:pointer}
    .choice label span{order:1}
    .choice label input[type=radio]{order:2; accent-color:var(--primary)}

    .footer-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a class="brand" href="#">
        <img src="images/logo.png" alt="Rhodes Burgers">
        Rhodes Burgers
      </a>
      <div style="margin-left:auto;font-weight:800">Mostrador</div>
    </div>
  </header>

  <main class="layout">
    <section>
      <h1>Menú</h1>

      <h2>Hamburguesas</h2>
      <div id="burgersGrid" class="menu-grid"></div>

      <h2 style="margin-top:20px">Bebidas</h2>
      <div id="drinksGrid" class="menu-grid"></div>
    </section>

    <aside class="cart" id="cartBox">
      <h3>Carrito</h3>
      <div class="total"><span>Total</span><span id="cartTotal">$0</span></div>

      <div id="cartItems"></div>

      <div style="margin-top:10px;display:grid;gap:8px">
        <input id="cliName" type="text" placeholder="Nombre (requerido)" />
        <input id="cliPhone" type="tel" placeholder="Teléfono (opcional)" />
        <select id="cliPay">
          <option value="efectivo">Efectivo</option>
          <option value="mercado_pago">Mercado Pago</option>
          <option value="debito">Débito</option>
          <option value="credito">Crédito</option>
          <option value="transferencia">Transferencia</option>
        </select>
        <textarea id="cliNotes" placeholder="Comentario"></textarea>
        <button id="btnPay" class="btn primary">Pagar</button>
        <div id="formErr" class="muted" style="color:#b00020;display:none"></div>
        <div id="formOk" class="muted" style="color:#2e7d32;display:none"></div>
      </div>
    </aside>
  </main>

  <!-- Modal Personalizar -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h4 id="modTitle">Personalizar</h4>

      <div class="rowx">
        <div class="muted">Cantidad</div>
        <div class="qtybox">
          <button id="qtyDec">-</button>
          <span id="qtyVal">1</span>
          <button id="qtyInc">+</button>
        </div>
      </div>

      <div class="rowx" style="align-items:flex-start;flex-direction:column">
        <div class="muted" style="font-weight:700">Papas (obligatorio)</div>
        <div class="choice">
          <label><span>Con sazón</span><input type="radio" name="fries" value="con_sazon"></label>
          <label><span>Sin sazonar</span><input type="radio" name="fries" value="sin_sazon"></label>
        </div>
        <div class="muted">Se aplica a cada hamburguesa de esta línea.</div>
      </div>

      <div class="rowx" id="rowPatties" style="display:none">
        <div>Medallones extra</div>
        <div class="qtybox">
          <button id="patDec">-</button>
          <span id="patVal">0</span>
          <button id="patInc">+</button>
        </div>
      </div>

      <div class="rowx" id="rowCheddar" style="display:none">
        <div>Fetas de cheddar extra</div>
        <div class="qtybox">
          <button id="cheDec">-</button>
          <span id="cheVal">0</span>
          <button id="cheInc">+</button>
        </div>
      </div>

      <div class="rowx" style="align-items:flex-start;flex-direction:column">
        <label>Notas (opcional)</label>
        <textarea id="notes" placeholder="Sin cebolla, extra salsa, etc."></textarea>
      </div>

      <div class="footer-actions">
        <button class="btn ghost" id="btnCancel">Cancelar</button>
        <button class="btn primary" id="btnAdd">Agregar</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
  // ===== Config Firebase =====
  const firebaseConfig = {
    apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
    authDomain: "rhodes-burguers.firebaseapp.com",
    projectId: "rhodes-burguers",
    storageBucket: "rhodes-burguers.firebasestorage.app",
    messagingSenderId: "951646688091",
    appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
  };
  try{ firebase.initializeApp(firebaseConfig); }catch(e){}
  const db = firebase.firestore();

  // ===== Catálogo =====
  const EXTRA_PRICE_PATTY=1600, EXTRA_PRICE_CHEDDAR=300;
  const BURGERS = [
    { id:"bigjohn_simple", name:"Big John Simple", price:10900, img:"images/Big John Simple.jpg", kind:"simple" },
    { id:"bigjohn_doble",  name:"Big John Doble",  price:13900, img:"images/Big John Doble.jpg",  kind:"double" },

    { id:"burguesa_simple", name:"Burguesa Simple", price:11900, img:"images/Burguesa Simple.jpg", kind:"simple" },
    { id:"burguesa_doble",  name:"Burguesa Doble",  price:14900, img:"images/Burguesa Doble.jpg",  kind:"double" },

    { id:"cheesebacon_spl", name:"CheeseBacon Simple", price:10500, img:"images/CheeseBacon Simple.jpg", kind:"simple" },
    { id:"cheesebacon_dbl", name:"CheeseBacon Doble",  price:13500, img:"images/CheeseBacon Doble.jpg",  kind:"double" },

    { id:"cheese_simple", name:"Cheeseburger Simple", price:9500, img:"images/cheeseburger simple.jpg", kind:"simple" },
    { id:"cheese_doble",  name:"Cheeseburger Doble",  price:12500, img:"images/cheeseburger doble.jpg",  kind:"double" },

    { id:"rhodes_simple", name:"Rhodes Simple", price:11900, img:"images/Rhodes Simple.jpg", kind:"simple" },
    { id:"rhodes_doble",  name:"Rhodes Doble",  price:14900, img:"images/Rhodes Doble.jpg",  kind:"double" },

    { id:"morgan_simple", name:"Morgan Simple", price:10900, img:"images/Morgan Simple.jpg", kind:"simple" },
    { id:"morgan_doble",  name:"Morgan Doble",  price:14500, img:"images/Morgan Doble.jpg",  kind:"double" },

    { id:"pollo_crispy", name:"Pollo Crispy", price:8900, img:"images/Pollo crispy.jpg", kind:"chicken" }
  ];

  const DRINKS = [
    { id:"andes_rubia",   name:"Andes Origen Rubia 473ml", price:4200, img:"images/Andes Rubia.png" },
    { id:"andes_roja",    name:"Andes Origen Roja 473ml",  price:4200, img:"images/Andes Roja.png"  },
    { id:"agua_sg",       name:"Agua sin gas 500ml",       price:2200, img:"images/Agua.png"        },
    { id:"aquarius_pomelo", name:"Aquarius Pomelo 500ml",  price:3000, img:"images/Pomelo.png"      },
    { id:"aquarius_pera",   name:"Aquarius Pera 500ml",    price:3000, img:"images/Pera.png"        },
    { id:"aquarius_manzana",name:"Aquarius Manzana 500ml", price:3000, img:"images/Manzana.png"     },
    { id:"sprite",        name:"Sprite 500ml",             price:3000, img:"images/Sprite.png"      },
    { id:"coca_org",      name:"Coca-Cola Original 500ml", price:3000, img:"images/Coca.png"        },
    { id:"coca_zero",     name:"Coca-Cola Zero 500ml",     price:3000, img:"images/Coca Zero.png"   }
  ];

  const FALLBACK_IMG="images/logo.png";
  const $ = s=>document.querySelector(s);
  const money = n => (Number(n)||0).toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});

  // ===== Carrito =====
  let cart = { burger:{}, drink:{} };

  function cartCount(){
    let n=0;
    for(const b of Object.values(cart.burger)) n+=b.qty;
    for(const d of Object.values(cart.drink))  n+=d.qty;
    return n;
  }
  function calcTotal(){
    let t=0;
    for(const b of Object.values(cart.burger)){
      const base=b.item.price;
      const ep=(b.extras?.patty||0)*(b.extras?.EXTRA_PRICE_PATTY||EXTRA_PRICE_PATTY);
      const ec=(b.extras?.cheddar||0)*(b.extras?.EXTRA_PRICE_CHEDDAR||EXTRA_PRICE_CHEDDAR);
      t+=(base+ep+ec)*(b.qty||0);
    }
    for(const d of Object.values(cart.drink)) t+=(d.item.price||0)*(d.qty||0);
    return t;
  }
  function renderCart(){
    const host=$("#cartItems"); host.innerHTML="";
    for(const b of Object.values(cart.burger)){
      const extras=[];
      if(b.extras?.patty)   extras.push(`+${b.extras.patty} medallón(es)`);
      if(b.extras?.cheddar) extras.push(`+${b.extras.cheddar} cheddar`);
      const unit = b.item.price + (b.extras?.patty||0)*EXTRA_PRICE_PATTY + (b.extras?.cheddar||0)*EXTRA_PRICE_CHEDDAR;
      host.insertAdjacentHTML('beforeend', `
        <div class="item">
          <div>
            <strong>${b.item.name}</strong>
            <div class="muted">Papas: ${b.fries==="con_sazon"?"Con sazón":"Sin sazonar"}</div>
            ${extras.length?`<div class="muted">${extras.join(" · ")}</div>`:""}
            ${b.notes?`<div class="muted">Notas: ${b.notes}</div>`:""}
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <button class="btn ghost" onclick="changeQty('burger','${b.item.id}',-1)">-</button>
            <span>${b.qty}</span>
            <button class="btn ghost" onclick="changeQty('burger','${b.item.id}',1)">+</button>
            <span>${money(unit*b.qty)}</span>
          </div>
        </div>
      `);
    }
    for(const d of Object.values(cart.drink)){
      host.insertAdjacentHTML('beforeend', `
        <div class="item">
          <div><strong>${d.item.name}</strong></div>
          <div style="display:flex;align-items:center;gap:8px">
            <button class="btn ghost" onclick="changeQty('drink','${d.item.id}',-1)">-</button>
            <span>${d.qty}</span>
            <button class="btn ghost" onclick="changeQty('drink','${d.item.id}',1)">+</button>
            <span>${money(d.item.price*d.qty)}</span>
          </div>
        </div>
      `);
    }
    $("#cartTotal").textContent = money(calcTotal());
  }
  window.changeQty=function(type,id,delta){
    const bucket=cart[type]; if(!bucket) return;
    const cur=bucket[id]?.qty||0, next=Math.max(0,cur+delta);
    if(next===0) delete bucket[id]; else bucket[id].qty=next;
    renderCart();
  }

  // ===== Render cards =====
  function renderCard(item,type){
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`
      <img src="${item.img}" alt="${item.name}" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'">
      <div class="body">
        <div style="font-weight:800">${item.name}</div>
        <div class="row" style="margin-top:6px">
          <span class="price">${money(item.price)}</span>
          <div class="actions">
            <button class="btn" data-add>Agregar</button>
            ${type==="burger" ? '<button class="btn" data-custom>Personalizar</button>' : ''}
          </div>
        </div>
      </div>`;
    const addBtn=div.querySelector("[data-add]");
    const customBtn=div.querySelector("[data-custom]");
    if(type==="drink"){
      addBtn.onclick=()=>{ const bucket=cart.drink; if(!bucket[item.id]) bucket[item.id]={qty:0,item}; bucket[item.id].qty+=1; renderCart(); };
    }else{
      addBtn.onclick = ()=> openCustomize(item);
      if(customBtn) customBtn.onclick = ()=> openCustomize(item);
    }
    return div;
  }
  function mountMenu(){
    const bg=$("#burgersGrid"), dg=$("#drinksGrid");
    bg.innerHTML=""; BURGERS.forEach(b=>bg.appendChild(renderCard(b,"burger")));
    dg.innerHTML=""; DRINKS.forEach(d=>dg.appendChild(renderCard(d,"drink")));
    renderCart();
  }

  // ===== Modal personalize =====
  const overlay=$("#overlay"), modTitle=$("#modTitle");
  const qtyVal=$("#qtyVal"), qtyInc=$("#qtyInc"), qtyDec=$("#qtyDec");
  const rowPatties=$("#rowPatties"), rowCheddar=$("#rowCheddar");
  const patVal=$("#patVal"), patInc=$("#patInc"), patDec=$("#patDec");
  const cheVal=$("#cheVal"), cheInc=$("#cheInc"), cheDec=$("#cheDec");
  const notes=$("#notes"), btnAdd=$("#btnAdd"), btnCancel=$("#btnCancel");
  let currentItem=null;

  qtyInc.onclick=()=> qtyVal.textContent=String(Math.min(99,(+qtyVal.textContent||1)+1));
  qtyDec.onclick=()=> qtyVal.textContent=String(Math.max(1,(+qtyVal.textContent||1)-1));
  patInc.onclick=()=>{ const v=+patVal.textContent||0; if(v<2) patVal.textContent=v+1; };
  patDec.onclick=()=>{ const v=+patVal.textContent||0; if(v>0) patVal.textContent=v-1; };
  cheInc.onclick=()=>{ const v=+cheVal.textContent||0; if(v<3) cheVal.textContent=v+1; };
  cheDec.onclick=()=>{ const v=+cheVal.textContent||0; if(v>0) cheVal.textContent=v-1; };
  btnCancel.onclick=()=> overlay.classList.remove('open');

  function resetFries(){ document.querySelectorAll('input[name="fries"]').forEach(r=>r.checked=false); }

  function openCustomize(item){
    currentItem=item; modTitle.textContent="Personalizar: "+item.name;
    qtyVal.textContent="1"; notes.value=""; patVal.textContent="0"; cheVal.textContent="0"; resetFries();
    if(item.kind==="double"){ rowPatties.style.display="flex"; rowCheddar.style.display="flex"; }
    else if(item.kind==="chicken"){ rowPatties.style.display="none"; rowCheddar.style.display="flex"; }
    else { rowPatties.style.display="none"; rowCheddar.style.display="none"; }
    overlay.classList.add('open');
  }

  btnAdd.onclick=()=>{
    const friesEl=document.querySelector('input[name="fries"]:checked');
    if(!friesEl){ alert("Elegí el tipo de papas para esta hamburguesa."); return; }
    const qty=+qtyVal.textContent||1;
    const extras={patty:0,cheddar:0,EXTRA_PRICE_PATTY:EXTRA_PRICE_PATTY,EXTRA_PRICE_CHEDDAR:EXTRA_PRICE_CHEDDAR};
    if(currentItem.kind==="double"){ extras.patty=+patVal.textContent||0; extras.cheddar=+cheVal.textContent||0; }
    else if(currentItem.kind==="chicken"){ extras.cheddar=+cheVal.textContent||0; }

    const txt = (notes.value||"").trim();
    const bucket = cart.burger;
    const prev = bucket[currentItem.id];
    if(prev){
      prev.qty += qty;
      prev.extras = { patty: Math.max(prev.extras?.patty||0, extras.patty),
                      cheddar: Math.max(prev.extras?.cheddar||0, extras.cheddar),
                      EXTRA_PRICE_PATTY, EXTRA_PRICE_CHEDDAR };
      prev.fries = friesEl.value;
      if(txt) prev.notes = txt;
    }else{
      bucket[currentItem.id] = { qty, item: currentItem, fries: friesEl.value, extras, ...(txt?{notes:txt}:{}) };
    }
    renderCart();
    overlay.classList.remove('open');
  };

  // ===== Pagar (guardar en Firestore) =====
  $("#btnPay").onclick = async ()=>{
    $("#formErr").style.display='none'; $("#formOk").style.display='none';
    const name = ($("#cliName").value||"").trim();
    const phone= ($("#cliPhone").value||"").trim();
    const pay  = $("#cliPay").value;
    const cmt  = ($("#cliNotes").value||"").trim();

    if(!name){ $("#formErr").textContent="Ingresá el nombre del cliente."; $("#formErr").style.display='block'; return; }
    if(cartCount()===0){ $("#formErr").textContent="Agregá productos al carrito."; $("#formErr").style.display='block'; return; }

    const items=[];
    for(const b of Object.values(cart.burger)){
      items.push({
        type:"burger", id:b.item.id, name:b.item.name, qty:b.qty, price:b.item.price,
        fries:b.fries, extras:b.extras, ...(b.notes?{notes:b.notes}:{})
      });
    }
    for(const d of Object.values(cart.drink)){
      items.push({ type:"drink", id:d.item.id, name:d.item.name, qty:d.qty, price:d.item.price });
    }

    const total = calcTotal();
    const payload = {
      orderNumber:null,
      nombre: name + " (Mostrador)",
      telefono: phone,
      pago: pay,
      paid: false,
      payment_status: "pending_payment",
      notes: cmt,
      status: "accepted",
      entrega: "take_away",
      items,
      total,
      source: "mostrador",
      createdAt: new Date()
    };

    try{
      await db.collection("orders").add(payload);
      $("#formOk").textContent="Pedido guardado correctamente.";
      $("#formOk").style.display='block';
      cart={burger:{},drink:{}}; renderCart();
      $("#cliName").value=""; $("#cliPhone").value=""; $("#cliNotes").value="";
    }catch(e){
      console.error(e);
      $("#formErr").textContent="No se pudo guardar el pedido.";
      $("#formErr").style.display='block';
    }
  };

  // Init
  document.addEventListener('DOMContentLoaded', mountMenu);
  </script>
</body>
</html>
