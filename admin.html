<!doctype html>
<html lang="es">

<!-- ============================================================
      SESIÓN COMPARTIDA (igual que login.html)
=============================================================== -->
<script>
const TTL_HOURS = 20;
const TTL_MS = TTL_HOURS * 60 * 60 * 1000;

function sessionValid(){
  const ok = localStorage.getItem('rb_admin_ok') === 'true';
  const ts = Number(localStorage.getItem('rb_admin_t') || 0);
  return ok && (Date.now() - ts) < TTL_MS;
}
function bumpSession(){
  if (sessionValid()) localStorage.setItem('rb_admin_t', String(Date.now()));
}
function logout(){
  localStorage.removeItem('rb_admin_ok');
  localStorage.removeItem('rb_admin_t');
  localStorage.removeItem('rb_auth_v2');
  sessionStorage.removeItem('rb_auth_v2');
  location.replace('login.html');
}
(function requireSession(){
  if (!sessionValid()){
    const next = encodeURIComponent(
      (location.pathname.replace(/^\//,'') || 'pedido_local.html') +
      (location.search || '') + (location.hash || '')
    );
    location.replace('login.html?next=' + next);
  } else bumpSession();
})();
['click','keydown','focus','mousemove','touchstart','scroll']
  .forEach(e => window.addEventListener(e, bumpSession, {passive:true}));
</script>

<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin • Rhodes Burgers</title>
<link rel="icon" href="images/logo.png" />

<style>
:root{
  --primary:#625A45; --text:#111; --muted:#666; --bg:#f6f6f6;
  --card:#fff; --ring:#eaeaea; --shadow:0 10px 28px rgba(0,0,0,.08);
  --good:#2e7d32; --warn:#fb8c00; --bad:#d32f2f; --radius:18px;
}
*{box-sizing:border-box}
html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;
}

header{
  position:sticky;
  top:0;
  z-index:20;
  background:#fff;
  box-shadow:0 2px 12px rgba(0,0,0,.06);
}
.topbar{
  max-width:1200px;
  margin:0 auto;
  padding:10px 12px;
  display:flex;
  align-items:center;
  gap:12px;
}
.brand{
  display:flex;
  align-items:center;
  font-weight:800;
  color:inherit;
  text-decoration:none;
}
.brand img{
  width:36px;height:36px;
  border-radius:10px;
  margin-right:8px;
  object-fit:contain;
  background:#fff;
}
.spacer{flex:1}

.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
}
.card.featured{
  border:2px solid var(--primary);
  background:#fff8f0;
  padding:22px;
}

.btn{
  display:inline-flex;
  gap:8px;
  padding:8px 12px;
  border-radius:12px;
  border:1.5px solid var(--ring);
  background:#fff;
  cursor:pointer;
  font-weight:700;
}
.btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
.btn.good{background:#e9f6eb;border-color:#cfead3}
.btn.warn{background:#fff6e8;border-color:#ffe1b8}
.btn.bad{background:#fff1f1;border-color:#ffd7d7}

.img-preview{
  width:80px;height:80px;
  object-fit:cover;
  border-radius:12px;
  border:1px solid #ddd;
  background:#fafafa;
}

table{width:100%;border-collapse:separate;border-spacing:0 8px}
td,th{padding:10px 12px;background:#fff;text-align:left}
th{
  color:#555;
  font-size:13px;
  background:#fafafa;
  border-bottom:1px solid #eee;
}
</style>
</head>

<body>

<header>
  <div class="topbar">
    <a class="brand" href="#"><img src="images/logo.png">Rhodes Burgers • Admin</a>
    <div class="spacer"></div>

    <div class="store-controls" id="storeControls">
      <div style="display:flex;flex-direction:column">
        <div id="storePill" class="pill off">Estado: —</div>
        <div class="small" id="storeSub" style="margin-top:4px">—</div>
      </div>

      <div style="min-width:220px;display:flex;gap:8px;align-items:center">
        <button class="btn good" id="btnForceOpen">Forzar abierto</button>
        <button class="btn bad" id="btnForceClose">Desactivar</button>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <input id="forceUntil" type="datetime-local" style="width:220px"/>
        <button class="btn primary" id="btnSaveUntil">Guardar</button>
      </div>
    </div>

    <div style="margin-left:12px">
      <a class="btn" href="index.html">Ir al Menú</a>
      <button class="btn" onclick="logout()">Salir</button>
    </div>
  </div>
</header>

<main>
<section class="card featured">
  <h2 style="margin-bottom:6px">Gestión del Menú (CRUD + Orden Visual)</h2>
  <p class="muted" style="margin-bottom:14px">
    Agregá, editá, eliminá, ocultá del menú y ordená visualmente los productos.
  </p>

  <!-- FORMULARIO CRUD -->
  <div class="form-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:14px;">
    <div>
      <label><strong>ID (único)</strong></label>
      <input id="prdId" type="text" placeholder="Ej: bigjohn_simple">
    </div>

    <div>
      <label><strong>Nombre</strong></label>
      <input id="prdName" type="text" placeholder="Nombre del producto">
    </div>

    <div>
      <label><strong>Categoría</strong></label>
      <select id="prdCategory">
        <option value="hamburguesas">Hamburguesas</option>
        <option value="bebidas">Bebidas</option>
        <option value="guarniciones">Guarniciones</option>
      </select>
    </div>

    <div>
      <label><strong>Precio</strong></label>
      <input id="prdPrice" type="number" placeholder="Ej: 4800">
    </div>

    <div>
      <label><strong>Imagen (URL o archivo)</strong></label>
      <input id="prdImg" type="text" placeholder="https://...">
      <input id="prdImgFile" type="file" accept="image/*" style="margin-top:8px">
    </div>

    <div style="grid-column:1/-1">
      <label><strong>Descripción</strong></label>
      <textarea id="prdDesc" rows="3" placeholder="Descripción corta…"></textarea>
    </div>
  </div>

  <div class="row" style="margin-top:14px">
    <button class="btn primary" id="btnSaveProduct">Guardar / Actualizar</button>
    <button class="btn bad" id="btnClearProduct">Limpiar Formulario</button>
  </div>

  <div style="height:1px;background:#ddd;margin:18px 0"></div>

  <h3>Lista de productos</h3>

  <div style="overflow:auto">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>IMG</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th>Precio</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="prdTable"></tbody>
    </table>
  </div>
</section>
