<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Rhodes Burgers - Las Mejores Hamburguesas de Escobar</title>
  <link rel="icon" href="images/logo.png" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#625A45" />
  <meta name="description" content="Las mejores hamburguesas de Escobar. Ped√≠ online y disfruta.">

  <link rel="preconnect" href="https://firebasestorage.googleapis.com">
  <link rel="preconnect" href="https://firestore.googleapis.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#625A45',
            secondary: '#D4A574',
            dark: '#1a1a1a',
            light: '#faf9f7'
          },
          fontFamily: {
            display: ['Playfair Display', 'serif'],
            sans: ['Poppins', 'sans-serif']
          },
          animation: {
            'fade-in': 'fadeIn 0.6s ease-out forwards',
            'slide-up': 'slideUp 0.6s ease-out forwards',
            'slide-down': 'slideDown 0.4s ease-out forwards',
            'scale-in': 'scaleIn 0.5s ease-out forwards',
            'bounce-slow': 'bounce 2s infinite',
            'shimmer': 'shimmer 2s infinite linear',
            'float': 'float 3s ease-in-out infinite',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            slideUp: {
              '0%': { transform: 'translateY(30px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            slideDown: {
              '0%': { transform: 'translateY(-20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            scaleIn: {
              '0%': { transform: 'scale(0.9)', opacity: '0' },
              '100%': { transform: 'scale(1)', opacity: '1' }
            },
            shimmer: {
              '0%': { backgroundPosition: '-1000px 0' },
              '100%': { backgroundPosition: '1000px 0' }
            },
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-10px)' }
            }
          }
        }
      }
    }
  </script>
   
  <style>
    * { box-sizing: border-box; }
    
    body { 
      margin: 0; 
      background: linear-gradient(135deg, #faf9f7 0%, #f5f3f0 100%);
      color: #1a1a1a; 
      font-family: 'Poppins', sans-serif; 
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
    }

    /* HERO ANIMATED BACKGROUND */
    .hero-bg {
      position: relative;
      background: linear-gradient(135deg, #625A45 0%, #4a4333 100%);
      overflow: hidden;
    }
    
    .hero-bg::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(212, 165, 116, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(212, 165, 116, 0.15) 0%, transparent 50%);
      animation: float 8s ease-in-out infinite;
    }

    /* GLASSMORPHISM HEADER */
    .glass-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(98, 90, 69, 0.1);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
    }

    /* PREMIUM CARD STYLES */
    .product-card {
      position: relative;
      background: white;
      border-radius: 24px;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      cursor: pointer;
    }

    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(212, 165, 116, 0) 0%, rgba(212, 165, 116, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.4s ease;
      z-index: 1;
    }

    .product-card:hover {
      transform: translateY(-12px) scale(1.02);
      box-shadow: 0 20px 40px rgba(98, 90, 69, 0.2);
    }

    .product-card:hover::before {
      opacity: 1;
    }

    .product-card .card-image {
      position: relative;
      overflow: hidden;
      height: 240px;
    }

    .product-card .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .product-card:hover .card-image img {
      transform: scale(1.15) rotate(2deg);
    }

    /* SHINE EFFECT */
    .shine-effect {
      position: relative;
      overflow: hidden;
    }

    .shine-effect::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.4), 
        transparent);
      transition: left 0.6s ease;
    }

    .product-card:hover .shine-effect::after {
      left: 200%;
    }

    /* ANIMATED GRADIENT TEXT */
    .gradient-text {
      background: linear-gradient(135deg, #625A45 0%, #D4A574 50%, #625A45 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradient-shift 3s ease infinite;
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* STATUS BADGE WITH PULSE */
    .status-badge {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .status-badge.open::before {
      content: '';
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse-ring 2s ease-out infinite;
    }

    @keyframes pulse-ring {
      0% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
      }
    }

    /* FLOATING ANIMATION FOR ADD BUTTON */
    .btn-floating {
      animation: float 2s ease-in-out infinite;
    }

    /* CART BADGE BOUNCE */
    .cart-badge {
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    /* MODAL ANIMATIONS */
    .modal-backdrop {
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
      animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* DRAWER SLIDE */
    .drawer {
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .drawer.open {
      transform: translateX(0);
    }

    /* SKELETON SHIMMER */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    /* SECTION REVEAL ON SCROLL */
    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s ease-out;
    }

    .reveal.active {
      opacity: 1;
      transform: translateY(0);
    }

    /* PREMIUM SCROLLBAR */
    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #f5f3f0;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #625A45 0%, #D4A574 100%);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #4a4333 0%, #625A45 100%);
    }

    /* PRICE ANIMATION */
    .price-tag {
      position: relative;
      display: inline-block;
    }

    .price-tag::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #625A45, #D4A574);
      transition: width 0.4s ease;
    }

    .product-card:hover .price-tag::before {
      width: 100%;
    }

    /* STAGGER ANIMATION */
    .stagger-item {
      opacity: 0;
      transform: translateY(20px);
      animation: slideUp 0.6s ease-out forwards;
    }

    .stagger-item:nth-child(1) { animation-delay: 0.1s; }
    .stagger-item:nth-child(2) { animation-delay: 0.2s; }
    .stagger-item:nth-child(3) { animation-delay: 0.3s; }
    .stagger-item:nth-child(4) { animation-delay: 0.4s; }
    .stagger-item:nth-child(5) { animation-delay: 0.5s; }
    .stagger-item:nth-child(6) { animation-delay: 0.6s; }

    /* BUTTON RIPPLE EFFECT */
    .btn-ripple {
      position: relative;
      overflow: hidden;
    }

    .btn-ripple::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-ripple:active::after {
      width: 300px;
      height: 300px;
    }

    /* LOADING SPINNER */
    .spinner {
      border: 3px solid rgba(98, 90, 69, 0.1);
      border-top-color: #625A45;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>

  <script>
    const CACHE_KEY = "rhodes_data_v7"; 
    const CART_KEY = "rhodes_cart_v6";
    const PHONE_NUMBER = "543484346113"; 
    
    window.STATE = {
        products: [], 
        menuOrder: {}, 
        config: { 
          sides: { con_sazon:true, con_sal:true, sin_sal:true }, 
          store: { forceOpen: null, maintenance: {} }, 
          prices: { patty:2800, cheddar:300 } 
        },
        cart: { items: [] }, 
        isOpen: false
    };
    window.MODAL = { item: null, extras: { patty:0, cheddar:0 } };

    // RENDER PRODUCTS WITH ANIMATIONS
    window.fastRender = function() {
        const container = document.getElementById("menuContainer");
        if(!container || window.STATE.products.length === 0) return;

        let html = '';
        const sortList = (list, catName) => {
            const orderList = window.STATE.menuOrder[catName] || [];
            const orderMap = new Map(orderList.map((id, i) => [id, i]));
            return list.sort((a, b) => {
                const idxA = orderMap.has(a.id) ? orderMap.get(a.id) : 9999;
                const idxB = orderMap.has(b.id) ? orderMap.get(b.id) : 9999;
                return idxA - idxB;
            });
        };

        const burgers = sortList(window.STATE.products.filter(p => p.category === 'hamburguesas'), 'hamburguesas');
        const sides = sortList(window.STATE.products.filter(p => p.category === 'guarniciones'), 'guarniciones');
        const drinks = sortList(window.STATE.products.filter(p => p.category === 'bebidas'), 'bebidas');

        const renderSection = (title, list, emoji) => {
            if(!list.length) return '';
            const cards = list.map((p, idx) => `
                <div class="product-card stagger-item" onclick="openModal('${p.id}')" data-soldout="${!p.available}" style="animation-delay: ${idx * 0.1}s">
                    ${p.available===false ? '<div style="position:absolute;top:16px;right:16px;background:rgba(0,0,0,0.9);color:white;font-size:11px;font-weight:700;padding:8px 16px;border-radius:20px;z-index:10;text-transform:uppercase;letter-spacing:1px;backdrop-filter:blur(10px);">Agotado</div>' : ''}
                    <div class="card-image shine-effect">
                        <img src="${p.img || 'images/logo.png'}" loading="lazy" alt="${p.name}" style="opacity:0;transition:opacity 0.5s ease;" onload="this.style.opacity=1">
                        <div style="position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top, rgba(0,0,0,0.7), transparent);padding:20px;z-index:2;">
                            <div style="color:white;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1px;opacity:0.9;">${p.category}</div>
                        </div>
                    </div>
                    <div style="padding:24px;">
                        <h3 style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:#1a1a1a;margin:0 0 12px;line-height:1.3;">${p.name}</h3>
                        <p style="font-size:14px;color:#666;margin:0 0 20px;line-height:1.6;min-height:42px;">${p.description || ''}</p>
                        <div style="display:flex;align-items:center;justify-content:space-between;padding-top:16px;border-top:1px solid #f0f0f0;">
                            <span class="price-tag" style="font-family:'Playfair Display',serif;font-size:26px;font-weight:700;color:#625A45;">$${p.price}</span>
                            <button class="btn-floating" style="background:linear-gradient(135deg,#625A45 0%,#D4A574 100%);color:white;border:none;width:52px;height:52px;border-radius:50%;font-size:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 20px rgba(98,90,69,0.3);transition:all 0.3s ease;border:3px solid white;">+</button>
                        </div>
                    </div>
                </div>
            `).join('');
            return `
                <div class="reveal" style="margin-bottom:80px;">
                    <div style="text-align:center;margin-bottom:48px;">
                        <div style="font-size:48px;margin-bottom:16px;animation:float 3s ease-in-out infinite;">${emoji}</div>
                        <h2 class="gradient-text" style="font-family:'Playfair Display',serif;font-size:48px;font-weight:900;margin:0;letter-spacing:-1px;">${title}</h2>
                        <div style="width:80px;height:4px;background:linear-gradient(90deg,#625A45,#D4A574);margin:20px auto;border-radius:2px;"></div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:32px;">
                        ${cards}
                    </div>
                </div>
            `;
        };

        html += renderSection('Hamburguesas', burgers, 'üçî');
        html += renderSection('Guarniciones', sides, 'üçü');
        html += renderSection('Bebidas', drinks, 'ü•§');
        container.innerHTML = html;
        
        // Trigger reveal animations
        setTimeout(() => {
            document.querySelectorAll('.reveal').forEach(el => el.classList.add('active'));
        }, 100);
        
        checkStatus();
    };

    window.checkStatus = function() {
        const conf = window.STATE.config.store;
        const now = new Date();
        const blocker = document.getElementById("storeBlocker");
        
        if (conf.maintenance?.active) {
            blocker.classList.remove("hidden");
            document.getElementById("blockerTitle").innerText = conf.maintenance.title || "EN MANTENIMIENTO";
            document.getElementById("blockerMsg").innerText = conf.maintenance.message || "Volvemos pronto.";
            return;
        } else {
            blocker.classList.add("hidden");
        }

        let isOpen = false; let label = "CERRADO";
        if (conf.forceOpen === true) { isOpen = true; label = "ABIERTO"; } 
        else if (conf.forceOpen === false) { isOpen = false; label = "CERRADO"; } 
        else {
            const HOURS = { 0: [[19,0,24,0]], 1: [], 2: [], 3: [[19,0,24,0]], 4: [[19,0,24,0]], 5: [[19,0,24,0]], 6: [[19,0,24,0]] };
            const day = now.getDay();
            const min = now.getHours() * 60 + now.getMinutes();
            const todayHours = HOURS[day] || [];
            for(let slot of todayHours) {
                if(min >= (slot[0]*60 + slot[1]) && min < (slot[2]*60 + slot[3])) {
                    isOpen = true; label = `ABIERTO hasta ${slot[2]}:${String(slot[3]).padStart(2,'0')}`; break;
                }
            }
        }
        window.STATE.isOpen = isOpen;
        const pill = document.getElementById("statusPill");
        if(pill) {
            pill.className = `status-badge ${isOpen ? 'open' : ''}`;
            pill.innerHTML = `
                <span style="font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:${isOpen ? '#10b981' : '#ef4444'};">
                    ${isOpen ? 'ABIERTO' : 'CERRADO'}
                </span>
                <span style="font-size:11px;color:#666;font-weight:500;">
                    ${isOpen ? label.replace('ABIERTO ', '') : '19:00 - 00:00'}
                </span>
            `;
        }
    };
  </script>
</head>
<body>

  <!-- STORE BLOCKER -->
  <div id="storeBlocker" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);z-index:99999;color:white;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px;backdrop-filter:blur(20px);">
    <div style="font-size:80px;margin-bottom:32px;animation:bounce-slow 2s infinite;">üîí</div>
    <h2 id="blockerTitle" class="animate-fade-in" style="color:white;margin:0;font-size:42px;font-family:'Playfair Display',serif;font-weight:900;letter-spacing:-1px;">LOCAL CERRADO</h2>
    <p id="blockerMsg" class="animate-slide-up" style="color:#ccc;margin-top:20px;font-size:18px;line-height:1.8;max-width:400px;">Volvemos pronto con las mejores hamburguesas.</p>
  </div>

  <!-- HEADER -->
  <header class="glass-header" style="position:sticky;top:0;z-index:1000;animation:slideDown 0.6s ease-out;">
    <div style="max-width:1400px;margin:0 auto;padding:20px 32px;display:flex;align-items:center;gap:24px;">
      <a href="index.html" style="display:flex;align-items:center;text-decoration:none;transition:transform 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        <img src="images/logo.png" alt="Rhodes Burgers" style="width:56px;height:56px;border-radius:16px;margin-right:16px;box-shadow:0 4px 12px rgba(0,0,0,0.1);" />
        <div>
          <div style="font-family:'Playfair Display',serif;font-size:28px;font-weight:900;color:#625A45;line-height:1;letter-spacing:-1px;">Rhodes</div>
          <div style="font-size:11px;color:#999;text-transform:uppercase;letter-spacing:2px;margin-top:2px;">Burgers</div>
        </div>
      </a>
      <div style="flex:1;"></div>
      <div id="statusPill" class="status-badge" style="padding:12px 20px;background:#f5f5f5;border-radius:24px;display:flex;flex-direction:column;align-items:center;gap:4px;min-width:140px;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
        <span style="font-size:13px;font-weight:700;">...</span>
      </div>
      <button onclick="toggleDrawer(true)" style="position:relative;background:linear-gradient(135deg,#625A45 0%,#D4A574 100%);color:white;border:none;width:56px;height:56px;border-radius:16px;font-size:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 20px rgba(98,90,69,0.3);transition:all 0.3s ease;" onmouseover="this.style.transform='scale(1.1) rotate(5deg)'" onmouseout="this.style.transform='scale(1) rotate(0)'">
        üõí
        <span id="cartBubble" class="cart-badge" style="position:absolute;top:-8px;right:-8px;background:#ef4444;color:white;font-size:13px;font-weight:800;padding:4px 10px;border-radius:20px;display:none;box-shadow:0 4px 12px rgba(239,68,68,0.4);border:3px solid white;font-family:'Poppins',sans-serif;">0</span>
      </button>
    </div>
  </header>

  <!-- HERO SECTION -->
  <section class="hero-bg" style="padding:80px 32px;text-align:center;position:relative;z-index:1;">
    <div style="max-width:900px;margin:0 auto;">
      <div class="animate-scale-in" style="display:inline-block;background:rgba(212,165,116,0.2);color:#D4A574;padding:12px 24px;border-radius:30px;font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:2px;margin-bottom:32px;backdrop-filter:blur(10px);border:1px solid rgba(212,165,116,0.3);">
        üèÜ Las Mejores de Escobar
      </div>
      <h1 class="animate-fade-in" style="font-family:'Playfair Display',serif;font-size:72px;font-weight:900;color:white;margin:0 0 24px;line-height:1.1;letter-spacing:-2px;text-shadow:0 4px 20px rgba(0,0,0,0.2);">
        Hamburguesas<br/>Premium
      </h1>
      <p class="animate-slide-up" style="font-size:20px;color:rgba(255,255,255,0.9);margin:0 0 48px;line-height:1.8;font-weight:300;">
        Ingredientes frescos, sabor incomparable.<br/>Ped√≠ online y disfrut√° en casa.
      </p>
      <button onclick="document.getElementById('menuContainer').scrollIntoView({behavior:'smooth'})" class="btn-ripple" style="background:white;color:#625A45;border:none;padding:18px 48px;border-radius:30px;font-size:16px;font-weight:700;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,0.2);transition:all 0.3s ease;text-transform:uppercase;letter-spacing:1px;" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 32px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 8px 24px rgba(0,0,0,0.2)'">
        Ver Men√∫ üçî
      </button>
    </div>
  </section>

  <!-- MAIN CONTENT -->
  <main style="max-width:1400px;margin:0 auto;padding:80px 32px 120px;">
    <div id="errorMsg" style="display:none;background:linear-gradient(135deg,#fee2e2,#fecaca);color:#b91c1c;padding:24px;border-radius:20px;text-align:center;margin-bottom:40px;font-weight:600;box-shadow:0 4px 20px rgba(239,68,68,0.2);border:2px solid #fca5a5;animation:slideDown 0.4s ease-out;">
      ‚ö†Ô∏è La conexi√≥n es lenta. <a href="#" onclick="location.reload()" style="color:inherit;text-decoration:underline;font-weight:700;">Toc√° ac√° para reintentar</a>
    </div>
    
    <div id="menuContainer">
      <!-- SKELETON LOADERS -->
      <div style="text-align:center;margin-bottom:48px;">
        <div class="skeleton" style="width:80px;height:80px;border-radius:50%;margin:0 auto 24px;"></div>
        <div class="skeleton" style="width:300px;height:48px;border-radius:12px;margin:0 auto 16px;"></div>
        <div class="skeleton" style="width:80px;height:4px;border-radius:2px;margin:0 auto;"></div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:32px;">
        <div class="skeleton" style="height:400px;border-radius:24px;"></div>
        <div class="skeleton" style="height:400px;border-radius:24px;"></div>
        <div class="skeleton" style="height:400px;border-radius:24px;"></div>
      </div>
    </div>
  </main>

  <!-- CACHED DATA LOADER -->
  <script>
    (function() {
        try {
            const cached = localStorage.getItem(CACHE_KEY);
            if (cached && cached !== "undefined") {
                const parsed = JSON.parse(cached);
                window.STATE.products = parsed.products || [];
                window.STATE.menuOrder = parsed.menuOrder || {};
                if(parsed.config) window.STATE.config = { ...window.STATE.config, ...parsed.config };
                window.fastRender();
            }
        } catch (e) { console.error('Cache error:', e); }
    })();
  </script>

  <!-- CART DRAWER -->
  <aside class="drawer" style="position:fixed;top:0;right:0;width:100%;max-width:480px;height:100%;background:white;box-shadow:-20px 0 60px rgba(0,0,0,0.2);z-index:2000;display:flex;flex-direction:column;transform:translateX(100%);">
    <div style="background:linear-gradient(135deg,#625A45 0%,#4a4333 100%);padding:32px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div style="font-family:'Playfair Display',serif;font-size:28px;font-weight:900;color:white;margin-bottom:4px;">Tu Pedido</div>
        <div style="font-size:13px;color:rgba(255,255,255,0.7);text-transform:uppercase;letter-spacing:1px;">Revis√° antes de confirmar</div>
      </div>
      <button onclick="toggleDrawer(false)" style="background:rgba(255,255,255,0.1);border:none;width:48px;height:48px;border-radius:12px;font-size:28px;color:white;cursor:pointer;backdrop-filter:blur(10px);transition:all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)';this.style.transform='rotate(90deg)'" onmouseout="this.style.background='rgba(255,255,255,0.1)';this.style.transform='rotate(0)'">
        √ó
      </button>
    </div>
    <div id="cartItems" style="flex:1;overflow-y:auto;padding:32px;background:#faf9f7;"></div>
    <div style="padding:32px;background:white;border-top:2px solid #f0f0f0;box-shadow:0 -4px 20px rgba(0,0,0,0.05);">
      <div id="cartTotal" style="font-family:'Playfair Display',serif;font-size:36px;font-weight:900;color:#625A45;text-align:right;margin-bottom:24px;">Total: $0</div>
      <button id="btnCheckout" class="btn-ripple" style="width:100%;background:linear-gradient(135deg,#625A45 0%,#D4A574 100%);color:white;border:none;padding:20px;border-radius:16px;font-size:16px;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;box-shadow:0 8px 24px rgba(98,90,69,0.3);transition:all 0.3s ease;margin-bottom:12px;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 12px 32px rgba(98,90,69,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 8px 24px rgba(98,90,69,0.3)'">
        Confirmar Pedido üöÄ
      </button>
      <button onclick="emptyCart()" style="width:100%;background:transparent;color:#999;border:2px solid #e0e0e0;padding:16px;border-radius:16px;font-size:14px;font-weight:600;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all 0.3s ease;" onmouseover="this.style.borderColor='#625A45';this.style.color='#625A45'" onmouseout="this.style.borderColor='#e0e0e0';this.style.color='#999'">
        Vaciar Carrito
      </button>
    </div>
  </aside>

  <!-- MODAL -->
  <div id="modalOverlay" class="modal-backdrop" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:3000;padding:20px;">
    <div class="modal-content" style="width:100%;max-width:580px;background:white;border-radius:32px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,0.3);max-height:90vh;overflow-y:auto;">
      <h3 id="modTitle" style="font-family:'Playfair Display',serif;font-size:32px;font-weight:900;color:#1a1a1a;margin:0 0 32px;letter-spacing:-1px;"></h3>
      
      <div id="friesSection" style="margin-bottom:32px;">
        <label style="display:block;font-size:12px;font-weight:700;color:#999;text-transform:uppercase;letter-spacing:2px;margin-bottom:16px;">Guarnici√≥n</label>
        <div id="friesOptions" style="display:flex;gap:12px;flex-wrap:wrap;"></div>
      </div>

      <div id="extrasSection" style="margin-bottom:32px;">
        <label style="display:block;font-size:12px;font-weight:700;color:#999;text-transform:uppercase;letter-spacing:2px;margin-bottom:16px;">Extras</label>
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div style="display:flex;justify-content:space-between;align-items:center;padding:20px;background:#faf9f7;border-radius:20px;border:2px solid #f0f0f0;transition:all 0.3s ease;" onmouseover="this.style.borderColor='#D4A574'" onmouseout="this.style.borderColor='#f0f0f0'">
            <span style="font-size:16px;font-weight:600;color:#1a1a1a;">Extra Carne <b id="pricePattyDisplay" style="color:#625A45;font-family:'Playfair Display',serif;"></b></span>
            <div style="display:flex;align-items:center;gap:16px;background:white;padding:8px 16px;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
              <button onclick="updExtra('patty', -1)" style="background:#f0f0f0;border:none;width:36px;height:36px;border-radius:50%;font-size:20px;font-weight:800;color:#666;cursor:pointer;transition:all 0.2s ease;" onmouseover="this.style.background='#e0e0e0';this.style.transform='scale(1.1)'" onmouseout="this.style.background='#f0f0f0';this.style.transform='scale(1)'">‚àí</button>
              <span id="qtyPatty" style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:#625A45;min-width:24px;text-align:center;">0</span>
              <button onclick="updExtra('patty', 1)" style="background:linear-gradient(135deg,#625A45,#D4A574);border:none;width:36px;height:36px;border-radius:50%;font-size:20px;font-weight:800;color:white;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(98,90,69,0.2);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">+</button>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;padding:20px;background:#faf9f7;border-radius:20px;border:2px solid #f0f0f0;transition:all 0.3s ease;" onmouseover="this.style.borderColor='#D4A574'" onmouseout="this.style.borderColor='#f0f0f0'">
            <span style="font-size:16px;font-weight:600;color:#1a1a1a;">Extra Cheddar <b id="priceCheddarDisplay" style="color:#625A45;font-family:'Playfair Display',serif;"></b></span>
            <div style="display:flex;align-items:center;gap:16px;background:white;padding:8px 16px;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
              <button onclick="updExtra('cheddar', -1)" style="background:#f0f0f0;border:none;width:36px;height:36px;border-radius:50%;font-size:20px;font-weight:800;color:#666;cursor:pointer;transition:all 0.2s ease;" onmouseover="this.style.background='#e0e0e0';this.style.transform='scale(1.1)'" onmouseout="this.style.background='#f0f0f0';this.style.transform='scale(1)'">‚àí</button>
              <span id="qtyCheddar" style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:#625A45;min-width:24px;text-align:center;">0</span>
              <button onclick="updExtra('cheddar', 1)" style="background:linear-gradient(135deg,#625A45,#D4A574);border:none;width:36px;height:36px;border-radius:50%;font-size:20px;font-weight:800;color:white;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(98,90,69,0.2);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">+</button>
            </div>
          </div>
        </div>
      </div>

      <textarea id="modNotes" rows="3" placeholder="Notas especiales (Ej: Sin cebolla)" style="width:100%;border:2px solid #f0f0f0;border-radius:20px;padding:20px;font-family:inherit;font-size:15px;background:#faf9f7;transition:all 0.3s ease;resize:none;" onfocus="this.style.borderColor='#625A45';this.style.background='white'" onblur="this.style.borderColor='#f0f0f0';this.style.background='#faf9f7'"></textarea>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:32px;padding-top:32px;border-top:2px solid #f0f0f0;gap:24px;">
        <div id="modTotal" style="font-family:'Playfair Display',serif;font-size:40px;font-weight:900;color:#625A45;letter-spacing:-1px;">$0</div>
        <button id="btnAddCart" class="btn-ripple" style="background:linear-gradient(135deg,#625A45,#D4A574);color:white;border:none;padding:18px 40px;border-radius:20px;font-size:16px;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px;box-shadow:0 8px 24px rgba(98,90,69,0.3);transition:all 0.3s ease;white-space:nowrap;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 12px 32px rgba(98,90,69,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 8px 24px rgba(98,90,69,0.3)'">
          Agregar al Carrito
        </button>
      </div>
    </div>
  </div>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>

  <!-- MAIN SCRIPTS -->
  <script defer>
    let db;

    document.addEventListener("DOMContentLoaded", () => {
        const savedCart = localStorage.getItem(CART_KEY);
        if(savedCart) { 
          window.STATE.cart = JSON.parse(savedCart); 
          updateCartUI(); 
        }

        setTimeout(() => {
            if(window.STATE.products.length === 0) {
                document.getElementById('errorMsg').style.display = 'block';
            }
        }, 6000);

        const checkFirebase = setInterval(() => {
            if (window.firebase) {
                clearInterval(checkFirebase);
                initFirebase();
            }
        }, 100);
    });

    function saveToCache() {
        localStorage.setItem(CACHE_KEY, JSON.stringify({
            products: window.STATE.products,
            menuOrder: window.STATE.menuOrder,
            config: window.STATE.config,
            timestamp: Date.now()
        }));
    }

    function initFirebase() {
        const firebaseConfig = {
          apiKey:"AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
          authDomain:"rhodes-burguers.firebaseapp.com",
          projectId:"rhodes-burguers",
          storageBucket:"rhodes-burguers.firebasestorage.app",
          messagingSenderId:"951646688091",
          appId:"1:951646688091:web:05db5fadb4150d1fa9c07e"
        };
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        
        db.settings({
            experimentalForceLongPolling: true, 
            experimentalAutoDetectLongPolling: false
        });

        db.enablePersistence({synchronizeTabs:true}).catch(err => {});

        db.collection("products").onSnapshot(snap => {
            window.STATE.products = [];
            snap.forEach(doc => {
                const d = doc.data();
                if(d.available !== false) window.STATE.products.push({ id: doc.id, ...d });
            });
            document.getElementById('errorMsg').style.display = 'none';
            window.fastRender(); 
            saveToCache();
        }, err => console.log("Offline mode: ", err));

        db.collection("config").doc("store").onSnapshot(doc => {
            window.STATE.config.store = doc.data() || {};
            window.checkStatus(); 
            saveToCache();
        });

        db.collection("config").doc("sides").onSnapshot(doc => {
            const d = doc.data() || {};
            window.STATE.config.sides = { 
              con_sazon: d.con_sazon!==false, 
              con_sal: d.con_sal!==false, 
              sin_sal: d.sin_sal!==false 
            };
            saveToCache();
            window.fastRender();
        }, err => console.log("Error sides:", err));

        db.collection("config").doc("menuOrder").onSnapshot(doc => {
            window.STATE.menuOrder = doc.exists ? doc.data() : {};
            window.fastRender(); 
            saveToCache();
        }, err => console.log("Error menuOrder:", err));

        db.collection("config").doc("prices").onSnapshot(doc => {
            const d = doc.data() || {};
            window.STATE.config.prices = { 
              patty: Number(d.patty)||2800, 
              cheddar: Number(d.cheddar)||300 
            };
            saveToCache();
            
            if (window.MODAL && window.MODAL.item) {
                const pricePattyEl = document.getElementById("pricePattyDisplay");
                const priceCheddarEl = document.getElementById("priceCheddarDisplay");
                if(pricePattyEl) pricePattyEl.innerText = `($${window.STATE.config.prices.patty})`;
                if(priceCheddarEl) priceCheddarEl.innerText = `($${window.STATE.config.prices.cheddar})`;
                updateModalPrice();
            }
        }, err => console.log("Error prices:", err));
    }

    // MODAL FUNCTIONS
    window.openModal = (id) => {
        if (!window.STATE.isOpen && !window.STATE.config.store.forceOpen) { 
          alert("El local est√° cerrado en este momento."); 
          return; 
        }
        
        const item = window.STATE.products.find(p => p.id === id); 
        if(!item) return;
        
        window.MODAL.item = item; 
        window.MODAL.extras = { patty:0, cheddar:0 };
        
        document.getElementById("modTitle").innerText = item.name;
        document.getElementById("modNotes").value = "";
        
        const prices = window.STATE.config.prices;
        document.getElementById("pricePattyDisplay").innerText = `($${prices.patty})`;
        document.getElementById("priceCheddarDisplay").innerText = `($${prices.cheddar})`;
        document.getElementById("qtyPatty").innerText = "0";
        document.getElementById("qtyCheddar").innerText = "0";

        const isBurger = item.category === 'hamburguesas';
        document.getElementById("extrasSection").style.display = isBurger ? 'block' : 'none';
        
        const friesContainer = document.getElementById("friesOptions");
        const friesSection = document.getElementById("friesSection");
        friesContainer.innerHTML = '';
        
        const sidesMap = { 
          con_sazon: "üå∂Ô∏è Sazonadas", 
          con_sal: "üßÇ Con Sal", 
          sin_sal: "‚ú® Sin Sal" 
        };
        let firstFound = false;

        if (item.category === 'bebidas') {
            friesSection.style.display = 'none';
        } else {
            friesSection.style.display = 'block';
            for (const [key, label] of Object.entries(sidesMap)) {
                if (window.STATE.config.sides[key]) {
                    const checked = !firstFound ? 'checked' : ''; 
                    firstFound = true;
                    friesContainer.innerHTML += `
                      <label style="padding:16px 24px;background:${checked ? 'linear-gradient(135deg,#625A45,#D4A574)' : '#faf9f7'};color:${checked ? 'white' : '#666'};border:2px solid ${checked ? '#625A45' : '#f0f0f0'};border-radius:16px;font-size:15px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.3s ease;" onmouseover="if(!this.querySelector('input').checked) {this.style.borderColor='#D4A574';this.style.background='#f5f3f0'}" onmouseout="if(!this.querySelector('input').checked) {this.style.borderColor='#f0f0f0';this.style.background='#faf9f7'}">
                        <input type="radio" name="fries" value="${key}" ${checked} style="accent-color:#625A45;width:20px;height:20px;cursor:pointer;" onchange="this.closest('div').querySelectorAll('label').forEach(l => {const inp = l.querySelector('input'); if(inp.checked) {l.style.background='linear-gradient(135deg,#625A45,#D4A574)'; l.style.color='white'; l.style.borderColor='#625A45';} else {l.style.background='#faf9f7'; l.style.color='#666'; l.style.borderColor='#f0f0f0';}})">
                        ${label}
                      </label>
                    `;
                }
            }
        }
        
        updateModalPrice();
        document.getElementById("modalOverlay").style.display = 'flex';
    }

    window.updExtra = (type, delta) => {
        const newVal = window.MODAL.extras[type] + delta;
        if (newVal >= 0 && newVal <= 3) {
            window.MODAL.extras[type] = newVal;
            document.getElementById(type === 'patty' ? "qtyPatty" : "qtyCheddar").innerText = newVal;
            updateModalPrice();
        }
    }

    function updateModalPrice() {
        let total = Number(window.MODAL.item.price);
        const prices = window.STATE.config.prices;
        total += (window.MODAL.extras.patty * prices.patty);
        total += (window.MODAL.extras.cheddar * prices.cheddar);
        document.getElementById("modTotal").innerText = "$" + total;
    }

    document.getElementById("btnAddCart").onclick = () => {
        const item = window.MODAL.item;
        const notes = document.getElementById("modNotes").value.trim();
        let fries = "";
        
        if (item.category !== 'bebidas') {
            const friesInput = document.querySelector('input[name="fries"]:checked');
            if(!friesInput) { 
              alert("Por favor selecciona un tipo de papas"); 
              return; 
            }
            fries = friesInput.value;
        }
        
        const prices = window.STATE.config.prices;
        const finalPrice = Number(item.price) + 
                          (window.MODAL.extras.patty * prices.patty) + 
                          (window.MODAL.extras.cheddar * prices.cheddar);
        
        const cartItem = {
            id: item.id, 
            name: item.name, 
            price: Number(item.price), 
            category: item.category,
            qty: 1, 
            fries: fries, 
            extras: { ...window.MODAL.extras }, 
            notes: notes, 
            finalPrice: finalPrice
        };
        
        const existing = window.STATE.cart.items.find(i => 
            i.id === cartItem.id && 
            i.fries === cartItem.fries && 
            JSON.stringify(i.extras) === JSON.stringify(cartItem.extras) && 
            i.notes === cartItem.notes
        );
        
        if(existing) {
          existing.qty++;
        } else {
          window.STATE.cart.items.push(cartItem);
        }
        
        saveCart();
        document.getElementById("modalOverlay").style.display = 'none';
        toggleDrawer(true);
    };

    function saveCart() { 
      localStorage.setItem(CART_KEY, JSON.stringify(window.STATE.cart)); 
      updateCartUI(); 
    }

    function updateCartUI() {
        const count = window.STATE.cart.items.reduce((s,i) => s + i.qty, 0);
        const bubble = document.getElementById("cartBubble");
        bubble.innerText = count;
        bubble.style.display = count > 0 ? 'inline-block' : 'none';
        
        const container = document.getElementById("cartItems");
        let total = 0;
        
        if(window.STATE.cart.items.length === 0) {
          container.innerHTML = `
            <div style="text-align:center;padding:60px 20px;">
              <div style="font-size:80px;margin-bottom:24px;opacity:0.3;">üõí</div>
              <div style="font-size:20px;color:#999;font-weight:600;">Tu carrito est√° vac√≠o</div>
              <div style="font-size:14px;color:#ccc;margin-top:12px;">Agreg√° productos para empezar</div>
            </div>
          `;
        } else {
          container.innerHTML = '';
          window.STATE.cart.items.forEach((item, idx) => {
              total += item.finalPrice * item.qty;
              let detail = [];
              
              if(item.category === 'hamburguesas') {
                  const map = { 
                    con_sazon:"üå∂Ô∏è Sazonadas", 
                    con_sal:"üßÇ Con Sal", 
                    sin_sal:"‚ú® Sin Sal" 
                  };
                  detail.push(map[item.fries]);
                  if(item.extras.patty) detail.push(`+${item.extras.patty} Carne`);
                  if(item.extras.cheddar) detail.push(`+${item.extras.cheddar} Cheddar`);
              }
              if(item.notes) detail.push(`üìù ${item.notes}`);
              
              container.innerHTML += `
                  <div style="background:white;padding:24px;border-radius:20px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,0,0,0.08);animation:slideUp 0.3s ease-out;animation-delay:${idx * 0.05}s;animation-fill-mode:both;">
                      <div style="display:flex;justify-content:space-between;gap:20px;">
                          <div style="flex:1;">
                              <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:#1a1a1a;margin-bottom:8px;">${item.name}</div>
                              <div style="font-size:13px;color:#999;line-height:1.6;margin-bottom:12px;">${detail.join(" ‚Ä¢ ")}</div>
                              <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:#625A45;">$${item.finalPrice}</div>
                          </div>
                          <div style="display:flex;align-items:center;gap:12px;background:#faf9f7;padding:8px 12px;border-radius:16px;height:fit-content;">
                              <button onclick="cartQty(${idx}, -1)" style="background:#f0f0f0;border:none;width:32px;height:32px;border-radius:50%;font-size:18px;font-weight:800;color:#666;cursor:pointer;transition:all 0.2s ease;" onmouseover="this.style.background='#e0e0e0';this.style.transform='scale(1.1)'" onmouseout="this.style.background='#f0f0f0';this.style.transform='scale(1)'">‚àí</button>
                              <span style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:#625A45;min-width:24px;text-align:center;">${item.qty}</span>
                              <button onclick="cartQty(${idx}, 1)" style="background:linear-gradient(135deg,#625A45,#D4A574);border:none;width:32px;height:32px;border-radius:50%;font-size:18px;font-weight:800;color:white;cursor:pointer;transition:all 0.2s ease;box-shadow:0 2px 8px rgba(98,90,69,0.2);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">+</button>
                          </div>
                      </div>
                  </div>
              `;
          });
        }
        
        document.getElementById("cartTotal").innerText = "Total: $" + total;
    }

    window.cartQty = (idx, delta) => {
        const item = window.STATE.cart.items[idx];
        item.qty += delta;
        if(item.qty <= 0) {
          window.STATE.cart.items.splice(idx, 1);
        }
        saveCart();
    }

    window.emptyCart = () => { 
      if(confirm("¬øEst√°s seguro de vaciar el carrito?")) { 
        window.STATE.cart.items = []; 
        saveCart(); 
        toggleDrawer(false); 
      } 
    }

    window.toggleDrawer = (open) => { 
      const drawer = document.querySelector('.drawer');
      if(open) { 
        drawer.style.transform = 'translateX(0)';
        updateCartUI(); 
      } else {
        drawer.style.transform = 'translateX(100%)';
      }
    }

    document.getElementById("modalOverlay").onclick = (e) => { 
      if(e.target.id === "modalOverlay") {
        document.getElementById("modalOverlay").style.display = 'none';
      }
    }

    document.getElementById("btnCheckout").onclick = () => { 
      if(window.STATE.cart.items.length === 0) {
        return alert("Tu carrito est√° vac√≠o");
      }
      window.location.href = "pedido_cliente.html"; 
    }
  </script>
</body>
</html>
