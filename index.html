<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rhodes Burgers - Men√∫</title>
  <link rel="icon" href="images/logo.png" />

  <style>
    :root{
      --primary:#2ecc71; --text:#111; --muted:#666;
      --bg:#f6f6f6; --card:#fff; --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
    body::before{content:"";position:fixed;inset:0;background:url("images/logo.png") center 120px/320px no-repeat;opacity:.06;pointer-events:none;z-index:0;filter:grayscale(100%)}
    header{position:sticky;top:0;z-index:10;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .topbar{max-width:1000px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:12px}
    .brand img{width:40px;height:40px;border-radius:10px;object-fit:contain;background:#fff}
    .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;gap:10px;border:2px solid var(--primary);padding:10px 16px;border-radius:999px;color:var(--primary);background:#fff;font-weight:700;text-decoration:none;transition:.15s transform,.15s box-shadow}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(46,204,113,.25)}
    .btn.primary{background:var(--primary);color:#fff}
    .cart-badge{min-width:26px;height:26px;display:inline-flex;align-items:center;justify-content:center;background:#fff;color:var(--primary);border-radius:999px;padding:0 8px;font-weight:800}

    main{position:relative;z-index:1}
    .container{max-width:1000px;margin:24px auto;padding:0 12px}
    h1{font-size:42px;margin:14px 4px 24px}
    h2{font-size:32px;margin:28px 4px 16px}
    h3{font-size:20px;margin:10px 0 6px}
    p{margin:6px 0;color:var(--muted)}

    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(230px,1fr))}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:160px;object-fit:cover;background:#f0f0f0}
    .card .content{padding:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:8px}
    .price{font-weight:800}
    .qty{display:flex;align-items:center;gap:8px;background:#fafafa;border-radius:999px;padding:6px 10px;border:1px solid #ececec}
    .qty button{background:#fff;border:1px solid #e5e5e5;width:28px;height:28px;border-radius:999px;font-weight:900}
    .qty span{min-width:18px;text-align:center}

    .box{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin:8px 0 16px}
    .help{color:var(--muted);font-size:15px}

    .drawer{position:fixed;top:0;right:-440px;width:440px;max-width:92vw;height:100vh;background:#fff;box-shadow:-8px 0 30px rgba(0,0,0,.18);transition:right .25s ease;z-index:30;display:flex;flex-direction:column}
    .drawer.open{right:0}
    .drawer header{padding:14px 16px;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .drawer .body{padding:14px 16px;overflow:auto;flex:1}
    .divider{height:1px;background:#eee;margin:12px 0}
    .item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 0}
    .total{display:flex;align-items:center;justify-content:space-between;font-size:18px;font-weight:800}
    .muted{color:var(--muted);font-size:14px}
    .close{position:absolute;top:10px;right:10px;width:38px;height:38px;border-radius:999px;border:1px solid #eee;background:#fff;font-weight:900}
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    .field input,.field select{padding:10px 12px;border-radius:12px;border:1px solid #e7e7e7}
    .inline{display:flex;gap:12px;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid #e7e7e7;border-radius:999px;padding:8px 12px}
    .hid{display:none}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="#" class="brand"><img src="images/logo.png" alt="Rhodes Burgers"></a>
      <div class="spacer"></div>
      <a class="btn" id="btnContacto">üìû Contacto</a>
      <a class="btn primary" id="btnCarrito">üõí Carrito <span class="cart-badge" id="cartCount">0</span></a>
    </div>
  </header>

  <main>
    <div class="container">
      <h1>Men√∫</h1>

      <h2>Hamburguesas</h2>
      <div id="burgersGrid" class="grid"></div>

      <h2>Papas fritas <span class="muted">(obligatorio)</span></h2>
      <div class="box">
        <label class="pill"><input type="radio" name="papas" value="con_sazon"> Con saz√≥n <span class="muted">(sin costo)</span></label>
        <label class="pill"><input type="radio" name="papas" value="sin_sazon"> Sin sazonar <span class="muted">(sin costo)</span></label>
        <p class="help">Eleg√≠ una opci√≥n. La agregamos a tu pedido sin costo.</p>
      </div>

      <h2>Bebidas</h2>
      <div id="drinksGrid" class="grid"></div>
    </div>
  </main>

  <!-- Drawer Carrito -->
  <aside class="drawer" id="drawer">
    <header>
      <strong>Tu pedido</strong>
      <button class="close" id="closeDrawer">‚úï</button>
    </header>
    <div class="body">
      <div id="cartItems"></div>

      <div class="divider"></div>
      <div class="item"><span>Papas (obligatorio)</span><span id="papasSummary" class="muted">Sin elegir</span></div>

      <div class="divider"></div>
      <div class="field">
        <label>Nombre y apellido</label>
        <input id="inpNombre" placeholder="Ej: Juan P√©rez" autocomplete="name" />
      </div>
      <div class="inline">
        <label class="pill"><input type="radio" name="pago" value="mercado_pago"> Mercado Pago</label>
        <label class="pill"><input type="radio" name="pago" value="efectivo"> Efectivo</label>
      </div>
      <div class="inline" style="margin-top:8px">
        <label class="pill"><input type="radio" name="entrega" value="delivery"> Delivery</label>
        <label class="pill"><input type="radio" name="entrega" value="take_away"> Take Away</label>
      </div>
      <div class="field hid" id="dirWrap">
        <label>Direcci√≥n (solo si es Delivery)</label>
        <input id="inpDireccion" placeholder="Calle, n√∫mero, piso" autocomplete="address-line1" />
      </div>

      <div class="divider"></div>
      <div class="total"><span>Total</span><span id="cartTotal">$0</span></div>

      <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap">
        <button class="btn" id="btnVaciar">Vaciar</button>
        <button class="btn primary" id="btnFinalizar">Finalizar pedido</button>
      </div>

      <p class="muted" style="margin-top:10px">Los datos (nombre, pago y entrega) se piden ac√° en ‚ÄúVer pedido‚Äù, como pediste.</p>
    </div>
  </aside>

  <!-- Firebase (opcional) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    /*************** 1) FIREBASE CONFIG (opcional) ***************/
    const firebaseConfig = {
      // apiKey: "TU_API_KEY",
      // authDomain: "TU_DOMINIO.firebaseapp.com",
      // projectId: "TU_PROJECT_ID",
      // storageBucket: "TU_PROJECT_ID.appspot.com",
      // messagingSenderId: "XXX",
      // appId: "1:XXX:web:XXX"
    };
    let db = null;
    try{
      if (firebaseConfig && Object.keys(firebaseConfig).length) {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("Firestore inicializado");
      }
    }catch(e){ console.warn("Firebase no inicializado:", e) }

    /*************** 2) DATOS ***************/
    const BURGERS = [
      { id:"bigjohn_doble",   name:"Big John Doble",      price:9500, img:"images/Big John Doble.jpg",    desc:"Doble medall√≥n, cheddar, pepinos" },
      { id:"bigjohn_simple",  name:"Big John Simple",     price:7800, img:"images/Big John Simple.jpg",   desc:"Simple medall√≥n, cheddar, pepinos" },
      { id:"rhodes_doble",    name:"Rhodes Doble",        price:9200, img:"images/Rhodes Doble.jpg",      desc:"Doble carne, cheddar, cebolla" },
      { id:"rhodes_simple",   name:"Rhodes Simple",       price:7600, img:"images/Rhodes Simple.jpg",     desc:"Carne, cheddar, cebolla" },
      { id:"cheesebacon_dbl", name:"CheeseBacon Doble",   price:9300, img:"images/CheeseBacon Doble.jpg", desc:"Doble carne, cheddar y bacon" },
      { id:"cheesebacon_spl", name:"CheeseBacon Simple",  price:7900, img:"images/CheeseBacon Simple.jpg",desc:"Carne, cheddar y bacon" },
      { id:"cheese_doble",    name:"Cheeseburger Doble",  price:8900, img:"images/cheeseburger doble.jpg",desc:"Doble carne con doble cheddar" },
      { id:"cheese_simple",   name:"Cheeseburger Simple", price:7200, img:"images/cheeseburger simple.jpg",desc:"Carne con cheddar" },
      { id:"burguesa_doble",  name:"Burguesa Doble",      price:8700, img:"images/Burguesa Doble.jpg",    desc:"Doble carne, cheddar" },
      { id:"burguesa_simple", name:"Burguesa Simple",     price:6900, img:"images/Burguesa Simple.jpg",   desc:"Carne, cheddar" },
    ];

    const DRINKS = [
      { id:"coca",  name:"Coca-Cola 500ml", price:2200, img:"images/coca.jpg" },
      { id:"sprite",name:"Sprite 500ml",    price:2200, img:"images/sprite.jpg" },
      { id:"agua",  name:"Agua 500ml",      price:1800, img:"images/agua.jpg" },
    ];

    const FALLBACK_IMG = "images/logo.png";
    const CART_KEY = "rhodes_cart_v2";

    /*************** 3) UTIL / ESTADO ***************/
    const $ = s => document.querySelector(s);
    const gridBurgers = $("#burgersGrid");
    const gridDrinks  = $("#drinksGrid");
    const cartCountEl = $("#cartCount");
    const drawer      = $("#drawer");
    const cartItemsEl = $("#cartItems");
    const cartTotalEl = $("#cartTotal");
    const papasSummaryEl = $("#papasSummary");
    const dirWrap = $("#dirWrap"), inpDireccion=$("#inpDireccion");
    const inpNombre = $("#inpNombre");

    let cart = loadCart();

    function money(n){ return n.toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}); }
    function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)) || { burger:{}, drink:{}, fries:null }; }catch{ return { burger:{}, drink:{}, fries:null } } }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    function getQty(type,id){ return cart[type]?.[id]?.qty || 0; }
    function findItem(type,id){ const list = type==="burger"?BURGERS:DRINKS; return list.find(x=>x.id===id); }
    function cartCount(){ let n=0; for(const b of Object.values(cart.burger)) n+=b.qty; for(const d of Object.values(cart.drink)) n+=d.qty; return n; }
    function calcTotal(){ let t=0; for(const b of Object.values(cart.burger)) t+=b.item.price*b.qty; for(const d of Object.values(cart.drink)) t+=d.item.price*d.qty; return t; }

    /*************** 4) RENDER ***************/
    function renderCard(item,type){
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <img src="${encodeURI(item.img)}" alt="${item.name}" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'">
        <div class="content">
          <h3>${item.name}</h3>
          ${item.desc?`<p>${item.desc}</p>`:""}
          <div class="row">
            <span class="price">${money(item.price)}</span>
            <div class="qty">
              <button data-act="dec">-</button>
              <span id="q-${type}-${item.id}">${getQty(type,item.id)}</span>
              <button data-act="inc">+</button>
            </div>
          </div>
        </div>`;
      card.querySelectorAll(".qty button").forEach(btn=>{
        btn.onclick=()=>addToCart(type,item.id,btn.dataset.act==="inc"?1:-1,item);
      });
      return card;
    }

    function mount(){
      gridBurgers.innerHTML=""; BURGERS.forEach(b=>gridBurgers.appendChild(renderCard(b,"burger")));
      gridDrinks.innerHTML="";  DRINKS.forEach(d=>gridDrinks.appendChild(renderCard(d,"drink")));
      sync();
    }

    /*************** 5) CARRITO ***************/
    function addToCart(type,id,delta,itemData=null){
      const bucket = cart[type] || (cart[type]={});
      const current = bucket[id]?.qty || 0;
      const next = Math.max(0,current+delta);
      if(next===0) delete bucket[id];
      else bucket[id] = { qty:next, ...(bucket[id]||{}), item: itemData || findItem(type,id) };
      saveCart(); sync();
    }

    function rowItem(type,obj){
      return `
        <div class="item">
          <div><div><strong>${obj.item.name}</strong></div><div class="muted">${money(obj.item.price)} x ${obj.qty}</div></div>
          <div class="qty">
            <button onclick="addToCart('${type}','${obj.item.id}',-1)">-</button>
            <span>${obj.qty}</span>
            <button onclick="addToCart('${type}','${obj.item.id}',1)">+</button>
          </div>
        </div>`;
    }

    function sync(){
      // cantidades en cards
      BURGERS.forEach(b=>{ const el=$("#q-burger-"+b.id); if(el) el.textContent=getQty("burger",b.id); });
      DRINKS.forEach(d=>{ const el=$("#q-drink-"+d.id);  if(el) el.textContent=getQty("drink",d.id);  });
      // badge
      cartCountEl.textContent = cartCount();
      // items en drawer
      const rows=[];
      for(const obj of Object.values(cart.burger)) rows.push(rowItem("burger",obj));
      for(const obj of Object.values(cart.drink)) rows.push(rowItem("drink",obj));
      cartItemsEl.innerHTML = rows.join("") || `<p class="muted">Tu carrito est√° vac√≠o.</p>`;
      // total
      cartTotalEl.textContent = money(calcTotal());
      // papas
      const map={con_sazon:"Con saz√≥n",sin_sazon:"Sin sazonar"};
      papasSummaryEl.textContent = cart.fries?map[cart.fries]:"Sin elegir";
      // toggle direcci√≥n
      const entregaVal = getRadio("entrega");
      dirWrap.classList.toggle("hid", entregaVal!=="delivery");
    }

    /*************** 6) FORM + ACCIONES ***************/
    function getRadio(name){
      const el=document.querySelector(`input[name="${name}"]:checked`);
      return el?el.value:null;
    }

    document.querySelectorAll('input[name="papas"]').forEach(r=>r.addEventListener("change",()=>{ cart.fries=r.value; saveCart(); sync(); }));
    document.querySelectorAll('input[name="entrega"]').forEach(r=>r.addEventListener("change",sync));

    const openDrawer = ()=>drawer.classList.add("open");
    const closeDrawer= ()=>drawer.classList.remove("open");
    $("#btnCarrito").onclick=openDrawer;
    $("#closeDrawer").onclick=closeDrawer;

    $("#btnVaciar").onclick=()=>{ cart={burger:{},drink:{},fries:null}; saveCart(); sync(); };

    $("#btnFinalizar").onclick=async()=>{
      // Validaciones seg√∫n tu requerimiento
      if(!cart.fries){ alert("Eleg√≠ una opci√≥n de papas (obligatorio)."); return; }
      if(cartCount()===0){ alert("Agreg√° al menos un producto."); return; }
      const nombre = inpNombre.value.trim();
      if(!nombre){ alert("Ingres√° tu nombre y apellido."); return; }
      const pago = getRadio("pago");
      if(!pago){ alert("Eleg√≠ un m√©todo de pago."); return; }
      const entrega = getRadio("entrega");
      if(!entrega){ alert("Eleg√≠ si es Delivery o Take Away."); return; }
      const direccion = entrega==="delivery" ? inpDireccion.value.trim() : "";

      const order = buildOrderPayload({nombre,pago,entrega,direccion});

      try{
        if(db){
          await db.collection("orders").add(order);
          alert("¬°Pedido enviado! ‚úÖ");
        }else{
          // modo local
          const local = JSON.parse(localStorage.getItem("rhodes_orders")||"[]");
          local.push(order);
          localStorage.setItem("rhodes_orders", JSON.stringify(local));
          console.log("Pedido (local):", order);
          alert("¬°Pedido generado! (modo local).");
        }
        cart={burger:{},drink:{},fries:null}; saveCart(); sync(); closeDrawer();
        // limpiar form
        document.querySelectorAll('input[name="pago"]').forEach(r=>r.checked=false);
        document.querySelectorAll('input[name="entrega"]').forEach(r=>r.checked=false);
        inpNombre.value=""; inpDireccion.value="";
      }catch(err){
        console.error(err);
        alert("No pudimos guardar el pedido. Prob√° de nuevo.");
      }
    };

    $("#btnContacto").onclick=()=>window.location.href="https://wa.me/5491112345678?text=Hola%20Rhodes%20Burgers!";

    function buildOrderPayload(extra){
      const items=[];
      for(const o of Object.values(cart.burger)) items.push({type:"burger", id:o.item.id, name:o.item.name, qty:o.qty, price:o.item.price});
      for(const o of Object.values(cart.drink))  items.push({type:"drink",  id:o.item.id, name:o.item.name, qty:o.qty, price:o.item.price});
      return {
        createdAt:new Date().toISOString(),
        fries:cart.fries,
        items,
        total:calcTotal(),
        status:"pending",
        ...extra
      };
    }

    // Init
    mount();
  </script>
</body>
</html>
