<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rhodes Burgers - Menú</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{
      --primary:#2ecc71; --text:#111; --muted:#666; --bg:#f6f6f6; --card:#fff;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08)
    }
    *{ box-sizing:border-box }
    html,body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif }
    body::before{ content:""; position:fixed; inset:0; background:url("images/logo.png") center 120px/320px no-repeat; opacity:.06; pointer-events:none; z-index:0; filter:grayscale(100%) }
    header{ position:sticky; top:0; z-index:10; background:#fff; box-shadow:0 2px 12px rgba(0,0,0,.06) }
    .topbar{ max-width:1100px; margin:0 auto; padding:10px 12px; display:flex; align-items:center; gap:12px }
    .brand img{ width:40px; height:40px; border-radius:10px; background:#fff; object-fit:contain }
    .spacer{ flex:1 }
    .btn{ display:inline-flex; align-items:center; gap:10px; border:2px solid var(--primary); padding:10px 16px; border-radius:999px; color:var(--primary); background:#fff; font-weight:700; text-decoration:none; cursor:pointer }
    .btn.primary{ background:var(--primary); color:#fff }
    .btn.ghost{ border-color:#e7e7e7; color:#333 }
    .container{ max-width:1100px; margin:24px auto; padding:0 12px }
    h1{ font-size:34px; margin:14px 4px 18px }
    h2{ font-size:26px; margin:24px 4px 14px }
    h3{ font-size:18px; margin:8px 0 6px }
    p{ margin:6px 0; color:var(--muted) }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:16px }
    .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:0; overflow:hidden; display:flex; flex-direction:column }
    .card img{ width:100%; height:160px; object-fit:cover; background:#f0f0f0 }
    .card .content{ padding:12px }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:8px }
    .price{ font-weight:800 }
    .actions{ display:flex; gap:8px; flex-wrap:wrap }

    /* Selector de papas */
    .inline{ display:flex; gap:12px; flex-wrap:wrap; margin:8px 0 }
    .pill{ display:inline-flex; align-items:center; gap:8px; border:1px solid #e7e7e7; border-radius:999px; padding:8px 12px }

    /* Drawer */
    .drawer{ position:fixed; top:0; right:-460px; width:460px; max-width:92vw; height:100vh; background:#fff; box-shadow:-8px 0 30px rgba(0,0,0,.18); transition:right .25s; z-index:30; display:flex; flex-direction:column }
    .drawer.open{ right:0 }
    .drawer header{ padding:14px 16px; box-shadow:0 2px 12px rgba(0,0,0,.06) }
    .drawer .body{ padding:14px 16px; overflow:auto; flex:1 }
    .item{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 0; border-bottom:1px solid #efefef }
    .total{ display:flex; align-items:center; justify-content:space-between; font-weight:800; font-size:18px; margin-top:10px }
    .close{ position:absolute; top:10px; right:10px; width:38px; height:38px; border-radius:999px; border:1px solid #eee; background:#fff; font-weight:900; cursor:pointer }
    .muted{ color:var(--muted); font-size:14px }

    /* Modal */
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.25); display:none; align-items:center; justify-content:center; z-index:40 }
    .overlay.open{ display:flex }
    .modal{ background:#fff; border-radius:20px; box-shadow:var(--shadow); width:520px; max-width:92vw; padding:16px }
    .modal h3{ margin:0 0 8px }
    .rowx{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0 }
    .qtybox{ display:inline-flex; align-items:center; gap:10px; border:1px solid #e7e7e7; border-radius:999px; padding:6px 10px }
    .qtybox button{ width:28px; height:28px; border:1px solid #e5e5e5; background:#fff; border-radius:999px; font-weight:900; cursor:pointer }
    textarea{ width:100%; min-height:70px; padding:10px; border:1px solid #e7e7e7; border-radius:12px }

    .badge{ font-size:12px; color:#0a0; background:#eaffea; border:1px solid #bff0bf; padding:2px 8px; border-radius:999px; }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="index.html" class="brand"><img src="images/logo.png" alt="Rhodes Burgers"></a>
      <div class="spacer"></div>
      <button class="btn primary" id="btnCart">Ver pedido</button>
    </div>
  </header>

  <main>
    <div class="container">
      <h1>Menú</h1>

      <h2>Hamburguesas</h2>
      <div id="burgersGrid" class="grid"></div>

      <!-- PAPAS OBLIGATORIAS -->
      <h2>Papas fritas (obligatorio)</h2>
      <div class="inline" id="papas-opciones">
        <label class="pill"><input type="radio" name="papas" value="con_sazon"> Con sazón</label>
        <label class="pill"><input type="radio" name="papas" value="sin_sazon"> Sin sazonar</label>
      </div>
      <p class="muted">Debés elegir una opción de papas para agregar productos.</p>

      <h2>Bebidas</h2>
      <div id="drinksGrid" class="grid"></div>
    </div>
  </main>

  <!-- Drawer Carrito -->
  <aside class="drawer" id="drawer">
    <header>
      <strong>Tu pedido</strong>
      <button class="close" id="closeDrawer">✕</button>
    </header>
    <div class="body">
      <div id="cartItems"></div>
      <div class="total"><span>Total</span><span id="cartTotal">$0</span></div>
      <div style="margin-top:12px; display:flex; gap:10px">
        <button class="btn ghost" id="btnVaciar">Vaciar</button>
        <a class="btn primary" href="pedido_cliente.html">Ir a pagar</a>
      </div>
    </div>
  </aside>

  <!-- Modal Personalizar -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h3 id="modTitle">Personalizar</h3>

      <div class="rowx">
        <div>Cantidad</div>
        <div class="qtybox">
          <button id="qtyDec">-</button>
          <span id="qtyVal">1</span>
          <button id="qtyInc">+</button>
        </div>
      </div>

      <div id="extrasWrap">
        <div class="rowx" id="rowPatties" style="display:none">
          <div>
            Medallones extra
            <span class="badge" id="patPriceBadge">+ $ 0 c/u</span>
            <span class="muted">(máx. +2)</span>
          </div>
          <div class="qtybox">
            <button id="patDec">-</button>
            <span id="patVal">0</span>
            <button id="patInc">+</button>
          </div>
        </div>

        <div class="rowx" id="rowCheddar" style="display:none">
          <div>
            Fetas de cheddar extra
            <span class="badge" id="chePriceBadge">+ $ 0 c/u</span>
            <span class="muted" id="cheHint">(máx. +3)</span>
          </div>
          <div class="qtybox">
            <button id="cheDec">-</button>
            <span id="cheVal">0</span>
            <button id="cheInc">+</button>
          </div>
        </div>

        <div class="muted" id="noExtras" style="display:none">Este producto no admite extras.</div>
      </div>

      <div class="rowx" style="align-items:flex-start; flex-direction:column">
        <label>Notas (opcional)</label>
        <textarea id="notes" placeholder="Sin cebolla, extra salsa, etc."></textarea>
      </div>

      <div class="rowx" style="justify-content:flex-end">
        <button class="btn ghost" id="btnCancel">Cancelar</button>
        <button class="btn primary" id="btnAdd">Agregar al carrito</button>
      </div>
    </div>
  </div>

  <script>
    /*************** PRECIOS DE EXTRAS (CAMBIAR ACÁ) ***************/
    const EXTRA_PRICE_PATTY   = 2000; // ARS por medallón extra
    const EXTRA_PRICE_CHEDDAR = 500;  // ARS por feta de cheddar

    /*************** DATOS ***************/
    const BURGERS = [
      { id:"bigjohn_simple",  name:"Big John Simple",     price:10900, img:"images/Big John Simple.jpg",   kind:"simple",  desc:"Medallón con cheddar, lechuga, pepinillos y salsa Big Mac en pan brioche. Incluye papas fritas." },
      { id:"bigjohn_doble",   name:"Big John Doble",      price:13900, img:"images/Big John Doble.jpg",    kind:"double",  desc:"Doble Medallón con cheddar, lechuga, pepinillos y salsa Big Mac en pan brioche. Incluye papas fritas." },
      { id:"burguesa_simple", name:"Burguesa Simple",     price:11900, img:"images/Burguesa Simple.jpg",   kind:"simple",  desc:"Medallón con doble cheddar, salsa mostaza y miel y cebolla caramelizada en pan Burgerluna. Incluye papas fritas." },
      { id:"burguesa_doble",  name:"Burguesa Doble",      price:14900, img:"images/Burguesa Doble.jpg",    kind:"double",  desc:"Doble Medallón con doble cheddar, salsa mostaza y miel y cebolla caramelizada en pan Burgerluna. Incluye papas fritas." },
      { id:"cheesebacon_spl", name:"CheeseBacon Simple",  price:10500, img:"images/CheeseBacon Simple.jpg",kind:"simple",  desc:"Medallón con doble cheddar y bacon en pan brioche. Incluye papas fritas." },
      { id:"cheesebacon_dbl", name:"CheeseBacon Doble",   price:13500, img:"images/CheeseBacon Doble.jpg", kind:"double",  desc:"Doble Medallón con doble cheddar y bacon en pan brioche. Incluye papas fritas." },
      { id:"cheese_simple",   name:"Cheeseburger Simple", price:9500,  img:"images/cheeseburger simple.jpg",kind:"simple",  desc:"Medallón con doble cheddar en pan brioche. Incluye papas fritas." },
      { id:"cheese_doble",    name:"Cheeseburger Doble",  price:12500, img:"images/cheeseburger doble.jpg",kind:"double",  desc:"Doble Medallón con doble cheddar en pan brioche. Incluye papas fritas." },
      { id:"rhodes_simple",   name:"Rhodes Simple",       price:11900, img:"images/Rhodes Simple.jpg",     kind:"simple",  desc:"Medallón con doble cheddar, bacon, morrones, cebolla y salsa spicy en pan brioche. Incluye papas fritas." },
      { id:"rhodes_doble",    name:"Rhodes Doble",        price:14900, img:"images/Rhodes Doble.jpg",      kind:"double",  desc:"Doble Medallón con doble cheddar, bacon, morrones, cebolla y salsa spicy en pan brioche. Incluye papas fritas." },
      { id:"morgan_simple",   name:"Morgan Simple",       price:10900, img:"images/Morgan Simple.jpg",     kind:"simple",  desc:"Medallón con doble cheddar, bacon, salsa barbacoa y cebolla crispy en pan brioche. Incluye papas fritas." },
      { id:"morgan_doble",    name:"Morgan Doble",        price:14500, img:"images/Morgan Doble.jpg",      kind:"double",  desc:"Doble Medallón con doble cheddar, bacon, salsa barbacoa y cebolla crispy en pan brioche. Incluye papas fritas." },
      { id:"pollo_crispy",    name:"Pollo Crispy",        price:8900,  img:"images/Pollo crispy.jpg",      kind:"chicken", desc:"Pechuga de pollo crispy con lechuga y mayonesa en pan brioche. Incluye papas fritas." },
      { id:"test_1peso",      name:"Hamburguesa Test $1", price:1,     img:"images/Big John Simple.jpg",   kind:"simple",  desc:"Para pruebas." }
    ];
    const DRINKS = [
      { id:"coca_org",  name:"Coca-Cola Original 500ml", price:0, img:"images/coca cola original.jpg" },
      { id:"coca_zero", name:"Coca-Cola Zero 500ml",     price:0, img:"images/coca cola zero.jpg" },
      { id:"sprite",    name:"Sprite 500ml",             price:0, img:"images/sprite.jpg" },
      { id:"aqu_pear",  name:"Aquarius Limonada 500ml",  price:0, img:"images/aquarius pera.jpg" },
      { id:"aqu_pome",  name:"Aquarius Pomelo 500ml",    price:0, img:"images/aquarius pomelo.jpg" }
    ];
    const FALLBACK_IMG = "images/logo.png";
    const CART_KEY = "rhodes_cart_v3";

    /*************** UTIL ***************/
    const $ = s => document.querySelector(s);
    const money = n => (Number(n)||0).toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});
    const friesLabel = v => v==='con_sazon' ? 'Con sazón' : 'Sin sazonar';

    /*************** ESTADO ***************/
    let cart = loadCart(); // {burger:{},drink:{}}
    function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)) || {burger:{},drink:{}}; }catch{ return {burger:{},drink:{}}; } }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    function cartCount(){ let n=0; for(const b of Object.values(cart.burger)) n+=b.qty; for(const d of Object.values(cart.drink)) n+=d.qty; return n; }
    function calcTotal(){
      let t=0;
      for(const b of Object.values(cart.burger)){
        const base=(b.item?.price||0);
        const extrasCost=(b.extras?.patty||0)*EXTRA_PRICE_PATTY + (b.extras?.cheddar||0)*EXTRA_PRICE_CHEDDAR;
        t += (base+extrasCost)*b.qty;
      }
      for(const d of Object.values(cart.drink)) t += (d.item?.price||0)*d.qty;
      return t;
    }

    // PAPAS: validación y persistencia (por ítem se guarda lo que esté seleccionado al agregar)
    function getSelectedFries(){
      const sel=document.querySelector('input[name="papas"]:checked');
      return sel? sel.value : null;
    }
    function validarPapas(){
      const v=getSelectedFries();
      if(!v){ alert("Por favor elegí papas: con sazón o sin sazonar."); return false; }
      return true;
    }

    /*************** RENDER MENÚ ***************/
    const gridBurgers = $("#burgersGrid"), gridDrinks = $("#drinksGrid");
    function renderCard(item,type){
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <img src="${encodeURI(item.img)}" alt="${item.name}" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'">
        <div class="content">
          <h3>${item.name}</h3>
          ${item.desc?`<p class="muted" style="margin:4px 0 0">${item.desc}</p>`:""}
          <div class="row">
            <span class="price">${money(item.price)}</span>
            <div class="actions">
              ${type==="drink"
                ? `<button class="btn" data-add>Agregar</button>`
                : `${item.kind==="double"||item.kind==="chicken"
                    ? `<button class="btn" data-quick>Agregar</button>
                       <button class="btn" data-custom>Personalizar</button>`
                    : `<button class="btn" data-quick>Agregar</button>`
                  }`
              }
            </div>
          </div>
        </div>`;
      if(type==="drink"){
        card.querySelector("[data-add]").onclick = ()=> quickAddDrink(item);
      }else{
        card.querySelector("[data-quick]").onclick  = ()=> quickAddBurger(item);
        const customBtn=card.querySelector("[data-custom]");
        if(customBtn) customBtn.onclick = ()=> openCustomize(item);
      }
      return card;
    }
    function mount(){
      gridBurgers.innerHTML=""; BURGERS.forEach(b=>gridBurgers.appendChild(renderCard(b,"burger")));
      gridDrinks.innerHTML="";  DRINKS.forEach(d=>gridDrinks.appendChild(renderCard(d,"drink")));
      renderCart();
    }

    /*************** QUICK ADD ***************/
    function composeKey(item, fries, extras, notes){
      // Para agrupar iguales en una misma línea
      const p = extras?.patty||0, c = extras?.cheddar||0;
      const n = (notes||"").trim().toLowerCase();
      return `${item.id}|f:${fries||'-'}|p:${p}|c:${c}|n:${n||'-'}`;
    }

    function quickAddBurger(item){
      if(!validarPapas()) return;
      const fries = getSelectedFries();
      const extras = { patty:0, cheddar:0 }; // en quick add no hay extras
      const key = composeKey(item, fries, extras, "");
      const bucket = cart.burger || (cart.burger={});
      if(!bucket[key]) bucket[key] = { qty:0, item, fries, extras, notes:"" };
      bucket[key].qty += 1;
      saveCart(); renderCart(); openDrawer();
    }
    function quickAddDrink(item){
      const bucket = cart.drink || (cart.drink={});
      const key = item.id;
      if(!bucket[key]) bucket[key] = { qty:0, item };
      bucket[key].qty += 1;
      saveCart(); renderCart(); openDrawer();
    }

    /*************** DRAWER ***************/
    const drawer=$("#drawer"), cartItems=$("#cartItems"), cartTotal=$("#cartTotal");
    function renderCart(){
      cartItems.innerHTML="";
      for(const [key,obj] of Object.entries(cart.burger)){
        const extrasTxt=[];
        let extrasSum=0;
        if(obj.extras){
          if(obj.extras.patty){
            extrasTxt.push(`+${obj.extras.patty} medallón(es)`);
            extrasSum += obj.extras.patty*EXTRA_PRICE_PATTY;
          }
          if(obj.extras.cheddar){
            extrasTxt.push(`+${obj.extras.cheddar} cheddar`);
            extrasSum += obj.extras.cheddar*EXTRA_PRICE_CHEDDAR;
          }
        }
        const unit = (obj.item.price||0)+extrasSum;
        cartItems.innerHTML += `
          <div class="item">
            <div>
              <strong>${obj.item.name}</strong>
              <div class="muted">Papas: ${friesLabel(obj.fries)} ${extrasTxt.length?`· ${extrasTxt.join(" · ")}`:""}</div>
              ${obj.notes?`<div class="muted">Notas: ${obj.notes}</div>`:""}
            </div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('burger','${key}',-1)">-</button>
              <span>${obj.qty}</span>
              <button class="btn ghost" onclick="changeQty('burger','${key}',1)">+</button>
              <span>${money(unit*obj.qty)}</span>
            </div>
          </div>`;
      }
      for(const [key,obj] of Object.entries(cart.drink)){
        cartItems.innerHTML += `
          <div class="item">
            <div><strong>${obj.item.name}</strong></div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('drink','${key}',-1)">-</button>
              <span>${obj.qty}</span>
              <button class="btn ghost" onclick="changeQty('drink','${key}',1)">+</button>
              <span>${money(obj.item.price*obj.qty)}</span>
            </div>
          </div>`;
      }
      cartTotal.textContent = money(calcTotal());
      document.getElementById("btnCart").innerHTML = `Ver pedido <span class="muted">(${cartCount()})</span>`;
    }
    function changeQty(type,id,delta){
      const bucket = cart[type]; if(!bucket) return;
      const cur = bucket[id]?.qty || 0;
      const next = Math.max(0, cur+delta);
      if(next===0) delete bucket[id]; else bucket[id].qty = next;
      saveCart(); renderCart();
    }

    /*************** MODAL PERSONALIZAR ***************/
    const overlay=$("#overlay"), modTitle=$("#modTitle");
    const qtyVal=$("#qtyVal"), qtyInc=$("#qtyInc"), qtyDec=$("#qtyDec");
    const rowPatties=$("#rowPatties"), rowCheddar=$("#rowCheddar"), noExtras=$("#noExtras"), cheHint=$("#cheHint");
    const patVal=$("#patVal"), patInc=$("#patInc"), patDec=$("#patDec");
    const cheVal=$("#cheVal"), cheInc=$("#cheInc"), cheDec=$("#cheDec");
    const notes=$("#notes"), btnAdd=$("#btnAdd"), btnCancel=$("#btnCancel");
    const patPriceBadge=$("#patPriceBadge"), chePriceBadge=$("#chePriceBadge");

    let currentItem=null; // {id,name,price,kind}

    function openCustomize(item){
      currentItem = item;
      modTitle.textContent = "Personalizar: " + item.name;
      qtyVal.textContent="1"; notes.value="";
      patVal.textContent="0"; cheVal.textContent="0";

      patPriceBadge.textContent = `+ ${money(EXTRA_PRICE_PATTY)} c/u`;
      chePriceBadge.textContent = `+ ${money(EXTRA_PRICE_CHEDDAR)} c/u`;

      if(item.kind==="double"){
        rowPatties.style.display="flex";
        rowCheddar.style.display="flex";
        cheHint.textContent="(máx. +3)";
        noExtras.style.display="none";
      }else if(item.kind==="chicken"){
        rowPatties.style.display="none";
        rowCheddar.style.display="flex";
        cheHint.textContent="(máx. +3)";
        noExtras.style.display="none";
      }else{
        rowPatties.style.display="none";
        rowCheddar.style.display="none";
        noExtras.style.display="block";
      }
      overlay.classList.add("open");
    }
    function closeCustomize(){ overlay.classList.remove("open"); }

    qtyInc.onclick = ()=> qtyVal.textContent = String(Math.min(99,(+qtyVal.textContent||1)+1));
    qtyDec.onclick = ()=> qtyVal.textContent = String(Math.max(1,(+qtyVal.textContent||1)-1));
    patInc.onclick = ()=> { if(+patVal.textContent < 2) patVal.textContent = (+patVal.textContent)+1; };
    patDec.onclick = ()=> { if(+patVal.textContent > 0) patVal.textContent = (+patVal.textContent)-1; };
    cheInc.onclick = ()=> { if(+cheVal.textContent < 3) cheVal.textContent = (+cheVal.textContent)+1; };
    cheDec.onclick = ()=> { if(+cheVal.textContent > 0) cheVal.textContent = (+cheVal.textContent)-1; };

    btnCancel.onclick = closeCustomize;

    btnAdd.onclick = ()=>{
      if(!validarPapas()) return;
      const fries = getSelectedFries();
      const qty = +qtyVal.textContent || 1;

      const extras = { patty:0, cheddar:0 };
      if(currentItem.kind==="double"){ extras.patty=+patVal.textContent||0; extras.cheddar=+cheVal.textContent||0; }
      else if(currentItem.kind==="chicken"){ extras.patty=0; extras.cheddar=+cheVal.textContent||0; }
      const txt = notes.value.trim();

      const key = composeKey(currentItem, fries, extras, txt);
      const bucket = cart.burger || (cart.burger={});
      const prev = bucket[key];
      if(prev){
        prev.qty += qty;
        // mantener extras y notas máximos/últimos no es necesario porque la clave ya discrimina
      }else{
        bucket[key] = { qty, item: currentItem, fries, extras, ...(txt?{notes:txt}:{}) };
      }
      saveCart(); renderCart(); closeCustomize(); openDrawer();
    };

    /*************** NAV / EVENTOS ***************/
    function openDrawer(){ drawer.classList.add("open"); }
    function closeDrawer(){ drawer.classList.remove("open"); }
    document.getElementById("btnCart").onclick = openDrawer;
    document.getElementById("closeDrawer").onclick = closeDrawer;
    document.getElementById("btnVaciar").onclick = ()=>{ cart={burger:{},drink:{}}; saveCart(); renderCart(); };

    // Init
    mount();
  </script>
</body>
</html>
