<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rhodes Burgers - Menú</title>
  <!-- Favicons con fallback -->
  <link rel="icon" type="image/png" href="images/logo.png" />
  <link rel="icon" type="image/jpeg" href="images/logo.jpg" />
  <link rel="stylesheet" href="css/theme.css" />
</head>
<body>
  <header>
    <div class="topbar">
      <a href="index.html" class="brand">
        <img src="images/logo.png" alt="Rhodes Burgers" onerror="this.onerror=null;this.src='images/logo.jpg'">
        <strong>Rhodes Burgers</strong>
      </a>
      <div class="spacer"></div>
      <button class="btn ghost" id="btnContacto">Contacto</button>
      <button class="btn primary" id="btnCart">Ver pedido</button>
    </div>
  </header>

  <main class="container">
    <h1>Menú</h1>

    <h2>Hamburguesas</h2>
    <div id="burgersGrid" class="grid"></div>

    <!-- Papas: se eligen cuando quieran; son obligatorias recién al pagar -->
    <h2>Papas fritas (obligatorio al pagar)</h2>
    <div class="inline" id="papas-opciones">
      <label class="pill"><input type="radio" name="papas" value="con_sazon"> Con sazón</label>
      <label class="pill"><input type="radio" name="papas" value="sin_sazon"> Sin sazonar</label>
    </div>
    <p class="muted">Podés agregar productos sin elegir papas. Se piden antes de pagar.</p>

    <h2>Bebidas</h2>
    <div id="drinksGrid" class="grid"></div>
  </main>

  <!-- Drawer Carrito -->
  <aside class="drawer" id="drawer">
    <header>
      <strong>Tu pedido</strong>
      <button class="close" id="closeDrawer">✕</button>
    </header>
    <div class="body">
      <div id="cartItems"></div>
      <div class="total"><span>Total</span><span id="cartTotal">$0</span></div>
      <div style="margin-top:12px; display:flex; gap:10px">
        <button class="btn ghost" id="btnVaciar">Vaciar</button>
        <button class="btn primary" id="btnIrPagar">Ir a pagar</button>
      </div>
    </div>
  </aside>

  <!-- Modal Personalizar -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h3 id="modTitle">Personalizar</h3>

      <div class="rowx">
        <div>Cantidad</div>
        <div class="qtybox">
          <button id="qtyDec">-</button>
          <span id="qtyVal">1</span>
          <button id="qtyInc">+</button>
        </div>
      </div>

      <div id="extrasWrap">
        <div class="rowx" id="rowPatties" style="display:none">
          <div>Medallones extra <span class="muted">(máx. +2)</span></div>
          <div class="qtybox">
            <button id="patDec">-</button>
            <span id="patVal">0</span>
            <button id="patInc">+</button>
          </div>
        </div>

        <div class="rowx" id="rowCheddar" style="display:none">
          <div>Fetas de cheddar extra <span class="muted" id="cheHint">(máx. +3)</span></div>
          <div class="qtybox">
            <button id="cheDec">-</button>
            <span id="cheVal">0</span>
            <button id="cheInc">+</button>
          </div>
        </div>

        <div class="muted" id="noExtras" style="display:none">Este producto no admite extras.</div>
      </div>

      <div class="rowx" style="align-items:flex-start; flex-direction:column">
        <label>Notas (opcional)</label>
        <textarea id="notes" placeholder="Sin cebolla, extra salsa, etc."></textarea>
      </div>

      <div class="rowx" style="justify-content:flex-end">
        <button class="btn ghost" id="btnCancel">Cancelar</button>
        <button class="btn primary" id="btnAdd">Agregar al carrito</button>
      </div>
    </div>
  </div>

  <script>
    /* === Datos y utilidades (exactos a los que ya venías usando) === */
    const EXTRA_PRICE_PATTY=0, EXTRA_PRICE_CHEDDAR=0;

    const BURGERS=[ /* … (usa los mismos objetos que ya tenías) … */ 
      { id:"bigjohn_simple",  name:"Big John Simple",     price:10900, img:"images/Big John Simple.jpg",   kind:"simple",  desc:"Incluye papas fritas." },
      { id:"bigjohn_doble",   name:"Big John Doble",      price:13900, img:"images/Big John Doble.jpg",    kind:"double",  desc:"Incluye papas fritas." },
      { id:"burguesa_simple", name:"Burguesa Simple",     price:11900, img:"images/Burguesa Simple.jpg",   kind:"simple",  desc:"Incluye papas fritas." },
      { id:"burguesa_doble",  name:"Burguesa Doble",      price:14900, img:"images/Burguesa Doble.jpg",    kind:"double",  desc:"Incluye papas fritas." },
      { id:"cheesebacon_spl", name:"CheeseBacon Simple",  price:10500, img:"images/CheeseBacon Simple.jpg",kind:"simple",  desc:"Incluye papas fritas." },
      { id:"cheesebacon_dbl", name:"CheeseBacon Doble",   price:13500, img:"images/CheeseBacon Doble.jpg", kind:"double",  desc:"Incluye papas fritas." },
      { id:"cheese_simple",   name:"Cheeseburger Simple", price:9500,  img:"images/cheeseburger simple.jpg",kind:"simple",  desc:"Incluye papas fritas." },
      { id:"cheese_doble",    name:"Cheeseburger Doble",  price:12500, img:"images/cheeseburger doble.jpg",kind:"double",  desc:"Incluye papas fritas." },
      { id:"rhodes_simple",   name:"Rhodes Simple",       price:11900, img:"images/Rhodes Simple.jpg",     kind:"simple",  desc:"Incluye papas fritas." },
      { id:"rhodes_doble",    name:"Rhodes Doble",        price:14900, img:"images/Rhodes Doble.jpg",      kind:"double",  desc:"Incluye papas fritas." },
      { id:"morgan_simple",   name:"Morgan Simple",       price:10900, img:"images/Morgan Simple.jpg",     kind:"simple",  desc:"Incluye papas fritas." },
      { id:"morgan_doble",    name:"Morgan Doble",        price:14500, img:"images/Morgan Doble.jpg",      kind:"double",  desc:"Incluye papas fritas." },
      { id:"pollo_crispy",    name:"Pollo Crispy",        price:8900,  img:"images/Pollo crispy.jpg",      kind:"chicken", desc:"Incluye papas fritas." }
    ];
    const DRINKS=[
      { id:"coca_org",  name:"Coca-Cola Original 500ml", price:0, img:"images/coca cola original.jpg" },
      { id:"coca_zero", name:"Coca-Cola Zero 500ml",     price:0, img:"images/coca cola zero.jpg" },
      { id:"sprite",    name:"Sprite 500ml",             price:0, img:"images/sprite.jpg" },
      { id:"aqu_pear",  name:"Aquarius Limonada 500ml",  price:0, img:"images/aquarius pera.jpg" },
      { id:"aqu_pome",  name:"Aquarius Pomelo 500ml",    price:0, img:"images/aquarius pomelo.jpg" }
    ];
    const FALLBACK_IMG="images/logo.png", CART_KEY="rhodes_cart_v3";

    const $=s=>document.querySelector(s);
    const money=n=>n.toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});

    let cart=loadCart();
    function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY))||{burger:{},drink:{},fries:null}; }catch{ return {burger:{},drink:{},fries:null}; } }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    function cartCount(){ let n=0; for(const b of Object.values(cart.burger)) n+=b.qty; for(const d of Object.values(cart.drink)) n+=d.qty; return n; }
    function calcTotal(){ let t=0;
      for(const b of Object.values(cart.burger)){ const base=(b.item?.price||0), ex=(b.extras?.patty||0)*EXTRA_PRICE_PATTY+(b.extras?.cheddar||0)*EXTRA_PRICE_CHEDDAR; t+=(base+ex)*b.qty; }
      for(const d of Object.values(cart.drink)) t+=(d.item?.price||0)*d.qty; return t; }

    // Persistencia de papas (no obligatorias acá)
    if(cart.fries){ const r=document.querySelector(`input[name="papas"][value="${cart.fries}"]`); if(r) r.checked=true; }
    document.addEventListener("change",(e)=>{ if(e.target?.name==="papas"){ cart.fries=e.target.value; saveCart(); } });

    const gridBurgers=$("#burgersGrid"), gridDrinks=$("#drinksGrid");
    function renderCard(item,type){
      const card=document.createElement("div"); card.className="card";
      card.innerHTML=`
        <img src="${encodeURI(item.img)}" alt="${item.name}" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'">
        <div class="content">
          <h3>${item.name}</h3>
          ${item.desc?`<p class="muted" style="margin:4px 0 0">${item.desc}</p>`:""}
          <div class="row">
            <span class="price">${money(item.price)}</span>
            <div class="actions">
              ${type==="drink"
                ? `<button class="btn" data-add>Agregar</button>`
                : `<button class="btn" data-quick>Agregar</button>
                   <button class="btn" data-custom>Personalizar</button>`}
            </div>
          </div>
        </div>`;
      if(type==="drink"){ card.querySelector("[data-add]").onclick=()=>quickAddDrink(item); }
      else{ card.querySelector("[data-quick]").onclick=()=>quickAddBurger(item); card.querySelector("[data-custom]").onclick=()=>openCustomize(item); }
      return card;
    }
    function mount(){
      gridBurgers.innerHTML=""; BURGERS.forEach(b=>gridBurgers.appendChild(renderCard(b,"burger")));
      gridDrinks.innerHTML="";  DRINKS.forEach(d=>gridDrinks.appendChild(renderCard(d,"drink")));
      renderCart();
    }

    // Quick add SIN exigir papas
    function quickAddBurger(item){
      const b=cart.burger||(cart.burger={}); if(!b[item.id]) b[item.id]={qty:0,item,extras:{patty:0,cheddar:0}}; b[item.id].qty+=1;
      saveCart(); renderCart(); openDrawer();
    }
    function quickAddDrink(item){
      const d=cart.drink||(cart.drink={}); if(!d[item.id]) d[item.id]={qty:0,item}; d[item.id].qty+=1;
      saveCart(); renderCart(); openDrawer();
    }

    // Drawer
    const drawer=$("#drawer"), cartItems=$("#cartItems"), cartTotal=$("#cartTotal");
    function renderCart(){
      cartItems.innerHTML="";
      for(const o of Object.values(cart.burger)){
        const ex=[]; if(o.extras){ if(o.extras.patty) ex.push(`+${o.extras.patty} medallón(es)`); if(o.extras.cheddar) ex.push(`+${o.extras.cheddar} cheddar`); }
        const unit=o.item.price+(o.extras?.patty||0)*EXTRA_PRICE_PATTY+(o.extras?.cheddar||0)*EXTRA_PRICE_CHEDDAR;
        cartItems.innerHTML+=`
          <div class="item">
            <div>
              <strong>${o.item.name}</strong>
              ${ex.length?`<div class="muted">${ex.join(" · ")}</div>`:""}
              ${o.notes?`<div class="muted">Notas: ${o.notes}</div>`:""}
            </div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('burger','${o.item.id}',-1)">-</button>
              <span>${o.qty}</span>
              <button class="btn ghost" onclick="changeQty('burger','${o.item.id}',1)">+</button>
              <span>${money(unit*o.qty)}</span>
            </div>
          </div>`;
      }
      for(const o of Object.values(cart.drink)){
        cartItems.innerHTML+=`
          <div class="item">
            <div><strong>${o.item.name}</strong></div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('drink','${o.item.id}',-1)">-</button>
              <span>${o.qty}</span>
              <button class="btn ghost" onclick="changeQty('drink','${o.item.id}',1)">+</button>
              <span>${money(o.item.price*o.qty)}</span>
            </div>
          </div>`;
      }
      cartTotal.textContent=money(calcTotal());
      document.getElementById("btnCart").innerHTML=`Ver pedido <span class="muted">(${cartCount()})</span>`;
    }
    function changeQty(type,id,delta){
      const b=cart[type]; if(!b) return;
      const cur=b[id]?.qty||0, next=Math.max(0,cur+delta);
      if(next===0) delete b[id]; else b[id].qty=next;
      saveCart(); renderCart();
    }

    // Modal
    const overlay=$("#overlay"), modTitle=$("#modTitle");
    const qtyVal=$("#qtyVal"), qtyInc=$("#qtyInc"), qtyDec=$("#qtyDec");
    const rowPatties=$("#rowPatties"), rowCheddar=$("#rowCheddar"), noExtras=$("#noExtras"), cheHint=$("#cheHint");
    const patVal=$("#patVal"), patInc=$("#patInc"), patDec=$("#patDec");
    const cheVal=$("#cheVal"), cheInc=$("#cheInc"), cheDec=$("#cheDec");
    const notes=$("#notes"), btnAdd=$("#btnAdd"), btnCancel=$("#btnCancel");
    let currentItem=null;
    function openCustomize(item){
      currentItem=item; modTitle.textContent="Personalizar: "+item.name;
      qtyVal.textContent="1"; notes.value=""; patVal.textContent="0"; cheVal.textContent="0";
      if(item.kind==="double"){ rowPatties.style.display="flex"; rowCheddar.style.display="flex"; cheHint.textContent="(máx. +3)"; noExtras.style.display="none"; }
      else if(item.kind==="chicken"){ rowPatties.style.display="none"; rowCheddar.style.display="flex"; cheHint.textContent="(máx. +3)"; noExtras.style.display="none"; }
      else{ rowPatties.style.display="none"; rowCheddar.style.display="none"; noExtras.style.display="block"; }
      overlay.classList.add("open");
    }
    function closeCustomize(){ overlay.classList.remove("open"); }
    qtyInc.onclick=()=>qtyVal.textContent=String(Math.min(99,(+qtyVal.textContent||1)+1));
    qtyDec.onclick=()=>qtyVal.textContent=String(Math.max(1,(+qtyVal.textContent||1)-1));
    patInc.onclick=()=>{ if(+patVal.textContent<2) patVal.textContent=(+patVal.textContent)+1; };
    patDec.onclick=()=>{ if(+patVal.textContent>0) patVal.textContent=(+patVal.textContent)-1; };
    cheInc.onclick=()=>{ if(+cheVal.textContent<3) cheVal.textContent=(+cheVal.textContent)+1; };
    cheDec.onclick=()=>{ if(+cheVal.textContent>0) cheVal.textContent=(+cheVal.textContent)-1; };
    btnCancel.onclick=closeCustomize;
    btnAdd.onclick=()=>{
      const qty=+qtyVal.textContent||1, extras={patty:0,cheddar:0};
      if(currentItem.kind==="double"){ extras.patty=+patVal.textContent||0; extras.cheddar=+cheVal.textContent||0; }
      else if(currentItem.kind==="chicken"){ extras.cheddar=+cheVal.textContent||0; }
      const txt=notes.value.trim();
      const bucket=cart.burger||(cart.burger={}); const prev=bucket[currentItem.id];
      if(prev){ prev.qty+=qty; prev.extras={ patty:Math.max(prev.extras?.patty||0,extras.patty), cheddar:Math.max(prev.extras?.cheddar||0,extras.cheddar) }; if(txt) prev.notes=txt; }
      else{ bucket[currentItem.id]={qty, item:currentItem, extras, ...(txt?{notes:txt}:{})}; }
      saveCart(); renderCart(); closeCustomize(); openDrawer();
    };

    // Navegación
    function openDrawer(){ drawer.classList.add("open"); }
    function closeDrawer(){ drawer.classList.remove("open"); }
    document.getElementById("btnCart").onclick=openDrawer;
    document.getElementById("closeDrawer").onclick=closeDrawer;
    document.getElementById("btnVaciar").onclick=()=>{ cart={burger:{},drink:{},fries:null}; saveCart(); renderCart(); };
    document.getElementById("btnIrPagar").onclick=()=>{
      if(!cart.fries){ alert("Elegí una opción de papas (Con sazón o Sin sazonar) para continuar."); return; }
      window.location.href="pedido_cliente.html";
    };
    document.getElementById("btnContacto").onclick=()=>window.location.href="contacto.html";

    mount();
  </script>
</body>
</html>
