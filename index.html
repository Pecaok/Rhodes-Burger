<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rhodes Burgers - Menú</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{
      --primary:#2ecc71; --text:#111; --muted:#666; --bg:#f6f6f6; --card:#fff;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08); --ring:#eaeaea;
      --ok:#2ecc71; --warn:#ffb74d; --danger:#d32f2f;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}

    /* ====== HEADER ====== */
    header{position:sticky;top:0;z-index:20;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .topbar{max-width:1100px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
    .brand img{width:40px;height:40px;border-radius:10px;background:#fff;object-fit:contain}
    .brand strong{font-size:18px}
    .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;border:2px solid var(--primary);padding:10px 16px;border-radius:999px;color:var(--primary);background:#fff;font-weight:700;text-decoration:none;cursor:pointer}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn.ghost{border-color:#e7e7e7;color:#333}
    .btn[disabled], .btn.disabled{opacity:.65;cursor:not-allowed;filter:grayscale(.2)}

    /* Píldoras de estado */
    .pill{display:inline-flex;align-items:center;gap:8px;border:2px solid;border-radius:999px;padding:6px 10px;font-weight:800;line-height:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:48vw}
    .pill.ok{border-color:var(--ok);color:var(--ok);background:#e8f8ef}
    .pill.bad{border-color:#bbb;color:#555;background:#f5f5f5}
    .pill.eta{border-color:#b3e5c5;color:#0b7a3a;background:#eefcf4}

    /* ====== CONTENIDO ====== */
    .container{max-width:1100px;margin:24px auto;padding:0 12px}
    h1{font-size:clamp(24px,6vw,34px);margin:14px 4px 18px}
    h2{font-size:clamp(20px,5vw,26px);margin:22px 4px 14px}
    h3{font-size:clamp(16px,4.2vw,18px);margin:8px 0 6px}
    p{margin:6px 0;color:var(--muted)}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:18px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:0;overflow:hidden;display:flex;flex-direction:column}
    .card .media{width:100%;background:#f0f0f0}
    .card .media img{width:100%;height:auto;display:block;aspect-ratio:16/9;object-fit:cover}
    .card .content{padding:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:8px}
    .price{font-weight:800}
    .actions{display:flex;gap:8px;flex-wrap:nowrap}
    .actions .btn{flex:1;min-width:0;padding:10px 12px}

    /* ====== DRAWER CARRITO ====== */
    .drawer{position:fixed;top:0;right:-460px;width:460px;max-width:92vw;height:100vh;background:#fff;box-shadow:-8px 0 30px rgba(0,0,0,.18);transition:right .25s;z-index:30;display:flex;flex-direction:column}
    .drawer.open{right:0}
    .drawer header{padding:12px 14px;box-shadow:0 2px 12px rgba(0,0,0,.06);display:flex;align-items:center;gap:8px}
    .drawer .body{padding:12px 14px;overflow:auto;flex:1}
    .item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 0;border-bottom:1px solid #efefef}
    .total{display:flex;align-items:center;justify-content:space-between;font-weight:800;font-size:18px;margin-top:10px}
    .cart-actions{margin-top:12px;display:flex;gap:10px}
    .etaBox{margin-top:10px;padding:8px 10px;border:1px dashed var(--ring);border-radius:10px;font-size:14px;color:#0b7a3a;background:#f7fff9;display:flex;align-items:center;gap:10px;flex-wrap:wrap}

    /* ====== MODAL ====== */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.25);display:none;align-items:center;justify-content:center;z-index:40}
    .overlay.open{display:flex}
    .modal{background:#fff;border-radius:20px;box-shadow:var(--shadow);width:580px;max-width:92vw;padding:16px}
    .modal h3{margin:0 0 8px}
    .rowx{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:12px 0}
    .qtybox{display:inline-flex;align-items:center;gap:10px;border:1px solid var(--ring);border-radius:999px;padding:6px 10px}
    .qtybox button{width:28px;height:28px;border:1px solid #e5e5e5;background:#fff;border-radius:999px;font-weight:900;cursor:pointer}
    textarea{width:100%;min-height:80px;padding:10px;border:1px solid var(--ring);border-radius:12px}
    .muted{color:var(--muted);font-size:14px}
    .inline{display:flex;gap:12px;flex-wrap:wrap}
    .pillOpt{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--ring);border-radius:999px;padding:8px 12px;cursor:pointer}
    .pillOpt input{accent-color:var(--primary)}
    .micro{font-size:12px;color:var(--muted)}

    /* ====== MOBILE TUNING ====== */
    @media (max-width:640px){
      .topbar{gap:8px;padding:8px 10px}
      .brand img{width:32px;height:32px}
      .brand strong{font-size:16px}
      .btn{padding:8px 12px;font-size:14px}
      .pill{font-size:12px;padding:6px 8px;max-width:56vw}
      #etaPill{display:none} /* ocultamos la ETA larga en header para no romper layout */
      .grid{gap:14px}
      .card .content{padding:12px}
      .actions .btn{padding:9px 10px}
      .drawer .body{padding-bottom:120px}
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="index.html" class="brand">
        <img src="images/logo.png" alt="Rhodes Burgers" />
        <strong>Rhodes Burgers</strong>
      </a>

      <!-- Estado de apertura + ETA (compacto) -->
      <span id="openPill" class="pill bad">Cargando horarios…</span>
      <span id="etaPill" class="pill eta" style="display:none">—</span>

      <div class="spacer"></div>
      <a class="btn ghost" href="contacto.html">Contacto</a>
      <button class="btn primary" id="btnCart">Ver pedido <span id="cartBubble" class="muted">(0)</span></button>
    </div>
  </header>

  <main class="container">
    <h1>Menú</h1>

    <h2>Hamburguesas</h2>
    <div id="burgersGrid" class="grid"></div>

    <h2>Bebidas</h2>
    <div id="drinksGrid" class="grid"></div>
  </main>

  <!-- Drawer Carrito -->
  <aside class="drawer" id="drawer">
    <header>
      <strong>Tu pedido</strong>
      <span id="openHint" class="pill bad" style="margin-left:8px">—</span>
      <button class="btn ghost" id="closeDrawer" style="margin-left:auto">✕</button>
    </header>
    <div class="body">
      <div id="cartItems"></div>
      <div class="total">
        <span>Total</span>
        <span id="cartTotal">$0</span>
      </div>

      <div id="etaBox" class="etaBox" style="display:none">
        <strong id="etaText">Si pedís ahora: —</strong>
        <span id="queueText" class="muted">—</span>
      </div>

      <div class="cart-actions">
        <button class="btn ghost" id="btnVaciar">Vaciar</button>
        <a class="btn primary" href="pedido_cliente.html" id="goCheckout">Ir a pagar</a>
      </div>
    </div>
  </aside>

  <!-- Modal Personalizar / Agregar -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h3 id="modTitle">Personalizar</h3>

      <div class="rowx">
        <div class="muted">Cantidad</div>
        <div class="qtybox">
          <button id="qtyDec">-</button>
          <span id="qtyVal">1</span>
          <button id="qtyInc">+</button>
        </div>
      </div>

      <!-- Papas obligatorio -->
      <div class="rowx" style="align-items:flex-start;flex-direction:column">
        <div class="muted" style="font-weight:600">Papas (obligatorio)</div>
        <div class="inline">
          <label class="pillOpt"><input type="radio" name="fries" value="con_sazon"> Con sazón</label>
          <label class="pillOpt"><input type="radio" name="fries" value="sin_sazon"> Sin sazonar</label>
        </div>
        <div class="micro">Elegí el tipo de papas para esta hamburguesa.</div>
      </div>

      <div class="rowx" id="rowPatties" style="display:none">
        <div>Medallones extra <span class="muted" id="pattiesInfo"></span></div>
        <div class="qtybox">
          <button id="patDec">-</button>
          <span id="patVal">0</span>
          <button id="patInc">+</button>
        </div>
      </div>

      <div class="rowx" id="rowCheddar" style="display:none">
        <div>Fetas de cheddar extra <span class="muted" id="cheInfo"></span></div>
        <div class="qtybox">
          <button id="cheDec">-</button>
          <span id="cheVal">0</span>
          <button id="cheInc">+</button>
        </div>
      </div>

      <div class="muted" id="noExtras" style="display:none">Este producto no admite extras.</div>

      <div class="rowx" style="align-items:flex-start;flex-direction:column">
        <label>Notas (opcional)</label>
        <textarea id="notes" placeholder="Sin cebolla, extra salsa, etc."></textarea>
      </div>

      <div class="rowx" style="justify-content:flex-end">
        <button class="btn ghost" id="btnCancel">Cancelar</button>
        <button class="btn primary" id="btnAdd">Agregar al carrito</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
      authDomain: "rhodes-burguers.firebaseapp.com",
      projectId: "rhodes-burguers",
      storageBucket: "rhodes-burguers.firebasestorage.app",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    window.ensureAuthReady = new Promise((resolve)=>{
      firebase.auth().onAuthStateChanged(async (user)=>{
        try{ if(!user) await firebase.auth().signInAnonymously(); }
        catch(e){ console.error("Auth anónimo:", e); }
        finally{ window.db = firebase.firestore(); resolve(); }
      });
    });
  </script>

  <script>
  window.ensureAuthReady.then(()=>{

    /* ====== PRECIOS EXTRAS ====== */
    const EXTRA_PRICE_PATTY   = 1600;
    const EXTRA_PRICE_CHEDDAR = 300;

    /* ====== MENÚ ====== */
    const BURGERS = [
      { id:"bigjohn_simple",name:"Big John Simple",price:10900,img:"images/Big John Simple.jpg",kind:"simple",desc:"Medallón con cheddar, lechuga, pepinillos y salsa Big Mac en pan brioche. Incluye papas fritas." },
      { id:"bigjohn_doble",name:"Big John Doble",price:13900,img:"images/Big John Doble.jpg",kind:"double",desc:"Doble Medallón con cheddar, lechuga, pepinillos y salsa Big Mac en pan brioche. Incluye papas fritas." },
      { id:"burguesa_simple",name:"Burguesa Simple",price:11900,img:"images/Burguesa Simple.jpg",kind:"simple",desc:"Medallón con doble cheddar, salsa mostaza y miel y cebolla caramelizada en pan Burgerluna. Incluye papas fritas." },
      { id:"burguesa_doble",name:"Burguesa Doble",price:14900,img:"images/Burguesa Doble.jpg",kind:"double",desc:"Doble Medallón con doble cheddar, salsa mostaza y miel y cebolla caramelizada en pan Burgerluna. Incluye papas fritas." },
      { id:"cheesebacon_spl",name:"CheeseBacon Simple",price:10500,img:"images/CheeseBacon Simple.jpg",kind:"simple",desc:"Medallón con doble cheddar y bacon en pan brioche. Incluye papas fritas." },
      { id:"cheesebacon_dbl",name:"CheeseBacon Doble",price:13500,img:"images/CheeseBacon Doble.jpg",kind:"double",desc:"Doble Medallón con doble cheddar y bacon en pan brioche. Incluye papas fritas." },
      { id:"cheese_simple",name:"Cheeseburger Simple",price:9500,img:"images/cheeseburger simple.jpg",kind:"simple",desc:"Medallón con doble cheddar en pan brioche. Incluye papas fritas." },
      { id:"cheese_doble",name:"Cheeseburger Doble",price:12500,img:"images/cheeseburger doble.jpg",kind:"double",desc:"Doble Medallón con doble cheddar en pan brioche. Incluye papas fritas." },
      { id:"rhodes_simple",name:"Rhodes Simple",price:11900,img:"images/Rhodes Simple.jpg",kind:"simple",desc:"Medallón con doble cheddar, bacon, morrones, cebolla y salsa spicy en pan brioche. Incluye papas fritas." },
      { id:"rhodes_doble",name:"Rhodes Doble",price:14900,img:"images/Rhodes Doble.jpg",kind:"double",desc:"Doble Medallón con doble cheddar, bacon, morrones, cebolla y salsa spicy en pan brioche. Incluye papas fritas." },
      { id:"morgan_simple",name:"Morgan Simple",price:10900,img:"images/Morgan Simple.jpg",kind:"simple",desc:"Medallón con doble cheddar, bacon, salsa barbacoa y cebolla crispy en pan brioche. Incluye papas fritas." },
      { id:"morgan_doble",name:"Morgan Doble",price:14500,img:"images/Morgan Doble.jpg",kind:"double",desc:"Doble Medallón con doble cheddar, bacon, salsa barbacoa y cebolla crispy en pan brioche. Incluye papas fritas." },
      { id:"pollo_crispy",name:"Pollo Crispy",price:8900,img:"images/Pollo crispy.jpg",kind:"chicken",desc:"Pechuga de pollo crispy con lechuga y mayonesa en pan brioche. Incluye papas fritas." }
    ];
    const DRINKS = [
      { id:"coca_org",  name:"Coca-Cola Original 500ml", price:3000, img:"images/coca cola original.jpg" },
      { id:"coca_zero", name:"Coca-Cola Zero 500ml",     price:3000, img:"images/coca cola zero.jpg" },
      { id:"sprite",    name:"Sprite 500ml",             price:3000, img:"images/sprite.jpg" },
      { id:"aquarius_pera",  name:"Aquarius Pera 500ml", price:3000, img:"images/aquarius pera.jpg" },
      { id:"aquarius_pomelo", name:"Aquarius Pomelo",    price:3000, img:"images/aquarius pomelo.jpg" }
    ];
    const FALLBACK_IMG = "images/logo.png";
    const CART_KEY = "rhodes_cart_v3";

    /* ====== UTIL ====== */
    const $ = s => document.querySelector(s);
    const money = n => (Number(n)||0).toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});
    const uid = () => (Date.now().toString(36)+Math.random().toString(36).slice(2,7)).toUpperCase();
    const toMin = hhmm => { if(!hhmm) return null; const m=String(hhmm).trim().replace('.',':'); const [h,mi]=m.split(':'); const H=parseInt(h,10), M=parseInt(mi||'0',10); if(isNaN(H)||isNaN(M)) return null; return H*60+M; };

    /* ====== HORARIOS Desde contacto.html ====== */
    let SCHEDULE = null; // {0..6:[{start,end}]}

    const DAYMAP = {"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"domingo":0,"dom":0,"lunes":1,"lun":1,"martes":2,"mar":2,"miércoles":3,"miercoles":3,"mié":3,"mie":3,"jueves":4,"jue":4,"viernes":5,"vie":5,"sábado":6,"sabado":6,"sáb":6,"sab":6};

    function parseScheduleJSON(obj){
      const out = {0:[],1:[],2:[],3:[],4:[],5:[],6:[]};
      for (const [k,v] of Object.entries(obj||{})){
        const day = DAYMAP[String(k).toLowerCase()];
        if (day==null) continue;
        const arr = Array.isArray(v)? v : [];
        out[day] = arr.map(s=>{
          const a=toMin(s.start), b=toMin(s.end);
          if(a==null||b==null) return null;
          return {start: `${String(Math.floor(a/60)).padStart(2,'0')}:${String(a%60).padStart(2,'0')}`,
                  end:   `${String(Math.floor(b/60)).padStart(2,'0')}:${String(b%60).padStart(2,'0')}`};
        }).filter(Boolean);
      }
      return out;
    }
    async function loadScheduleFromContacto(){
      try{
        const res = await fetch('contacto.html',{cache:'no-store'});
        if(res.ok){
          const html = await res.text();
          const doc = new DOMParser().parseFromString(html,'text/html');
          const tag = doc.querySelector('#opening-hours[type="application/json"]');
          if(tag) return parseScheduleJSON(JSON.parse(tag.textContent));
        }
      }catch(_){}
      // Fallback si no existe el bloque
      return parseScheduleJSON({
        "miércoles":[{"start":"19:00","end":"23:30"}],
        "jueves":[{"start":"19:00","end":"23:30"}],
        "viernes":[{"start":"12:00","end":"15:00"},{"start":"19:00","end":"23:30"}],
        "sábado":[{"start":"12:00","end":"15:00"},{"start":"19:00","end":"23:30"}],
        "domingo":[{"start":"19:00","end":"23:00"}]
      });
    }
    function isOpenNow(d=new Date()){
      if(!SCHEDULE) return false;
      const day=d.getDay(), mins=d.getHours()*60+d.getMinutes();
      return (SCHEDULE[day]||[]).some(({start,end})=>{
        const a=toMin(start), b=toMin(end);
        return (a!=null&&b!=null && mins>=a && mins<b);
      });
    }
    function nextOpenInfo(d=new Date()){
      if(!SCHEDULE) return null;
      const dayNow=d.getDay(), minsNow=d.getHours()*60+d.getMinutes();
      for(let i=0;i<7;i++){
        const day=(dayNow+i)%7;
        for(const {start} of (SCHEDULE[day]||[])){
          const s=toMin(start); if(s==null) continue;
          if(i===0 && s<=minsNow) continue;
          const when=new Date(d); when.setDate(d.getDate()+i); when.setHours(Math.floor(s/60), s%60,0,0);
          return when;
        }
      }
      return null;
    }
    const fmtTime = d => d.toLocaleTimeString('es-AR',{hour:'2-digit',minute:'2-digit'});

    /* ====== CARRITO ====== */
    let cart = loadCart();
    function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)) || {burger:{},drink:{}}; }catch{ return {burger:{},drink:{}}; } }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    function cartCount(){ let n=0; for(const b of Object.values(cart.burger||{})) n+=b.qty||0; for(const d of Object.values(cart.drink||{})) n+=d.qty||0; return n; }
    function calcTotal(){
      let t=0;
      for(const obj of Object.values(cart.burger||{})){
        const base=(obj.item?.price||0);
        const ep=(obj.extras?.patty||0)*(obj.extras?.EXTRA_PRICE_PATTY??EXTRA_PRICE_PATTY);
        const ec=(obj.extras?.cheddar||0)*(obj.extras?.EXTRA_PRICE_CHEDDAR??EXTRA_PRICE_CHEDDAR);
        t += (base+ep+ec)*(obj.qty||0);
      }
      for(const d of Object.values(cart.drink||{})) t += (d.item?.price||0)*(d.qty||0);
      return t;
    }

    /* ====== RENDER MENÚ ====== */
    const gridBurgers = $("#burgersGrid"), gridDrinks = $("#drinksGrid");
    function renderCard(item,type){
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <div class="media"><img src="${encodeURI(item.img)}" alt="${item.name}" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'"></div>
        <div class="content">
          <h3>${item.name}</h3>
          ${item.desc?`<p class="muted" style="margin:4px 0 0">${item.desc}</p>`:""}
          <div class="row">
            <span class="price">${money(item.price)}</span>
            <div class="actions">
              <button class="btn" data-add>Agregar</button>
              ${type==="burger"?`<button class="btn" data-custom>Personalizar</button>`:""}
            </div>
          </div>
        </div>`;
      if(type==="drink"){
        card.querySelector("[data-add]").onclick = ()=> addDrink(item);
      }else{
        card.querySelector("[data-add]").onclick  = ()=> openCustomize(item);
        card.querySelector("[data-custom]").onclick = ()=> openCustomize(item);
      }
      return card;
    }
    function mount(){
      gridBurgers.innerHTML=""; BURGERS.forEach(b=>gridBurgers.appendChild(renderCard(b,"burger")));
      gridDrinks.innerHTML="";  DRINKS.forEach(d=>gridDrinks.appendChild(renderCard(d,"drink")));
      renderCart();
    }

    /* ====== DRAWER ====== */
    const drawer=$("#drawer"), cartItems=$("#cartItems"), cartTotal=$("#cartTotal");
    function openDrawer(){ drawer.classList.add("open"); }
    function closeDrawer(){ drawer.classList.remove("open"); }
    document.getElementById("btnCart").onclick = openDrawer;
    document.getElementById("closeDrawer").onclick = closeDrawer;
    document.getElementById("btnVaciar").onclick = ()=>{ cart={burger:{},drink:{}}; saveCart(); renderCart(); };

    function renderCart(){
      cartItems.innerHTML="";
      for(const [key,obj] of Object.entries(cart.burger||{})){
        const extrasTxt=[]; if(obj.extras?.patty) extrasTxt.push(`+${obj.extras.patty} medallón(es)`); if(obj.extras?.cheddar) extrasTxt.push(`+${obj.extras.cheddar} cheddar`);
        const unit=(obj.item?.price||0)+(obj.extras?.patty||0)*(obj.extras?.EXTRA_PRICE_PATTY??EXTRA_PRICE_PATTY)
                                   +(obj.extras?.cheddar||0)*(obj.extras?.EXTRA_PRICE_CHEDDAR??EXTRA_PRICE_CHEDDAR);
        cartItems.insertAdjacentHTML('beforeend',`
          <div class="item">
            <div>
              <strong>${obj.item?.name||""}</strong>
              <div class="muted">Papas: ${obj.fries==="con_sazon"?"Con sazón":"Sin sazonar"}</div>
              ${extrasTxt.length?`<div class="muted">${extrasTxt.join(" · ")}</div>`:""}
              ${obj.notes?`<div class="muted">Notas: ${obj.notes}</div>`:""}
            </div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('burger','${key}',-1)">-</button>
              <span>${obj.qty||0}</span>
              <button class="btn ghost" onclick="changeQty('burger','${key}',1)">+</button>
              <span>${money(unit*(obj.qty||0))}</span>
            </div>
          </div>`);
      }
      for(const [key,obj] of Object.entries(cart.drink||{})){
        cartItems.insertAdjacentHTML('beforeend',`
          <div class="item">
            <div><strong>${obj.item?.name||""}</strong></div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('drink','${key}',-1)">-</button>
              <span>${obj.qty||0}</span>
              <button class="btn ghost" onclick="changeQty('drink','${key}',1)">+</button>
              <span>${money((obj.item?.price||0)*(obj.qty||0))}</span>
            </div>
          </div>`);
      }
      cartTotal.textContent = money(calcTotal());
      document.getElementById("cartBubble").textContent = `(${cartCount()})`;
      updateETAView();
    }
    window.changeQty = function(type,key,delta){
      const bucket = cart[type]; if(!bucket) return;
      const cur=bucket[key]?.qty||0, next=Math.max(0, cur+delta);
      if(next===0) delete bucket[key]; else bucket[key].qty = next;
      saveCart(); renderCart();
    };

    function addDrink(item){
      const key=item.id+'_'+uid();
      const bucket=cart.drink||(cart.drink={});
      bucket[key] = { qty:1, item:{id:item.id,name:item.name,price:item.price} };
      saveCart(); renderCart();
    }

    /* ====== MODAL ====== */
    const overlay=$("#overlay"), modTitle=$("#modTitle");
    const qtyVal=$("#qtyVal"), qtyInc=$("#qtyInc"), qtyDec=$("#qtyDec");
    const rowPatties=$("#rowPatties"), rowCheddar=$("#rowCheddar"), noExtras=$("#noExtras");
    const patVal=$("#patVal"), patInc=$("#patInc"), patDec=$("#patDec");
    const cheVal=$("#cheVal"), cheInc=$("#cheInc"), cheDec=$("#cheDec");
    const notes=$("#notes"), btnAdd=$("#btnAdd"), btnCancel=$("#btnCancel");
    let currentItem=null;

    qtyInc.onclick = ()=> qtyVal.textContent = String(Math.min(99,(+qtyVal.textContent||1)+1));
    qtyDec.onclick = ()=> qtyVal.textContent = String(Math.max(1,(+qtyVal.textContent||1)-1));
    patInc.onclick = ()=> { const v=+patVal.textContent||0; if(v<2) patVal.textContent=v+1; };
    patDec.onclick = ()=> { const v=+patVal.textContent||0; if(v>0) patVal.textContent=v-1; };
    cheInc.onclick = ()=> { const v=+cheVal.textContent||0; if(v<3) cheVal.textContent=v+1; };
    cheDec.onclick = ()=> { const v=+cheVal.textContent||0; if(v>0) cheVal.textContent=v-1; };
    btnCancel.onclick = ()=> overlay.classList.remove("open");
    function resetFries(){ document.querySelectorAll('input[name="fries"]').forEach(r=>r.checked=false); }

    function openCustomize(item){
      currentItem=item; modTitle.textContent="Personalizar: "+item.name;
      qtyVal.textContent="1"; notes.value=""; patVal.textContent="0"; cheVal.textContent="0"; resetFries();
      const pi=document.getElementById("pattiesInfo"); const ci=document.getElementById("cheInfo");
      if (pi) pi.textContent = `( + ${money(EXTRA_PRICE_PATTY)} c/u, máx. +2 )`;
      if (ci) ci.textContent = `( + ${money(EXTRA_PRICE_CHEDDAR)} c/u, máx. +3 )`;
      if(item.kind==="double"){ rowPatties.style.display="flex"; rowCheddar.style.display="flex"; noExtras.style.display="none"; }
      else if(item.kind==="chicken"){ rowPatties.style.display="none"; rowCheddar.style.display="flex"; noExtras.style.display="none"; }
      else{ rowPatties.style.display="none"; rowCheddar.style.display="none"; noExtras.style.display="block"; }
      overlay.classList.add("open");
    }
    btnAdd.onclick = ()=>{
      const friesEl=document.querySelector('input[name="fries"]:checked');
      if(!friesEl){ alert("Elegí el tipo de papas para esta hamburguesa."); return; }
      const qty=+qtyVal.textContent||1;
      const extras={ patty:0, cheddar:0, EXTRA_PRICE_PATTY, EXTRA_PRICE_CHEDDAR };
      if(currentItem.kind==="double"){ extras.patty=+patVal.textContent||0; extras.cheddar=+cheVal.textContent||0; }
      else if(currentItem.kind==="chicken"){ extras.patty=0; extras.cheddar=+cheVal.textContent||0; }
      const txt=notes.value.trim();
      const bucket=cart.burger||(cart.burger={});
      const key=currentItem.id+'_'+uid();
      bucket[key]={ qty, item:{id:currentItem.id,name:currentItem.name,price:currentItem.price}, fries:friesEl.value, extras, ...(txt?{notes:txt}:{}) };
      saveCart(); renderCart(); overlay.classList.remove("open");
    };

    /* ====== UI de apertura + ETA ====== */
    const openPill = document.getElementById('openPill');
    const etaPill  = document.getElementById('etaPill');
    const openHint = document.getElementById('openHint');
    const goCheckout = document.getElementById('goCheckout');

    function updateOpenUI(){
      const open = isOpenNow();
      if (open){
        openPill.textContent = 'Abierto ahora';
        openPill.className = 'pill ok';
        openHint.textContent = 'Abierto ahora';
        openHint.className = 'pill ok';
        goCheckout.classList.remove('disabled'); goCheckout.removeAttribute('aria-disabled');
      }else{
        const next = nextOpenInfo();
        const whenTxt = next ? ((next.toDateString()===new Date().toDateString()) ? `abrimos hoy ${fmtTime(next)}` : `abrimos ${next.toLocaleDateString('es-AR')} ${fmtTime(next)}`) : 'cerrado';
        openPill.textContent = `Cerrado — ${whenTxt}`;
        openPill.className = 'pill bad';
        openHint.textContent = openPill.textContent;
        openHint.className = 'pill bad';
        goCheckout.classList.add('disabled'); goCheckout.setAttribute('aria-disabled','true');
      }
    }
    goCheckout.addEventListener('click', (e)=>{
      if (!isOpenNow()){
        e.preventDefault();
        alert('Estamos cerrados en este momento. Volvé a partir del horario de apertura 😊');
      }
    });

    // ETA + cola
    const BASE_MIN=12, PER_ORDER_MIN=4, ETA_MAX_EXTRA=8;
    const etaBox = document.getElementById('etaBox');
    const etaText= document.getElementById('etaText');
    const queueText=document.getElementById('queueText');
    let unsubscribeQueue=null;

    function startQueueListener(){
      try{ if(unsubscribeQueue) unsubscribeQueue(); }catch(_){}
      const q = db.collection('orders').orderBy('createdAt','desc').limit(200);
      unsubscribeQueue = q.onSnapshot((snap)=>{
        const ACTIVE = new Set(['accepted','pending_payment','in_prep','ready']);
        let queue=0; snap.forEach(doc=>{ const st=(doc.data()?.status)||''; if (ACTIVE.has(st)) queue++; });
        if (!isOpenNow()){ etaBox.style.display='none'; etaPill.style.display='none'; return; }
        const min = BASE_MIN + queue*PER_ORDER_MIN, max = min + ETA_MAX_EXTRA;
        etaText.textContent = `Si pedís ahora: ~ ${min}–${max} min`;
        queueText.textContent = `En cola: ${queue} pedido${queue===1?'':'s'}`;
        etaBox.style.display='flex';
        etaPill.textContent = `${min}–${max} min • ${queue} en cola`;
        etaPill.style.display='inline-flex';
      }, (_err)=>{ etaBox.style.display='none'; etaPill.style.display='none'; });
    }
    function updateETAView(){}

    /* ====== INIT ====== */
    async function init(){
      try{ SCHEDULE = await loadScheduleFromContacto(); }catch(_){ SCHEDULE = null; }
      mount();
      updateOpenUI();
      setInterval(updateOpenUI, 60*1000);
      startQueueListener();
    }
    init();
  });
  </script>

  <!-- Menú JSON (lo usa finanzas, etc.) -->
  <script id="menu-data" type="application/json">
  {
    "burgers": [
      { "id":"bigjohn_simple","name":"Big John Simple","price":10900 },
      { "id":"bigjohn_doble","name":"Big John Doble","price":13900 },
      { "id":"burguesa_simple","name":"Burguesa Simple","price":11900 },
      { "id":"burguesa_doble","name":"Burguesa Doble","price":14900 },
      { "id":"cheesebacon_spl","name":"CheeseBacon Simple","price":10500 },
      { "id":"cheesebacon_dbl","name":"CheeseBacon Doble","price":13500 },
      { "id":"cheese_simple","name":"Cheeseburger Simple","price":9500 },
      { "id":"cheese_doble","name":"Cheeseburger Doble","price":12500 },
      { "id":"rhodes_simple","name":"Rhodes Simple","price":11900 },
      { "id":"rhodes_doble","name":"Rhodes Doble","price":14900 },
      { "id":"morgan_simple","name":"Morgan Simple","price":10900 },
      { "id":"morgan_doble","name":"Morgan Doble","price":14500 },
      { "id":"pollo_crispy","name":"Pollo Crispy","price":8900 }
    ],
    "drinks": [
      { "id":"coca_org","name":"Coca-Cola Original 500ml","price":3000 },
      { "id":"coca_zero","name":"Coca-Cola Zero 500ml","price":3000 },
      { "id":"sprite","name":"Sprite 500ml","price":3000 },
      { "id":"aquarius_pera","name":"Aquarius Pera 500ml","price":3000 },
      { "id":"aquarius_pomelo","name":"Aquarius Pomelo","price":3000 }
    ]
  }
  </script>
</body>
</html>
