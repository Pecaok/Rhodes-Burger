<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rhodes Burgers - Men√∫</title>
  <link rel="icon" href="images/logo.png">

  <style>
    :root{
      --primary:#2ecc71; /* verde botones */
      --primary-700:#27ae60;
      --text:#111;
      --muted:#666;
      --bg:#f6f6f6;
      --card:#fff;
      --radius:18px;
      --shadow:0 10px 30px rgba(0,0,0,.08);
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}

    /* Marca de agua del logo */
    body::before{
      content:"";
      position:fixed; inset:0;
      background: url("images/logo.png") center 120px / 320px no-repeat;
      opacity:.06; pointer-events:none;
      z-index:0;
      filter:grayscale(100%);
    }

    header{
      position:sticky; top:0; z-index:10;
      background:#fff; box-shadow:0 2px 12px rgba(0,0,0,.06);
    }
    .topbar{
      max-width:1000px; margin:0 auto; padding:10px 12px; display:flex; align-items:center; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit;
    }
    .brand img{width:40px; height:40px; border-radius:10px; object-fit:contain; background:#fff}
    .spacer{flex:1}
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      border:2px solid var(--primary); padding:10px 16px; border-radius:999px;
      color:var(--primary); background:#fff; font-weight:700; text-decoration:none;
      transition:.15s transform ease, .15s box-shadow ease, .15s background ease;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(46,204,113,.25)}
    .btn.primary{background:var(--primary); color:#fff}
    .cart-badge{
      min-width:26px; height:26px; display:inline-flex; align-items:center; justify-content:center;
      background:#fff; color:var(--primary); border-radius:999px; padding:0 8px; font-weight:800;
    }

    main{position:relative; z-index:1}
    .container{max-width:1000px; margin:24px auto; padding:0 12px}

    h1{font-size:42px; margin:14px 4px 24px}
    h2{font-size:36px; margin:28px 4px 16px}
    h3{font-size:22px; margin:12px 0 6px}
    p{margin:6px 0; color:var(--muted)}

    /* Cards de hamburguesas */
    .grid{
      display:grid; gap:16px;
      grid-template-columns:repeat( auto-fill, minmax(230px,1fr) );
    }
    .card{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden;
      display:flex; flex-direction:column;
    }
    .card img{
      width:100%; height:160px; object-fit:cover; background:#f0f0f0;
    }
    .card .content{padding:12px}
    .price{font-weight:800}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:8px}

    .qty{
      display:flex; align-items:center; gap:8px; background:#fafafa; border-radius:999px; padding:6px 10px; border:1px solid #ececec;
    }
    .qty button{background:#fff; border:1px solid #e5e5e5; width:28px; height:28px; border-radius:999px; font-weight:900}
    .qty span{min-width:18px; text-align:center}

    /* Bloque Papas */
    .box{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:18px; margin:8px 0 16px;
    }
    .help{color:var(--muted); font-size:15px}

    /* Drawer del carrito */
    .drawer{
      position:fixed; top:0; right:-420px; width:420px; max-width:92vw; height:100vh;
      background:#fff; box-shadow:-8px 0 30px rgba(0,0,0,.18); transition:right .25s ease;
      z-index:30; display:flex; flex-direction:column;
    }
    .drawer.open{right:0}
    .drawer header{padding:14px 16px; box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .drawer .body{padding:14px 16px; overflow:auto; flex:1}
    .divider{height:1px; background:#eee; margin:12px 0}
    .item{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:8px 0}
    .total{display:flex; align-items:center; justify-content:space-between; font-size:18px; font-weight:800}
    .muted{color:var(--muted); font-size:14px}

    /* Bot√≥n flotante cerrar */
    .close{
      position:absolute; top:10px; right:10px; width:38px; height:38px; border-radius:999px; border:1px solid #eee; background:#fff; font-weight:900
    }

    /* Form contacto (abre WhatsApp) */
    .contacto small{display:block; color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="#" class="brand" id="goHome">
        <img src="images/logo.png" alt="Rhodes Burgers">
      </a>

      <div class="spacer"></div>

      <a class="btn" id="btnContacto">
        üìû Contacto
      </a>

      <a class="btn primary" id="btnCarrito">
        üõí Carrito <span class="cart-badge" id="cartCount">0</span>
      </a>
    </div>
  </header>

  <main>
    <div class="container">
      <h1>Men√∫</h1>

      <h2>Hamburguesas</h2>
      <div id="burgersGrid" class="grid"></div>

      <h2>Papas fritas <span class="muted">(obligatorio)</span></h2>
      <div class="box" role="group" aria-labelledby="papasTitle">
        <label style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
          <input type="radio" name="papas" value="con_sazon"> 
          <span>Papas fritas <b>con saz√≥n</b> <span class="muted">(sin costo)</span></span>
        </label>
        <label style="display:flex; align-items:center; gap:10px;">
          <input type="radio" name="papas" value="sin_sazon">
          <span>Papas fritas <b>sin sazonar</b> <span class="muted">(sin costo)</span></span>
        </label>
        <p class="help">Eleg√≠ una opci√≥n. La agregamos a tu pedido sin costo.</p>
      </div>

      <h2>Bebidas</h2>
      <div id="drinksGrid" class="grid"></div>
    </div>
  </main>

  <!-- Drawer Carrito -->
  <aside class="drawer" id="drawer">
    <header>
      <strong>Tu pedido</strong>
      <button class="close" id="closeDrawer">‚úï</button>
    </header>
    <div class="body">
      <div id="cartItems"></div>
      <div class="divider"></div>
      <div class="item">
        <span>Papas (obligatorio)</span>
        <span id="papasSummary" class="muted">Sin elegir</span>
      </div>
      <div class="divider"></div>
      <div class="total">
        <span>Total</span>
        <span id="cartTotal">$0</span>
      </div>

      <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap">
        <button class="btn" id="btnVaciar">Vaciar</button>
        <button class="btn primary" id="btnFinalizar">Finalizar pedido</button>
      </div>

      <p class="muted" style="margin-top:10px">Antes de finalizar, eleg√≠ las papas.</p>
    </div>
  </aside>

  <!-- Firebase (opcional: completa tu config para guardar en Firestore) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    /***********************
     * 1) CONFIGURACI√ìN
     ***********************/
    // Reemplaz√° con TU config (si no la carg√°s, igual funciona con localStorage)
    const firebaseConfig = {
      // apiKey: "TU_API_KEY",
      // authDomain: "TU_DOMINIO.firebaseapp.com",
      // projectId: "TU_PROJECT_ID",
      // storageBucket: "TU_PROJECT_ID.appspot.com",
      // messagingSenderId: "XXX",
      // appId: "1:XXX:web:XXX"
    };

    let db = null;
    try{
      if (firebaseConfig && Object.keys(firebaseConfig).length > 0) {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("Firestore listo");
      }
    }catch(e){ console.warn("No se pudo inicializar Firebase:", e) }

    // Productos: ajust√° nombres de im√°genes a lo que tengas en /images
    const BURGERS = [
      { id:"clasic",  name:"Cl√°sica",     price:6500, img:"images/classic.jpg", desc:"Carne, cheddar, lechuga, tomate" },
      { id:"bacon",   name:"Bacon",       price:7200, img:"images/bacon.jpg",   desc:"Carne, cheddar, panceta, BBQ" },
      { id:"blue",    name:"Blue Cheese", price:7400, img:"images/blue.jpg",    desc:"Carne, queso azul, cebolla" },
      { id:"mush",    name:"Mushroom",    price:7300, img:"images/mushroom.jpg",desc:"Carne, champis, swiss" },
      { id:"veggie",  name:"Veggie",      price:6800, img:"images/veggie.jpg",  desc:"Medall√≥n veggie, verduras" },
      { id:"doble",   name:"Doble",       price:8100, img:"images/doble.jpg",   desc:"Doble carne y doble cheddar" },
    ];

    const DRINKS = [
      { id:"coca",  name:"Coca-Cola 500ml", price:2200, img:"images/coca.jpg" },
      { id:"sprite",name:"Sprite 500ml",    price:2200, img:"images/sprite.jpg" },
      { id:"agua",  name:"Agua 500ml",      price:1800, img:"images/agua.jpg" },
    ];

    const FALLBACK_IMG = "images/logo.png";

    /***********************
     * 2) RENDER UI
     ***********************/
    const $ = s => document.querySelector(s);
    const gridBurgers = $("#burgersGrid");
    const gridDrinks  = $("#drinksGrid");
    const cartCountEl = $("#cartCount");
    const drawer      = $("#drawer");
    const cartItemsEl = $("#cartItems");
    const cartTotalEl = $("#cartTotal");
    const papasSummaryEl = $("#papasSummary");

    function money(n){ return n.toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0}); }

    function renderCard(item, type){
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${item.img}" alt="${item.name}" onerror="this.onerror=null;this.src='${FALLBACK_IMG}'">
        <div class="content">
          <h3>${item.name}</h3>
          ${item.desc ? `<p>${item.desc}</p>` : ``}
          <div class="row">
            <span class="price">${money(item.price)}</span>
            <div class="qty">
              <button aria-label="Restar" data-action="dec">-</button>
              <span id="q-${type}-${item.id}">${getQty(type,item.id)}</span>
              <button aria-label="Sumar" data-action="inc">+</button>
            </div>
          </div>
        </div>
      `;
      card.querySelectorAll(".qty button").forEach(btn=>{
        btn.addEventListener("click", e=>{
          const act = btn.dataset.action;
          if(act==="inc") addToCart(type,item.id,1,item);
          else addToCart(type,item.id,-1,item);
        });
      });
      return card;
    }

    function mount(){
      gridBurgers.innerHTML = "";
      BURGERS.forEach(b => gridBurgers.appendChild(renderCard(b,"burger")));

      gridDrinks.innerHTML = "";
      DRINKS.forEach(d => gridDrinks.appendChild(renderCard(d,"drink")));

      syncCartViews();
    }

    /***********************
     * 3) CARRITO
     ***********************/
    const CART_KEY = "rhodes_cart_v1";
    let cart = loadCart();

    function loadCart(){
      try{
        const raw = localStorage.getItem(CART_KEY);
        return raw ? JSON.parse(raw) : { burger:{}, drink:{}, fries:null };
      }catch{ return { burger:{}, drink:{}, fries:null } }
    }
    function saveCart(){
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function findItem(type,id){
      const list = type==="burger" ? BURGERS : DRINKS;
      return list.find(x=>x.id===id);
    }

    function addToCart(type,id,delta,itemData=null){
      const bucket = cart[type] || (cart[type] = {});
      const current = bucket[id]?.qty || 0;
      const next = Math.max(0, current + delta);
      if(next===0) delete bucket[id];
      else bucket[id] = { qty: next, ...(bucket[id]||{}), item: itemData || findItem(type,id) };
      saveCart();
      syncCartViews();
    }

    function getQty(type,id){
      return cart[type]?.[id]?.qty || 0;
    }

    function calcTotal(){
      let total = 0;
      for(const b of Object.values(cart.burger)){
        total += (b.item?.price || 0) * b.qty;
      }
      for(const d of Object.values(cart.drink)){
        total += (d.item?.price || 0) * d.qty;
      }
      return total;
    }

    function cartCount(){
      let n=0;
      for(const b of Object.values(cart.burger)) n+=b.qty;
      for(const d of Object.values(cart.drink)) n+=d.qty;
      return n;
    }

    function syncCartViews(){
      // cantidades en cards
      BURGERS.forEach(b => { const el = document.getElementById(`q-burger-${b.id}`); if(el) el.textContent = getQty("burger", b.id); });
      DRINKS.forEach(d => { const el = document.getElementById(`q-drink-${d.id}`);  if(el) el.textContent = getQty("drink", d.id); });

      // badge
      cartCountEl.textContent = cartCount();

      // items en drawer
      const rows = [];
      for(const [id, obj] of Object.entries(cart.burger)){
        rows.push(rowItem("burger", obj.item, obj.qty));
      }
      for(const [id, obj] of Object.entries(cart.drink)){
        rows.push(rowItem("drink", obj.item, obj.qty));
      }
      cartItemsEl.innerHTML = rows.join("") || `<p class="muted">Tu carrito est√° vac√≠o.</p>`;

      // total
      cartTotalEl.textContent = money( calcTotal() );

      // papas resumen
      const map = {con_sazon:"Con saz√≥n", sin_sazon:"Sin sazonar"};
      papasSummaryEl.textContent = cart.fries ? map[cart.fries] : "Sin elegir";
    }

    function rowItem(type,item,qty){
      return `
        <div class="item">
          <div>
            <div><strong>${item.name}</strong></div>
            <div class="muted">${money(item.price)} x ${qty}</div>
          </div>
          <div class="qty">
            <button onclick="addToCart('${type}','${item.id}',-1)">-</button>
            <span>${qty}</span>
            <button onclick="addToCart('${type}','${item.id}',1)">+</button>
          </div>
        </div>
      `;
    }

    /***********************
     * 4) PAPAS (obligatorio)
     ***********************/
    document.querySelectorAll('input[name="papas"]').forEach(r=>{
      r.addEventListener("change", ()=>{
        cart.fries = r.value;
        saveCart();
        syncCartViews();
      });
    });

    /***********************
     * 5) DRAWER + ACCIONES
     ***********************/
    const openDrawer  = () => drawer.classList.add("open");
    const closeDrawer = () => drawer.classList.remove("open");

    document.getElementById("btnCarrito").addEventListener("click", openDrawer);
    document.getElementById("closeDrawer").addEventListener("click", closeDrawer);

    document.getElementById("btnVaciar").addEventListener("click", ()=>{
      cart = { burger:{}, drink:{}, fries:null };
      saveCart(); syncCartViews();
    });

    // Contacto -> WhatsApp (edit√° el n√∫mero)
    document.getElementById("btnContacto").addEventListener("click", ()=>{
      const url = "https://wa.me/5491112345678?text=Hola%20Rhodes%20Burgers!%20Quiero%20hacer%20un%20pedido.";
      window.location.href = url;
    });

    // Validaci√≥n de papas antes de finalizar
    document.getElementById("btnFinalizar").addEventListener("click", async ()=>{
      if(!cart.fries){
        alert("Eleg√≠ una opci√≥n de papas (obligatorio).");
        return;
      }
      if(cartCount()===0){
        alert("Agreg√° al menos un producto.");
        return;
      }

      const order = buildOrderPayload();
      try{
        if(db){
          await db.collection("orders").add(order);
          alert("¬°Pedido enviado! Te contactamos en breve.");
        }else{
          console.log("Pedido (local):", order);
          alert("¬°Pedido generado! (modo local).");
        }
        // limpiar
        cart = { burger:{}, drink:{}, fries:null };
        saveCart(); syncCartViews(); closeDrawer();
      }catch(err){
        console.error(err);
        alert("No pudimos guardar el pedido. Prob√° de nuevo.");
      }
    });

    function buildOrderPayload(){
      const items = [];
      for(const obj of Object.values(cart.burger)){
        items.push({type:"burger", id:obj.item.id, name:obj.item.name, qty:obj.qty, price:obj.item.price});
      }
      for(const obj of Object.values(cart.drink)){
        items.push({type:"drink", id:obj.item.id, name:obj.item.name, qty:obj.qty, price:obj.item.price});
      }
      return {
        createdAt: new Date().toISOString(),
        fries: cart.fries, 
        items,
        total: calcTotal(),
        status: "pending"
      };
    }

    // Cargar al inicio
    mount();
  </script>
</body>
</html>
