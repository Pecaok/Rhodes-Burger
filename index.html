<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Rhodes Burgers - Men√∫</title>
  <link rel="icon" href="images/logo.png" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#625A45" />
  <meta name="description" content="Las mejores hamburguesas de Escobar. Ped√≠ online.">

  <link rel="preconnect" href="https://firebasestorage.googleapis.com">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
   
  <style>
    /* CSS CR√çTICO & OPTIMIZADO */
    :root{ --primary: #625A45; --bg: #f3f4f6; --card: #ffffff; --ring: #e5e7eb; --text: #1f2937; }
    
    /* Usamos system-ui como fallback inmediato */
    body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', system-ui, -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
    
    /* MEJORA DE RENDIMIENTO: content-visibility */
    .grid { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 12px; 
        content-visibility: auto; /* üî• EL TRUCO M√ÅGICO: No renderiza lo que no se ve */
        contain-intrinsic-size: 1px 300px; /* Evita saltos de scroll */
    }
    @media (min-width: 600px) { .grid { grid-template-columns: repeat(3, 1fr); gap: 16px; } }

    /* SKELETON (M√°s ligero) */
    .skeleton { background: #eee; border-radius: 12px; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
    .sk-card { height: 240px; width: 100%; margin-bottom: 10px; background: #e0e0e0; }
    .sk-text { height: 24px; width: 50%; margin: 20px 0 10px; background: #d1d1d1; border-radius: 4px; }
    
    /* HEADER */
    header { position: sticky; top: 0; z-index: 1000; background: #fff; border-bottom: 1px solid var(--ring); box-shadow: 0 2px 10px rgba(0,0,0,0.05); will-change: transform; }
    .topbar { max-width: 1200px; margin: 0 auto; height: 60px; padding: 0 12px; display: flex; align-items: center; gap: 10px; }
    .brand { font-weight: 800; font-size: 18px; color: var(--primary); display: flex; align-items: center; text-decoration: none; }
    .brand img { width: 32px; height: 32px; border-radius: 6px; margin-right: 8px; }
    .spacer { flex: 1; }
    
    .status-pill { display:inline-flex; flex-direction:column; align-items:center; justify-content:center; min-width:110px; padding:4px 10px; border-radius:12px; background:#f4f4f4; border:1px solid var(--ring); color:#222; text-align:center; line-height: 1.1; font-size: 11px; font-weight: 700; }
    .status-open { background:#dcfce7; border-color:#86efac; color:#166534; }
    .status-closed { background:#f3f4f6; border-color:#e5e7eb; color:#6b7280; }

    /* LAYOUT */
    .container { max-width: 800px; margin: 0 auto; padding: 10px 16px 80px 16px; }
    h2 { font-size: 20px; margin: 25px 0 15px; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 5px; letter-spacing: -0.5px; }

    /* TARJETAS */
    .card { background: var(--card); border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid var(--ring); display: flex; flex-direction: column; height: 100%; transition: transform 0.1s; position: relative; content-visibility: auto; }
    .card:active { transform: scale(0.97); }
    
    .imgwrap { position: relative; width: 100%; padding-top: 75%; background: #f3f4f6; overflow: hidden; }
    .card img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s ease-in; }
    .card img.lazy { opacity: 0; }
    .card img.loaded { opacity: 1; }
    
    .content { padding: 10px; display: flex; flex-direction: column; flex: 1; }
    .card h3 { margin: 0 0 4px; font-size: 15px; font-weight: 800; color: #111; line-height: 1.2; }
    .card p.muted { font-size: 11px; color: #6b7280; margin: 0 0 8px; line-height: 1.3; flex: 1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    
    .row { display: flex; align-items: center; justify-content: space-between; margin-top: auto; }
    .price { font-weight: 900; font-size: 15px; color: var(--primary); }
    .btn-add { background: var(--primary); color: white; border: none; width: 28px; height: 28px; border-radius: 50%; font-size: 18px; line-height: 1; display: flex; align-items: center; justify-content: center; cursor: pointer; }

    .card[data-soldout="true"] { opacity: 0.6; filter: grayscale(1); pointer-events: none; }
    .soldout-badge { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; font-size: 10px; font-weight: 700; padding: 3px 6px; border-radius: 4px; z-index: 10; }

    /* DRAWER & MODAL */
    .drawer { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%; background: #fff; box-shadow: -5px 0 25px rgba(0,0,0,0.2); transition: right 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 2000; display: flex; flex-direction: column; visibility: hidden; will-change: right; }
    .drawer.open { right: 0; visibility: visible; }
    .drawer header { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; font-weight: 800; font-size: 16px; }
    .drawer .body { flex: 1; overflow-y: auto; padding: 15px; -webkit-overflow-scrolling: touch; }
    .item { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px dashed #eee; padding-bottom: 10px; font-size: 14px; }
    
    .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,.6); display:none; align-items:flex-end; justify-content:center; z-index:3000; -webkit-backdrop-filter: blur(2px); backdrop-filter: blur(2px); }
    .overlay.open { display:flex !important; }
    .modal { width:100%; max-width:500px; background:white; border-radius:20px 20px 0 0; padding:20px; animation:slideUp 0.25s ease-out; max-height: 90vh; overflow-y: auto; }
    @media(min-width: 600px) { .overlay { align-items: center; } .modal { border-radius: 20px; } }
    @keyframes slideUp { from { transform:translateY(100%); } to { transform:translateY(0); } }

    /* CONTROLS */
    .qtybox { display: flex; align-items: center; gap: 10px; border: 1px solid #e5e5e5; padding: 3px 8px; border-radius: 20px; }
    .qtybtn { width: 24px; height: 24px; border-radius: 50%; border: none; background: #eee; color: #333; font-weight: 900; font-size: 14px; }
    .chip { padding: 8px 12px; background: #f9fafb; border: 1px solid #e5e5e5; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; }
    .chip input { accent-color: var(--primary); width: 16px; height: 16px; margin: 0; }
    textarea { width: 100%; border: 1px solid #e5e5e5; border-radius: 12px; padding: 10px; margin-top: 10px; resize: none; font-family: inherit; }
    
    .btn { width: 100%; padding: 12px; border-radius: 12px; font-weight: 700; border: none; cursor: pointer; font-size: 15px; }
    .btn.primary { background: var(--primary); color: white; }
    .btn.ghost { background: transparent; border: 1px solid #ccc; color: #555; }
    
    #storeBlocker.hidden { display: none !important; }
  </style>
</head>
<body>

  <div id="storeBlocker" class="hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:99999;color:white;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;">
    <div style="font-size:60px; margin-bottom: 20px;">üîí</div>
    <h2 id="blockerTitle" style="color:white;margin:0; font-size: 28px;">LOCAL CERRADO</h2>
    <p id="blockerMsg" style="color:#ccc; margin-top: 10px; font-size: 16px;">Volvemos pronto.</p>
  </div>

  <header>
    <div class="topbar">
      <a href="index.html" class="brand">
        <img src="images/logo.png" alt="Rhodes" width="32" height="32" />
        <span style="font-size:16px;">Rhodes</span>
      </a>
      <div class="spacer"></div>
      <div id="statusPill" class="status-pill status-closed">
        <span class="status-main">...</span>
      </div>
      <div onclick="toggleDrawer(true)" style="position:relative; cursor:pointer; margin-left:10px">
        <span style="font-size:24px">üõí</span>
        <span id="cartBubble" style="position:absolute; top:-5px; right:-5px; background:red; color:white; font-size:10px; font-weight:bold; padding:2px 5px; border-radius:10px; display:none">0</span>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="menuContainer">
        <div class="skeleton sk-text"></div>
        <div class="grid">
            <div class="skeleton sk-card"></div>
            <div class="skeleton sk-card"></div>
            <div class="skeleton sk-card"></div>
            <div class="skeleton sk-card"></div>
        </div>
    </div>
  </main>

  <aside class="drawer" id="drawer">
    <header>
      <span>Tu Pedido</span>
      <button onclick="toggleDrawer(false)" style="background:none;border:none;font-size:24px;padding:0 10px;">&times;</button>
    </header>
    <div class="body">
      <div id="cartItems"></div>
      <div class="total" style="font-size:18px; font-weight:800; text-align:right; margin:20px 0; color:var(--primary)">Total: <span id="cartTotal">$0</span></div>
      <button class="btn primary" id="btnCheckout">Enviar a WhatsApp</button>
      <button class="btn ghost" style="margin-top:10px" onclick="emptyCart()">Vaciar</button>
    </div>
  </aside>

  <div class="overlay" id="modalOverlay">
    <div class="modal">
      <h3 id="modTitle" style="margin-top:0; font-size: 18px;"></h3>
      
      <div style="margin-top:15px">
        <label style="font-weight:700; font-size:13px; color:#4b5563">Guarnici√≥n</label>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px" id="friesOptions"></div>
      </div>

      <div id="extrasSection" style="margin-top:20px;">
          <div class="row" style="margin-bottom:12px">
              <span style="font-size:14px">Extra Carne <b style="color:var(--primary)" id="pricePattyDisplay"></b></span>
              <div class="qtybox">
                  <button class="qtybtn" onclick="updExtra('patty', -1)">-</button>
                  <span id="qtyPatty" style="font-weight:700; width:20px; text-align:center; font-size:14px">0</span>
                  <button class="qtybtn" onclick="updExtra('patty', 1)">+</button>
              </div>
          </div>
          <div class="row">
              <span style="font-size:14px">Extra Cheddar <b style="color:var(--primary)" id="priceCheddarDisplay"></b></span>
              <div class="qtybox">
                  <button class="qtybtn" onclick="updExtra('cheddar', -1)">-</button>
                  <span id="qtyCheddar" style="font-weight:700; width:20px; text-align:center; font-size:14px">0</span>
                  <button class="qtybtn" onclick="updExtra('cheddar', 1)">+</button>
              </div>
          </div>
      </div>

      <textarea id="modNotes" rows="2" placeholder="Notas (Ej: Sin cebolla)"></textarea>

      <div style="display:flex; justify-content:space-between; align-items:center; margin-top:20px; padding-top:15px; border-top:1px solid #eee">
          <div style="font-size:20px; font-weight:900; color:var(--primary)" id="modTotal">$0</div>
          <button class="btn primary" id="btnAddCart" style="width:auto; padding:10px 20px;">Agregar</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>

  <script defer>
    // CONFIG
    const CACHE_KEY = "rhodes_data_v4"; // Increment√© versi√≥n por cambios
    const CART_KEY = "rhodes_cart_v5";
    const PHONE_NUMBER = "543484346113"; 
    const HOURS = { 0: [[19,0,24,0]], 1: [], 2: [], 3: [[19,0,24,0]], 4: [[19,0,24,0]], 5: [[19,0,24,0]], 6: [[19,0,24,0]] };

    // ESTADO
    let STATE = {
        products: [],
        menuOrder: {}, 
        config: { 
            sides: { con_sazon:true, con_sal:true, sin_sal:true }, 
            store: { forceOpen: null, maintenance: {} },
            prices: { patty: 2800, cheddar: 300 }
        },
        cart: { items: [] }
    };
    
    let MODAL = { item: null, extras: { patty:0, cheddar:0 } };
    let db; 

    // INICIO
    document.addEventListener("DOMContentLoaded", () => {
        loadFromCache(); // 1. Cargar cach√© inmediatamente
        
        const checkFirebase = setInterval(() => {
            if (window.firebase) {
                clearInterval(checkFirebase);
                initFirebase(); // 2. Conectar Firebase
            }
        }, 100);

        const savedCart = localStorage.getItem(CART_KEY);
        if(savedCart) { STATE.cart = JSON.parse(savedCart); updateCartUI(); }
    });

    // CACH√â
    function loadFromCache() {
        const cached = localStorage.getItem(CACHE_KEY);
        if (cached) {
            const parsed = JSON.parse(cached);
            STATE.products = parsed.products || [];
            STATE.menuOrder = parsed.menuOrder || {};
            if(parsed.config) STATE.config = { ...STATE.config, ...parsed.config };
            renderMenu(); 
            checkStatus(); 
        }
    }

    function saveToCache() {
        localStorage.setItem(CACHE_KEY, JSON.stringify({
            products: STATE.products,
            menuOrder: STATE.menuOrder,
            config: STATE.config,
            timestamp: Date.now()
        }));
    }

    // FIREBASE
    function initFirebase() {
        const firebaseConfig = {apiKey:"AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",authDomain:"rhodes-burguers.firebaseapp.com",projectId:"rhodes-burguers",storageBucket:"rhodes-burguers.firebasestorage.app",messagingSenderId:"951646688091",appId:"1:951646688091:web:05db5fadb4150d1fa9c07e"};
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        db.enablePersistence({synchronizeTabs:true}).catch(err => {});

        // LISTENERS
        db.collection("products").onSnapshot(snap => {
            STATE.products = [];
            snap.forEach(doc => {
                const d = doc.data();
                if(d.available !== false) STATE.products.push({ id: doc.id, ...d });
            });
            renderMenu();
            saveToCache();
        });

        db.collection("config").doc("store").onSnapshot(doc => {
            STATE.config.store = doc.data() || {};
            checkStatus();
            saveToCache();
        });

        db.collection("config").doc("sides").onSnapshot(doc => {
            const d = doc.data() || {};
            STATE.config.sides = { con_sazon: d.con_sazon!==false, con_sal: d.con_sal!==false, sin_sal: d.sin_sal!==false };
            saveToCache();
        });

        db.collection("config").doc("menuOrder").onSnapshot(doc => {
            STATE.menuOrder = doc.exists ? doc.data() : {};
            renderMenu();
            saveToCache();
        });

        db.collection("config").doc("prices").onSnapshot(doc => {
            const d = doc.data() || {};
            STATE.config.prices = {
                patty: Number(d.patty) || 2800,
                cheddar: Number(d.cheddar) || 300
            };
            saveToCache();
        });
    }

    // RENDERIZADO
    function renderMenu() {
        const container = document.getElementById("menuContainer");
        if(STATE.products.length === 0) return; 

        let html = '';
        
        const sortList = (list, catName) => {
            const orderList = STATE.menuOrder[catName] || [];
            const orderMap = new Map(orderList.map((id, i) => [id, i]));
            return list.sort((a, b) => {
                const idxA = orderMap.has(a.id) ? orderMap.get(a.id) : 9999;
                const idxB = orderMap.has(b.id) ? orderMap.get(b.id) : 9999;
                return idxA - idxB;
            });
        };

        const burgers = sortList(STATE.products.filter(p => p.category === 'hamburguesas'), 'hamburguesas');
        const sides = sortList(STATE.products.filter(p => p.category === 'guarniciones'), 'guarniciones');
        const drinks = sortList(STATE.products.filter(p => p.category === 'bebidas'), 'bebidas');

        const renderSection = (title, list) => {
            if(!list.length) return '';
            const cards = list.map(p => `
                <div class="card ${p.available===false ? 'soldout' : ''}" onclick="openModal('${p.id}')" data-soldout="${!p.available}">
                    ${p.available===false ? '<div class="soldout-badge">AGOTADO</div>' : ''}
                    <div class="imgwrap">
                        <img src="images/logo.png" data-src="${p.img || 'images/logo.png'}" alt="${p.name}" class="lazy" onload="this.classList.add('loaded')">
                    </div>
                    <div class="content">
                        <h3>${p.name}</h3>
                        <p class="muted">${p.description || ''}</p>
                        <div class="row">
                            <span class="price">$${p.price}</span>
                            <div class="btn-add">+</div>
                        </div>
                    </div>
                </div>
            `).join('');
            return `<h2>${title}</h2><div class="grid">${cards}</div>`;
        };

        html += renderSection('Hamburguesas', burgers);
        html += renderSection('Guarniciones', sides);
        html += renderSection('Bebidas', drinks);

        container.innerHTML = html;
        
        // Lazy Load
        const lazyImages = document.querySelectorAll('img.lazy');
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    observer.unobserve(img);
                }
            });
        });
        lazyImages.forEach(img => observer.observe(img));
    }

    // L√ìGICA DE APERTURA
    function checkStatus() {
        const conf = STATE.config.store;
        const now = new Date();
        
        if (conf.maintenance?.active) {
            document.getElementById("storeBlocker").classList.remove("hidden");
            document.getElementById("blockerTitle").innerText = conf.maintenance.title || "EN MANTENIMIENTO";
            document.getElementById("blockerMsg").innerText = conf.maintenance.message || "Volvemos pronto.";
            return;
        } else {
            document.getElementById("storeBlocker").classList.add("hidden");
        }

        let isOpen = false;
        let label = "CERRADO";
        
        if (conf.forceOpen === true) {
            isOpen = true; label = "ABIERTO";
        } else if (conf.forceOpen === false) {
            isOpen = false; label = "CERRADO";
        } else {
            const day = now.getDay();
            const min = now.getHours() * 60 + now.getMinutes();
            const todayHours = HOURS[day] || [];
            for(let slot of todayHours) {
                if(min >= (slot[0]*60 + slot[1]) && min < (slot[2]*60 + slot[3])) {
                    isOpen = true;
                    label = `ABIERTO hasta ${slot[2]}:${String(slot[3]).padStart(2,'0')}`;
                    break;
                }
            }
        }

        STATE.isOpen = isOpen;
        const pill = document.getElementById("statusPill");
        pill.className = `status-pill ${isOpen ? 'status-open' : 'status-closed'}`;
        pill.innerHTML = `<span class="status-main">${isOpen ? 'ABIERTO' : 'CERRADO'}</span><span class="status-sub" style="font-size:10px">${isOpen ? label.replace('ABIERTO ', '') : 'Horario: 19 a 00hs'}</span>`;
    }

    // MODAL
    window.openModal = (id) => {
        if (!STATE.isOpen && !STATE.config.store.forceOpen) {
            alert("El local est√° cerrado en este momento."); return;
        }

        const item = STATE.products.find(p => p.id === id);
        if(!item) return;

        MODAL.item = item;
        MODAL.extras = { patty:0, cheddar:0 };

        document.getElementById("modTitle").innerText = item.name;
        document.getElementById("modNotes").value = "";
        
        // PRECIOS DIN√ÅMICOS
        const prices = STATE.config.prices;
        document.getElementById("pricePattyDisplay").innerText = `($${prices.patty})`;
        document.getElementById("priceCheddarDisplay").innerText = `($${prices.cheddar})`;

        const isBurger = item.category === 'hamburguesas';
        document.getElementById("extrasSection").style.display = isBurger ? 'block' : 'none';
        
        const friesContainer = document.getElementById("friesOptions");
        friesContainer.innerHTML = '';
        
        const sidesMap = { con_sazon: "Sazonadas", con_sal: "Con Sal", sin_sal: "Sin Sal" };
        let firstFound = false;

        if (item.category === 'bebidas') {
            friesContainer.parentElement.style.display = 'none';
        } else {
            friesContainer.parentElement.style.display = 'block';
            for (const [key, label] of Object.entries(sidesMap)) {
                if (STATE.config.sides[key]) {
                    const checked = !firstFound ? 'checked' : '';
                    firstFound = true;
                    friesContainer.innerHTML += `<label class="chip"><input type="radio" name="fries" value="${key}" ${checked}> ${label}</label>`;
                }
            }
        }

        updateModalPrice();
        document.getElementById("modalOverlay").classList.add("open");
    }

    window.updExtra = (type, delta) => {
        const newVal = MODAL.extras[type] + delta;
        if (newVal >= 0 && newVal <= 3) {
            MODAL.extras[type] = newVal;
            document.getElementById(type === 'patty' ? "qtyPatty" : "qtyCheddar").innerText = newVal;
            updateModalPrice();
        }
    }

    function updateModalPrice() {
        let total = Number(MODAL.item.price);
        const prices = STATE.config.prices;
        total += (MODAL.extras.patty * prices.patty);
        total += (MODAL.extras.cheddar * prices.cheddar);
        document.getElementById("modTotal").innerText = "$" + total;
    }

    // CARRITO
    document.getElementById("btnAddCart").onclick = () => {
        const item = MODAL.item;
        const notes = document.getElementById("modNotes").value.trim();
        let fries = "";
        
        if (item.category !== 'bebidas') {
            const friesInput = document.querySelector('input[name="fries"]:checked');
            if(!friesInput) { alert("Selecciona un tipo de papas"); return; }
            fries = friesInput.value;
        }

        const prices = STATE.config.prices;
        const finalPrice = Number(item.price) + (MODAL.extras.patty * prices.patty) + (MODAL.extras.cheddar * prices.cheddar);

        const cartItem = {
            id: item.id,
            name: item.name,
            price: Number(item.price),
            category: item.category,
            qty: 1,
            fries: fries,
            extras: { ...MODAL.extras },
            notes: notes,
            finalPrice: finalPrice
        };

        const existing = STATE.cart.items.find(i => 
            i.id === cartItem.id && 
            i.fries === cartItem.fries && 
            JSON.stringify(i.extras) === JSON.stringify(cartItem.extras) &&
            i.notes === cartItem.notes
        );

        if(existing) existing.qty++;
        else STATE.cart.items.push(cartItem);

        saveCart();
        document.getElementById("modalOverlay").classList.remove("open");
        toggleDrawer(true);
    };

    function saveCart() {
        localStorage.setItem(CART_KEY, JSON.stringify(STATE.cart));
        updateCartUI();
    }

    function updateCartUI() {
        const count = STATE.cart.items.reduce((s,i) => s + i.qty, 0);
        document.getElementById("cartBubble").innerText = count;
        document.getElementById("cartBubble").style.display = count > 0 ? 'inline-block' : 'none';
        
        const container = document.getElementById("cartItems");
        container.innerHTML = '';
        let total = 0;

        STATE.cart.items.forEach((item, idx) => {
            total += item.finalPrice * item.qty;
            let detail = [];
            if(item.category === 'hamburguesas') {
                const map = { con_sazon:"Sazonadas", con_sal:"Con Sal", sin_sal:"Sin Sal" };
                detail.push("üçü " + map[item.fries]);
                if(item.extras.patty) detail.push(`+${item.extras.patty} Carne`);
                if(item.extras.cheddar) detail.push(`+${item.extras.cheddar} Cheddar`);
            }
            if(item.notes) detail.push(`üìù ${item.notes}`);

            container.innerHTML += `
                <div class="item">
                    <div style="flex:1">
                        <div style="font-weight:700">${item.name}</div>
                        <div style="font-size:12px;color:#666">${detail.join(" ‚Ä¢ ")}</div>
                        <div style="color:var(--primary);font-weight:700">$${item.finalPrice}</div>
                    </div>
                    <div class="qtybox">
                        <button class="qtybtn" onclick="cartQty(${idx}, -1)">-</button>
                        <span style="width:20px;text-align:center;font-weight:700">${item.qty}</span>
                        <button class="qtybtn" onclick="cartQty(${idx}, 1)">+</button>
                    </div>
                </div>
            `;
        });
        document.getElementById("cartTotal").innerText = "$" + total;
    }

    window.cartQty = (idx, delta) => {
        const item = STATE.cart.items[idx];
        item.qty += delta;
        if(item.qty <= 0) STATE.cart.items.splice(idx, 1);
        saveCart();
    }

    window.emptyCart = () => {
        if(confirm("¬øVaciar carrito?")) { STATE.cart.items = []; saveCart(); toggleDrawer(false); }
    }

    window.toggleDrawer = (open) => {
        const d = document.getElementById("drawer");
        if(open) { d.classList.add("open"); updateCartUI(); }
        else d.classList.remove("open");
    }
    
    document.getElementById("modalOverlay").onclick = (e) => {
        if(e.target.id === "modalOverlay") document.getElementById("modalOverlay").classList.remove("open");
    }

    document.getElementById("btnCheckout").onclick = () => {
        if(STATE.cart.items.length === 0) return alert("Tu carrito est√° vac√≠o");
        
        let msg = `*HOLA! QUIERO HACER UN PEDIDO*\n--------------------------------\n`;
        let total = 0;
        
        STATE.cart.items.forEach(i => {
            msg += `${i.qty}x *${i.name}*\n`;
            if(i.category==='hamburguesas') {
                const map = { con_sazon:"Sazonadas", con_sal:"Con Sal", sin_sal:"Sin Sal" };
                msg += `   üçü ${map[i.fries]}\n`;
                if(i.extras.patty) msg += `   ü•© +${i.extras.patty} Carne\n`;
                if(i.extras.cheddar) msg += `   üßÄ +${i.extras.cheddar} Cheddar\n`;
            }
            if(i.notes) msg += `   üìù Nota: ${i.notes}\n`;
            total += i.finalPrice * i.qty;
        });

        msg += `--------------------------------\n*TOTAL: $${total}*\n\nMi nombre es: `;
        
        window.location.href = `https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(msg)}`;
    }
  </script>
</body>
</html>
