<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rhodes Burgers - Menú</title>

  <!-- Favicon por defecto; el resolver lo actualiza si corresponde -->
  <link rel="icon" href="images/logo.png" />

  <style>
    :root{
      --primary:#2ecc71; --text:#111; --muted:#666; --bg:#f6f6f6; --card:#fff;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08);
      /* URL del logo que el JS actualizará dinámicamente */
      --logo-url:url("images/logo.png");
    }
    *{ box-sizing:border-box }
    html,body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif }

    /* Logo de fondo (marca de agua) */
    body::before{
      content:""; position:fixed; inset:0;
      background-image:var(--logo-url); background-repeat:no-repeat;
      background-position:center 120px;
      background-size:clamp(260px,45vw,560px);
      opacity:.08; pointer-events:none; z-index:0; filter:grayscale(100%);
    }

    header{ position:sticky; top:0; z-index:10; background:#fff; box-shadow:0 2px 12px rgba(0,0,0,.06) }
    .topbar{ max-width:1000px; margin:0 auto; padding:10px 12px; display:flex; align-items:center; gap:12px }
    .brand img{ height:48px; width:auto; object-fit:contain; display:block; background:transparent; border-radius:0 }
    .spacer{ flex:1 }
    .btn{ display:inline-flex; align-items:center; gap:10px; border:2px solid var(--primary); padding:10px 16px; border-radius:999px; color:var(--primary); background:#fff; font-weight:700; text-decoration:none; cursor:pointer }
    .btn.primary{ background:var(--primary); color:#fff }
    .btn.ghost{ border-color:#e7e7e7; color:#333 }
    .container{ max-width:1000px; margin:24px auto; padding:0 12px; position:relative; z-index:1 }
    h1{ font-size:34px; margin:14px 4px 18px }
    h2{ font-size:26px; margin:24px 4px 14px }
    h3{ font-size:18px; margin:8px 0 6px }
    p{ margin:6px 0; color:var(--muted) }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:16px }
    .card{ background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:0; overflow:hidden; display:flex; flex-direction:column }
    .card img{ width:100%; height:160px; object-fit:cover; background:#f0f0f0 }
    .card .content{ padding:12px }
    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:8px }
    .price{ font-weight:800 }
    .actions{ display:flex; gap:8px; flex-wrap:wrap }
    .drawer{ position:fixed; top:0; right:-460px; width:460px; max-width:92vw; height:100vh; background:#fff; box-shadow:-8px 0 30px rgba(0,0,0,.18); transition:right .25s; z-index:30; display:flex; flex-direction:column }
    .drawer.open{ right:0 }
    .drawer header{ padding:14px 16px; box-shadow:0 2px 12px rgba(0,0,0,.06) }
    .drawer .body{ padding:14px 16px; overflow:auto; flex:1 }
    .item{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 0; border-bottom:1px solid #efefef }
    .total{ display:flex; align-items:center; justify-content:space-between; font-weight:800; font-size:18px; margin-top:10px }
    .close{ position:absolute; top:10px; right:10px; width:38px; height:38px; border-radius:999px; border:1px solid #eee; background:#fff; font-weight:900; cursor:pointer }
    .muted{ color:var(--muted); font-size:14px }
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.25); display:none; align-items:center; justify-content:center; z-index:40 }
    .overlay.open{ display:flex }
    .modal{ background:#fff; border-radius:20px; box-shadow:var(--shadow); width:520px; max-width:92vw; padding:16px }
    .modal h3{ margin:0 0 8px }
    .rowx{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0 }
    .qtybox{ display:inline-flex; align-items:center; gap:10px; border:1px solid #e7e7e7; border-radius:999px; padding:6px 10px }
    .qtybox button{ width:28px; height:28px; border:1px solid #e5e5e5; background:#fff; border-radius:999px; font-weight:900; cursor:pointer }
    textarea{ width:100%; min-height:70px; padding:10px; border:1px solid #e7e7e7; border-radius:12px }
    .chips{ display:flex; gap:10px; flex-wrap:wrap }
    .chip{ display:inline-flex; align-items:center; gap:8px; border:1px solid #e7e7e7; border-radius:999px; padding:8px 12px; cursor:pointer }
    .chip input{ accent-color:var(--primary) }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="index.html" class="brand">
        <img id="logo" src="" alt="Rhodes Burgers">
      </a>
      <div class="spacer"></div>
      <button class="btn ghost" id="btnContacto">Contacto</button>
      <button class="btn primary" id="btnCart">Ver pedido</button>
    </div>
  </header>

  <main>
    <div class="container">
      <h1>Menú</h1>

      <h2>Hamburguesas</h2>
      <div id="burgersGrid" class="grid"></div>

      <h2 id="friesSection">Papas fritas (obligatorio al pagar)</h2>
      <div class="chips">
        <label class="chip"><input type="radio" name="fries" value="con_sazon"> Con sazón</label>
        <label class="chip"><input type="radio" name="fries" value="sin_sazon"> Sin sazonar</label>
      </div>
      <p class="muted" id="friesHint"></p>

      <h2>Bebidas</h2>
      <div id="drinksGrid" class="grid"></div>
    </div>
  </main>

  <aside class="drawer" id="drawer">
    <header><strong>Tu pedido</strong><button class="close" id="closeDrawer">✕</button></header>
    <div class="body">
      <div id="cartItems"></div>
      <div class="total"><span>Total</span><span id="cartTotal">$0</span></div>
      <div style="margin-top:12px; display:flex; gap:10px">
        <button class="btn ghost" id="btnVaciar">Vaciar</button>
        <button class="btn primary" id="btnIrPagar">Ir a pagar</button>
      </div>
    </div>
  </aside>

  <div class="overlay" id="overlay">
    <div class="modal">
      <h3 id="modTitle">Personalizar</h3>
      <div class="rowx">
        <div>Cantidad</div>
        <div class="qtybox">
          <button id="qtyDec">-</button><span id="qtyVal">1</span><button id="qtyInc">+</button>
        </div>
      </div>
      <div id="extrasWrap">
        <div class="rowx" id="rowPatties" style="display:none">
          <div>Medallones extra <span class="muted">(máx. +2)</span></div>
          <div class="qtybox"><button id="patDec">-</button><span id="patVal">0</span><button id="patInc">+</button></div>
        </div>
        <div class="rowx" id="rowCheddar" style="display:none">
          <div>Fetas de cheddar extra <span class="muted" id="cheHint">(máx. +3)</span></div>
          <div class="qtybox"><button id="cheDec">-</button><span id="cheVal">0</span><button id="cheInc">+</button></div>
        </div>
        <div class="muted" id="noExtras" style="display:none">Este producto no admite extras.</div>
      </div>
      <div class="rowx" style="align-items:flex-start; flex-direction:column">
        <label>Notas (opcional)</label>
        <textarea id="notes" placeholder="Sin cebolla, extra salsa, etc."></textarea>
      </div>
      <div class="rowx" style="justify-content:flex-end">
        <button class="btn ghost" id="btnCancel">Cancelar</button>
        <button class="btn primary" id="btnAdd">Agregar al carrito</button>
      </div>
    </div>
  </div>

  <!-- Resolver de logo -->
  <script>
    (function resolveLogo(){
      const candidates = [
        "images/logo.png","images/logo.jpg",
        "/images/logo.png","/images/logo.jpg",
        "images/Logo.png","images/Logo.jpg"
      ];
      function findFirstExisting(list){
        return new Promise(resolve=>{
          let i=0;
          const next=()=>{
            if(i>=list.length) return resolve(null);
            const img=new Image();
            img.onload=()=>resolve(list[i]);
            img.onerror=()=>{ i++; next(); };
            img.src=list[i]+"?v="+Date.now();
          };
          next();
        });
      }
      findFirstExisting(candidates).then(src=>{
        const finalSrc = src || "images/logo.png";
        console.log("[logo] candidato encontrado:", finalSrc);
        const logoEl = document.getElementById("logo");
        if(logoEl) logoEl.src = finalSrc;
        document.documentElement.style.setProperty("--logo-url", `url("${finalSrc}")`);
        let link = document.querySelector('link[rel="icon"]');
        if(!link){ link = document.createElement("link"); link.rel = "icon"; document.head.appendChild(link); }
        link.href = finalSrc;
      });
    })();
  </script>

  <script type="module">
    /* ===== Firebase ===== */
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBbt5Y0WDE0ouLn-Ib_iD1yUesok5SEh88",
      authDomain: "rhodes-burgers.firebaseapp.com",
      projectId: "rhodes-burgers",
      storageBucket: "rhodes-burgers.appspot.com",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e",
      measurementId: "G-LQVYTJWHSM"
    };

    const app = getApps()[0] || initializeApp(firebaseConfig);
    console.log("[firebase] app options:", app.options);
    const db = getFirestore(app);

    /* ===== Tu lógica de menú (igual que antes) ===== */
    const EXTRA_PRICE_PATTY=0, EXTRA_PRICE_CHEDDAR=0;
    const CART_KEY="rhodes_cart_v3";
    const $=s=>document.querySelector(s);
    const money=n=>n.toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});

    const BURGERS=[ 
      { id:"bigjohn_simple",name:"Big John Simple",price:10900,img:"images/Big John Simple.jpg",kind:"simple",desc:"Incluye papas fritas." },
      { id:"bigjohn_doble",name:"Big John Doble",price:13900,img:"images/Big John Doble.jpg",kind:"double",desc:"Incluye papas fritas." },
      { id:"burguesa_simple",name:"Burguesa Simple",price:11900,img:"images/Burguesa Simple.jpg",kind:"simple",desc:"Incluye papas fritas." },
      { id:"burguesa_doble",name:"Burguesa Doble",price:14900,img:"images/Burguesa Doble.jpg",kind:"double",desc:"Incluye papas fritas." },
      { id:"cheesebacon_spl",name:"CheeseBacon Simple",price:10500,img:"images/CheeseBacon Simple.jpg",kind:"simple",desc:"Incluye papas fritas." },
      { id:"cheesebacon_dbl",name:"CheeseBacon Doble",price:13500,img:"images/CheeseBacon Doble.jpg",kind:"double",desc:"Incluye papas fritas." },
      { id:"cheese_simple",name:"Cheeseburger Simple",price:9500,img:"images/cheeseburger simple.jpg",kind:"simple",desc:"Incluye papas fritas." },
      { id:"cheese_doble",name:"Cheeseburger Doble",price:12500,img:"images/cheeseburger doble.jpg",kind:"double",desc:"Incluye papas fritas." },
      { id:"rhodes_simple",name:"Rhodes Simple",price:11900,img:"images/Rhodes Simple.jpg",kind:"simple",desc:"Incluye papas fritas." },
      { id:"rhodes_doble",name:"Rhodes Doble",price:14900,img:"images/Rhodes Doble.jpg",kind:"double",desc:"Incluye papas fritas." },
      { id:"morgan_simple",name:"Morgan Simple",price:10900,img:"images/Morgan Simple.jpg",kind:"simple",desc:"Incluye papas fritas." },
      { id:"morgan_doble",name:"Morgan Doble",price:14500,img:"images/Morgan Doble.jpg",kind:"double",desc:"Incluye papas fritas." },
      { id:"pollo_crispy",name:"Pollo Crispy",price:8900,img:"images/Pollo crispy.jpg",kind:"chicken",desc:"Incluye papas fritas." }
    ];
    const DRINKS=[
      { id:"coca_org",name:"Coca-Cola Original 500ml",price:0,img:"images/coca cola original.jpg" },
      { id:"coca_zero",name:"Coca-Cola Zero 500ml",price:0,img:"images/coca cola zero.jpg" },
      { id:"sprite",name:"Sprite 500ml",price:0,img:"images/sprite.jpg" },
      { id:"aqu_pear",name:"Aquarius Limonada 500ml",price:0,img:"images/aquarius pera.jpg" },
      { id:"aqu_pome",name:"Aquarius Pomelo 500ml",price:0,img:"images/aquarius pomelo.jpg" }
    ];

    function setCookie(name,val,secs){
      const d=new Date(Date.now()+secs*1000).toUTCString();
      document.cookie=`${name}=${encodeURIComponent(val)}; Expires=${d}; Path=/; SameSite=Lax`;
    }
    const enc = obj => btoa(String.fromCharCode(...new TextEncoder().encode(JSON.stringify(obj))));

    let cart = ( () => { try{ return JSON.parse(localStorage.getItem(CART_KEY))||{burger:{},drink:{},fries:null}; }catch{ return {burger:{},drink:{},fries:null}; } } )();
    function saveCart(){ try{ localStorage.setItem(CART_KEY,JSON.stringify(cart)); }catch{} }
    function cartCount(){ let n=0; for(const b of Object.values(cart.burger)) n+=b.qty; for(const d of Object.values(cart.drink)) n+=d.qty; return n; }
    function calcTotal(){ let t=0; for(const b of Object.values(cart.burger)) t+=(b.item?.price||0)*b.qty; for(const d of Object.values(cart.drink)) t+=(d.item?.price||0)*d.qty; return t; }

    const gridBurgers=$("#burgersGrid"), gridDrinks=$("#drinksGrid");
    function renderCard(item,type){
      const el=document.createElement("div");
      el.className="card";
      el.innerHTML=`
        <img src="${encodeURI(item.img)}" alt="${item.name}" onerror="this.onerror=null;this.src='images/logo.png'">
        <div class="content">
          <h3>${item.name}</h3>
          ${item.desc?`<p class="muted" style="margin:4px 0 0">${item.desc}</p>`:""}
          <div class="row">
            <span class="price">${money(item.price)}</span>
            <div class="actions">
              ${type==="drink"
                ? `<button class="btn" data-add>Agregar</button>`
                : `<button class="btn" data-quick>Añadir</button>
                   <button class="btn" data-custom>Personalizar</button>`}
            </div>
          </div>
        </div>`;
      if(type==="drink"){ el.querySelector("[data-add]").onclick=()=>quickAddDrink(item); }
      else { el.querySelector("[data-quick]").onclick=()=>quickAddBurger(item); el.querySelector("[data-custom]").onclick=()=>openCustomize(item); }
      return el;
    }
    function mount(){
      gridBurgers.innerHTML=""; BURGERS.forEach(b=>gridBurgers.appendChild(renderCard(b,"burger")));
      gridDrinks.innerHTML="";  DRINKS.forEach(d=>gridDrinks.appendChild(renderCard(d,"drink")));
      if(cart.fries){ const r=document.querySelector(`input[name="fries"][value="${cart.fries}"]`); if(r) r.checked=true; }
      renderCart();
    }

    function quickAddBurger(item){ const b=cart.burger||(cart.burger={}); if(!b[item.id]) b[item.id]={qty:0,item,extras:{patty:0,cheddar:0}}; b[item.id].qty++; saveCart(); renderCart(); openDrawer(); }
    function quickAddDrink(item){ const d=cart.drink||(cart.drink={}); if(!d[item.id]) d[item.id]={qty:0,item}; d[item.id].qty++; saveCart(); renderCart(); openDrawer(); }

    document.querySelectorAll('input[name="fries"]').forEach(r=>{
      r.addEventListener("change", ()=>{ cart.fries=r.value; saveCart(); document.querySelector("#friesHint").textContent = `Seleccionado: ${r.value==="con_sazon"?"Con sazón":"Sin sazonar"}.`; });
    });

    const drawer=$("#drawer"), cartItems=$("#cartItems"), cartTotal=$("#cartTotal");
    function renderCart(){
      cartItems.innerHTML="";
      for(const o of Object.values(cart.burger)){
        const ex=[]; if(o.extras?.patty) ex.push(`+${o.extras.patty} medallón(es)`); if(o.extras?.cheddar) ex.push(`+${o.extras.cheddar} cheddar`);
        cartItems.innerHTML += `
          <div class="item">
            <div>
              <strong>${o.item.name}</strong>
              ${ex.length?`<div class="muted">${ex.join(" · ")}</div>`:""}
              ${o.notes?`<div class="muted">Notas: ${o.notes}</div>`:""}
            </div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('burger','${o.item.id}',-1)">-</button>
              <span>${o.qty}</span>
              <button class="btn ghost" onclick="changeQty('burger','${o.item.id}',1)">+</button>
              <span>${money(o.item.price*o.qty)}</span>
            </div>
          </div>`;
      }
      for(const o of Object.values(cart.drink)){
        cartItems.innerHTML += `
          <div class="item">
            <div><strong>${o.item.name}</strong></div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn ghost" onclick="changeQty('drink','${o.item.id}',-1)">-</button>
              <span>${o.qty}</span>
              <button class="btn ghost" onclick="changeQty('drink','${o.item.id}',1)">+</button>
              <span>${money(o.item.price*o.qty)}</span>
            </div>
          </div>`;
      }
      cartTotal.textContent=money(calcTotal());
      document.querySelector("#btnCart").innerHTML=`Ver pedido <span class="muted">(${cartCount()})</span>`;
    }
    function changeQty(type,id,delta){ const bucket=cart[type]; if(!bucket) return; const cur=bucket[id]?.qty||0; const next=Math.max(0,cur+delta); if(next===0) delete bucket[id]; else bucket[id].qty=next; saveCart(); renderCart(); }

    const overlay=$("#overlay"), modTitle=$("#modTitle");
    const qtyVal=$("#qtyVal"), qtyInc=$("#qtyInc"), qtyDec=$("#qtyDec");
    const rowPatties=$("#rowPatties"), rowCheddar=$("#rowCheddar"), noExtras=$("#noExtras"), cheHint=$("#cheHint");
    const patVal=$("#patVal"), patInc=$("#patInc"), patDec=$("#patDec");
    const cheVal=$("#cheVal"), cheInc=$("#cheInc"), cheDec=$("#cheDec");
    const notes=$("#notes"), btnAdd=$("#btnAdd"), btnCancel=$("#btnCancel");
    let currentItem=null;

    function openCustomize(item){
      currentItem=item; modTitle.textContent="Personalizar: "+item.name;
      qtyVal.textContent="1"; notes.value=""; patVal.textContent="0"; cheVal.textContent="0";
      if(item.kind==="double"){ rowPatties.style.display="flex"; rowCheddar.style.display="flex"; cheHint.textContent="(máx. +3)"; noExtras.style.display="none"; }
      else if(item.kind==="chicken"){ rowPatties.style.display="none"; rowCheddar.style.display="flex"; cheHint.textContent="(máx. +3)"; noExtras.style.display="none"; }
      else { rowPatties.style.display="none"; rowCheddar.style.display="none"; noExtras.style.display="block"; }
      overlay.classList.add("open");
    }
    function closeCustomize(){ overlay.classList.remove("open"); }
    qtyInc.onclick=()=>qtyVal.textContent=String(Math.min(99,(+qtyVal.textContent||1)+1));
    qtyDec.onclick=()=>qtyVal.textContent=String(Math.max(1,(+qtyVal.textContent||1)-1));
    patInc.onclick=()=>{ if(+patVal.textContent<2) patVal.textContent=(+patVal.textContent)+1; };
    patDec.onclick=()=>{ if(+patVal.textContent>0) patVal.textContent=(+patVal.textContent)-1; };
    cheInc.onclick=()=>{ if(+cheVal.textContent<3) cheVal.textContent=(+cheVal.textContent)+1; };
    cheDec.onclick=()=>{ if(+cheVal.textContent>0) cheVal.textContent=(+cheVal.textContent)-1; };
    btnCancel.onclick=closeCustomize;
    btnAdd.onclick=()=>{
      const qty=+qtyVal.textContent||1;
      const extras={patty:0,cheddar:0};
      if(currentItem.kind==="double"){ extras.patty=+patVal.textContent||0; extras.cheddar=+cheVal.textContent||0; }
      else if(currentItem.kind==="chicken"){ extras.cheddar=+cheVal.textContent||0; }
      const txt=notes.value.trim();
      const bucket=cart.burger||(cart.burger={});
      const prev=bucket[currentItem.id];
      if(prev){ prev.qty+=qty; if(txt) prev.notes=txt; }
      else{ bucket[currentItem.id]={qty, item:currentItem, extras, ...(txt?{notes:txt}:{})}; }
      saveCart(); renderCart(); closeCustomize(); openDrawer();
    };

    function openDrawer(){ document.querySelector("#drawer").classList.add("open"); }
    function closeDrawer(){ document.querySelector("#drawer").classList.remove("open"); }
    document.querySelector("#btnCart").onclick=openDrawer; document.querySelector("#closeDrawer").onclick=closeDrawer;
    document.querySelector("#btnVaciar").onclick=()=>{ cart={burger:{},drink:{},fries:null}; saveCart(); renderCart(); };
    document.querySelector("#btnContacto").onclick=()=>location.href="contacto.html";

    document.querySelector("#btnIrPagar").onclick=()=>{
      if(!cart.fries){
        alert("Elegí una opción de papas (Con sazón o Sin sazonar) para continuar.");
        document.getElementById("friesSection").scrollIntoView({behavior:"smooth"});
        return;
      }
      try{ sessionStorage.setItem(CART_KEY, JSON.stringify(cart)); }catch{}
      const b64 = enc(cart);
      setCookie("cart", b64, 1800); // 30 min
      location.href = `pedido_cliente.html?cart=${encodeURIComponent(b64)}`;
    };

    mount();
  </script>
</body>
</html>
