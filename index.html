<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mostrador ‚Ä¢ Rhodes Burgers</title>
  <link rel="icon" href="images/logo.png" />

  <style>
    :root{
      --primary:#625A45;
      --text:#111;
      --muted:#666;
      --bg:#f6f6f6;
      --card:#fff;
      --radius:18px;
      --ring:#eaeaea;
      --shadow:0 10px 30px rgba(0,0,0,.08);

      --price-patty:2500;
      --price-cheddar:300;
    }

    *{box-sizing:border-box;}
    html,body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }

    /* ========== HEADER (igual a index) ========== */
    header{
      position:sticky;
      top:0;
      z-index:20;
      background:#fff;
      box-shadow:0 2px 12px rgba(0,0,0,.06)
    }
    .topbar{
      max-width:1100px;
      margin:0 auto;
      padding:10px 12px;
      display:flex;
      align-items:center;
      gap:12px
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color:inherit
    }
    .brand img{
      width:40px;
      height:40px;
      border-radius:10px;
      background:#fff;
      object-fit:contain
    }
    .brand strong{
      font-weight:800;
    }

    .spacer{flex:1;}

    .btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      border:2px solid var(--primary);
      padding:10px 16px;
      border-radius:999px;
      color:var(--primary);
      background:#fff;
      font-weight:700;
      text-decoration:none;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn.primary{
      background:var(--primary);
      color:#fff;
      border-color:var(--primary);
    }
    .btn.ghost{
      border-color:#e7e7e7;
      color:#333;
    }

    /* ========== MAIN LAYOUT ========== */
    .container{
      max-width:1100px;
      margin:24px auto;
      padding:0 12px;
      display:grid;
      grid-template-columns:1fr 400px;
      gap:20px;
    }
    @media(max-width:900px){
      .container{
        grid-template-columns:1fr;
      }
    }

    h1{font-size:34px;margin:14px 4px 18px}
    h2{font-size:26px;margin:24px 4px 14px}
    h3{font-size:18px;margin:8px 0 6px}
    p{margin:6px 0;color:var(--muted)}

    /* ========== PRODUCT GRID ========== */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
      gap:18px;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      position:relative;
    }
    .card img{
      width:100%;
      height:180px;
      object-fit:cover;
      background:#eee;
      border-bottom:1px solid #ddd;
    }
    .card .content{
      padding:12px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:8px;
    }
    .price{
      font-weight:800;
    }

    /* ========== CARRITO FIJO (MOSTRADOR) ========== */
    aside.side{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px;
      height:fit-content;
      position:sticky;
      top:80px;
    }

    .total{
      display:flex;
      justify-content:space-between;
      font-weight:800;
      font-size:22px;
      margin-bottom:16px;
    }

    .item{
      padding:12px 0;
      border-bottom:1px solid #eee;
    }

    .field{
      display:flex;
      flex-direction:column;
      margin-top:16px;
      gap:6px;
    }
    .field input,
    .field select{
      padding:12px;
      border-radius:12px;
      border:1px solid var(--ring);
      font-size:15px;
    }

    /* ========== HORARIOS (CARRUSEL) ========== */
    .carousel{
      display:flex;
      align-items:center;
      gap:12px;
      margin-top:16px;
    }
    .arrow{
      width:44px;height:44px;
      display:grid;
      place-items:center;
      background:#fff;
      border-radius:12px;
      border:1px solid var(--ring);
      cursor:pointer;
      user-select:none;
      font-size:20px;
      font-weight:800;
    }
    .arrow.disabled{
      opacity:.4;
      cursor:not-allowed;
    }
    .slot-display{
      min-width:160px;
      padding:12px 14px;
      text-align:center;
      background:#fff;
      border-radius:14px;
      border:1px solid var(--ring);
      font-size:18px;
      font-weight:800;
    }

    /* ========== MODAL ‚Äî ID√âNTICO A INDEX.HTML ========== */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.25);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .overlay.open{
      display:flex;
    }

    .modal{
      background:#fff;
      width:580px;
      max-width:92vw;
      border-radius:20px;
      padding:24px;
      box-shadow:var(--shadow);
      animation:pop .25s ease-out;
    }
    @keyframes pop{
      from{transform:scale(.92);opacity:0}
      to{transform:scale(1);opacity:1}
    }

    .rowx{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin:12px 0;
      gap:12px;
    }
    .rowx[style*="column"]{
      align-items:flex-start!important;
    }

    .inline{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }

    .pill{
      display:flex;
      gap:8px;
      align-items:center;
      border:1px solid var(--ring);
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      cursor:pointer;
    }
    .pill input{
      accent-color:var(--primary);
    }

    .qtybox{
      display:flex;
      gap:10px;
      align-items:center;
      border:1px solid var(--ring);
      padding:6px 12px;
      border-radius:999px;
    }
    .qtybox button{
      width:30px;height:30px;
      border-radius:999px;
      border:1px solid #ddd;
      background:#fff;
      font-weight:900;
      cursor:pointer;
    }

    .pricePreview{
      background:#f7f3ee;
      border:1px solid #e8e0d4;
      padding:8px 14px;
      border-radius:999px;
      font-size:16px;
      font-weight:800;
    }

    textarea{
      width:100%;
      min-height:80px;
      padding:10px;
      border-radius:14px;
      border:1px solid var(--ring);
    }
  </style>
</head>
<body>

<!-- HEADER (id√©ntico a index, con accesos del admin/mostrador) -->
<header>
  <div class="topbar">
    <a href="#" class="brand">
      <img src="images/logo.png" alt="">
      <strong>Rhodes Burgers</strong>
    </a>

    <div class="spacer"></div>

    <a class="btn ghost" href="pedido_local.html">üì¶ Pedidos</a>
    <a class="btn ghost" href="finanzas.html">üìà Finanzas</a>
    <a class="btn ghost" href="admin.html">‚öôÔ∏è Admin</a>

    <strong style="margin-left:10px;font-size:18px;color:var(--primary)">
      Mostrador
    </strong>
  </div>
</header>

<!-- CONTENIDO PRINCIPAL -->
<main class="container">

  <!-- ======================== LISTA DE PRODUCTOS ========================== -->
  <section>
    <h1>Men√∫</h1>

    <h2>Hamburguesas</h2>
    <div id="burgersGrid" class="grid"></div>

    <h2>Guarniciones</h2>
    <div id="sidesGrid" class="grid"></div>

    <h2>Bebidas</h2>
    <div id="drinksGrid" class="grid"></div>
  </section>

  <!-- ============================= CARRITO ================================ -->
  <aside class="side">

    <h2 style="margin-top:0">Carrito</h2>

    <div class="total">
      <span>Total</span>
      <span id="cartTotal">$0</span>
    </div>

    <div id="cartItems" class="muted">Sin √≠tems.</div>

    <!-- Nombre -->
    <div class="field">
      <label>Nombre (requerido)</label>
      <input id="inpNombre" type="text" placeholder="Ej: Juan">
    </div>

    <!-- Tel -->
    <div class="field">
      <label>Tel√©fono (opcional)</label>
      <input id="inpTel" type="tel" placeholder="Ej: 1123456789">
    </div>

    <!-- Pago -->
    <div class="field">
      <label>M√©todo de pago</label>
      <select id="selPago">
        <option value=""></option>
        <option value="efectivo">Efectivo</option>
        <option value="mercado_pago">Mercado Pago</option>
        <option value="debito">D√©bito</option>
        <option value="transferencia">Transferencia</option>
      </select>
    </div>

    <!-- ================= CARRUSEL DE HORARIOS ================= -->
    <h3 style="margin-top:24px">Horario de retiro</h3>

    <div class="carousel">
      <div class="arrow" id="slotPrev">‚óÄ</div>
      <div class="slot-display" id="slotLabel">--:--</div>
      <div class="arrow" id="slotNext">‚ñ∂</div>
    </div>

    <div id="miniSlotSub" class="muted" style="margin-top:8px;font-size:14px;">
      Seleccionado: ‚Äî
    </div>

    <!-- BOT√ìN CARGAR PEDIDO -->
    <button id="btnCargarPedido" class="btn primary" style="width:100%;margin-top:22px">
      Cargar pedido
    </button>

  </aside>
</main>
<!-- ====================== MODAL DE PERSONALIZAR ====================== -->
<div class="overlay" id="overlayCustomize">
  <div class="modal">

    <h3 id="modTitle">Personalizar</h3>

    <!-- PAPAS -->
    <div class="rowx" style="align-items:flex-start;flex-direction:column">
      <div class="muted" style="font-weight:600">Papas (obligatorio)</div>

      <div class="inline" id="friesOptionsInline">
        <label class="pill"><input type="radio" name="fries" value="con_sazon"> Sazonadas</label>
        <label class="pill"><input type="radio" name="fries" value="con_sal"> Con sal</label>
        <label class="pill"><input type="radio" name="fries" value="sin_sal"> Sin sal</label>
      </div>

      <div id="friesStateNote" class="micro"></div>
      <div class="micro">Se toma lo que elijas ac√° por cada hamburguesa.</div>
    </div>

    <!-- EXTRAS: MEDALLONES -->
    <div class="rowx" id="rowPatties" style="display:none">
      <div>Medallones extra</div>
      <div class="qtybox">
        <button id="patDec">-</button>
        <span id="patVal">0</span>
        <button id="patInc">+</button>
      </div>
    </div>

    <!-- EXTRAS: CHEDDAR -->
    <div class="rowx" id="rowCheddar" style="display:none">
      <div>Fetas de cheddar extra</div>
      <div class="qtybox">
        <button id="cheDec">-</button>
        <span id="cheVal">0</span>
        <button id="cheInc">+</button>
      </div>
    </div>

    <!-- PRECIOS DETALLADOS -->
    <div class="rowx" style="flex-direction:column; align-items:flex-start; gap:6px; margin-top:10px;">

      <div class="muted" id="precioBaseTxt">Precio base: ‚Äî</div>
      <div class="muted" id="precioPattyTxt" style="display:none;">Medall√≥n extra (x0): ‚Äî</div>
      <div class="muted" id="precioCheddarTxt" style="display:none;">Cheddar extra (x0): ‚Äî</div>

      <div style="display:flex; justify-content:space-between; width:100%; margin-top:6px;">
        <span class="muted">Subtotal</span>
        <span id="subtotalTxt" class="muted" style="font-weight:600;">$ 0</span>
      </div>

      <div style="display:flex; justify-content:space-between; width:100%; align-items:center; margin-top:10px;">
        <strong>Precio final</strong>
        <span id="pricePreview" class="pricePreview">$ 0</span>
      </div>

    </div>

    <!-- NOTAS -->
    <div class="rowx" style="align-items:flex-start;flex-direction:column">
      <label>Notas (opcional)</label>
      <textarea id="notes" placeholder="Sin cebolla, extra salsa, etc."></textarea>
      <div id="notesCount" class="muted">0/200</div>
    </div>

    <!-- BOTONES -->
    <div class="rowx" style="justify-content:flex-end">
      <button class="btn ghost" id="btnCancel">Cancelar</button>
      <button class="btn primary" id="btnAdd">Agregar al carrito</button>
    </div>

  </div>
</div>
<!-- ====================== FIREBASE INIT ====================== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  /* ===== Firebase Init ===== */
  const firebaseConfig = {
    apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
    authDomain: "rhodes-burguers.firebaseapp.com",
    projectId: "rhodes-burguers",
    storageBucket: "rhodes-burguers.firebasestorage.app",
    messagingSenderId: "951646688091",
    appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();


  /* ============================================================
        üî• CARGA DE PRODUCTOS DESDE FIRESTORE
  ============================================================ */
  const FALLBACK_IMG = "images/logo.png";

  let BURGERS = [];
  let SIDES   = [];
  let DRINKS  = [];

  function mapProduct(doc){
    const d = doc.data();
    return {
      id: doc.id,
      name: d.name,
      price: d.price,
      img: d.img || FALLBACK_IMG,
      desc: d.description || "",
      category: d.category || "",
      kind: d.kind || ""
    };
  }

  db.collection("products").onSnapshot(snap=>{
    const b = [], s = [], d = [];

    snap.forEach(doc=>{
      const p = mapProduct(doc);

      if(p.category === "hamburguesas") b.push(p);
      if(p.category === "guarniciones") s.push(p);
      if(p.category === "bebidas")      d.push(p);
    });

    BURGERS = b;
    SIDES   = s;
    DRINKS  = d;

    mountMenu();
  });


  /* ============================================================
        üî• ORDEN VISUAL DEL MEN√ö (desde admin)
  ============================================================ */
  let MENU_ORDER = {};  
  // Ejemplo en Firestore:
  // { hamburguesas:["id1","id2"], guarniciones:["idX"], bebidas:["idY","idZ"] }

  db.collection("config").doc("menuOrder").onSnapshot(snap=>{
    MENU_ORDER = snap.exists ? snap.data() : {};
    mountMenu();
  });

  function orderedList(category, arr){
    const order = MENU_ORDER[category] || [];
    const ordMap = new Map(order.map((id,i)=>[id,i]));

    return [...arr].sort((a,b)=>{
      const A = ordMap.has(a.id) ? ordMap.get(a.id) : 9999;
      const B = ordMap.has(b.id) ? ordMap.get(b.id) : 9999;
      return A - B;
    });
  }


  /* ============================================================
        üî• DISPONIBILIDAD (SIN STOCK)
  ============================================================ */
  const availability = new Map();
  const isAvailable = id => availability.get(id) !== false;

  db.collection("products").onSnapshot(snap=>{
    availability.clear();

    snap.forEach(doc=>{
      const d = doc.data();
      availability.set(doc.id, d.available !== false);
    });

    refreshAvailabilityUI();
  });

  function refreshAvailabilityUI(){
    document.querySelectorAll(".card[data-id]").forEach(card=>{
      const id = card.dataset.id;
      const ok = isAvailable(id);

      card.dataset.soldout = ok ? "0" : "1";

      let badge = card.querySelector(".soldout-badge");

      if(!ok){
        if(!badge){
          badge = document.createElement("div");
          badge.className = "soldout-badge";
          badge.textContent = "SIN STOCK";
          card.querySelector(".imgwrap").appendChild(badge);
        }
      } else {
        if(badge) badge.remove();
      }
    });
  }


  /* ============================================================
        üî• RENDER DE TARJETAS (id√©ntico a index)
  ============================================================ */

  function renderCard(item, type){
    const ok = isAvailable(item.id);

    const card = document.createElement("div");
    card.className = "card";
    card.dataset.id = item.id;
    card.dataset.soldout = ok ? "0" : "1";

    card.innerHTML = `
      <div class="imgwrap">
        <img src="${item.img}" onerror="this.src='${FALLBACK_IMG}'">
        ${ok ? "" : `<div class="soldout-badge">SIN STOCK</div>`}
      </div>

      <div class="content">
        <h3>${item.name}</h3>
        ${item.desc ? `<p class="muted">${item.desc}</p>` : ""}

        <div class="row">
          <span class="price">${money(item.price)}</span>

          <div class="actions">
            <button class="btn" data-add ${ok?"":"disabled"}>Agregar</button>
          </div>
        </div>
      </div>
    `;

    const addBtn = card.querySelector("[data-add]");

    addBtn.onclick = ()=>{
      if(type === "drink"){
        addDrink(item);
      } else {
        openCustomize(item);
      }
    };

    return card;
  }


  /* ============================================================
        üî• MONTAR LA UI COMPLETA
  ============================================================ */
  const gridBurgers = document.getElementById("burgersGrid");
  const gridSides   = document.getElementById("sidesGrid");
  const gridDrinks  = document.getElementById("drinksGrid");

  function mountMenu(){
    if(!BURGERS.length && !SIDES.length && !DRINKS.length) return;

    gridBurgers.innerHTML = "";
    gridSides.innerHTML   = "";
    gridDrinks.innerHTML  = "";

    orderedList("hamburguesas", BURGERS)
      .forEach(b=> gridBurgers.appendChild(renderCard(b, "burger")));

    orderedList("guarniciones", SIDES)
      .forEach(s=> gridSides.appendChild(renderCard(s, "side")));

    orderedList("bebidas", DRINKS)
      .forEach(d=> gridDrinks.appendChild(renderCard(d, "drink")));

    refreshAvailabilityUI();
  }
</script>
<script>
/* ============================================================
      üî• UTILS
============================================================ */
const EXTRA_PRICE_PATTY   = 2500;
const EXTRA_PRICE_CHEDDAR = 300;

const $ = s => document.querySelector(s);
const money = n => (Number(n)||0).toLocaleString("es-AR",{
  style:"currency",currency:"ARS",maximumFractionDigits:0
});


/* ============================================================
      üî• CARRITO DEL MOSTRADOR
============================================================ */
let cart = loadCart();

function loadCart(){
  try{
    return JSON.parse(localStorage.getItem("rb_cart_mostrador_v2")) || {
      burger:{},
      drink:{},
      side:{}
    };
  }catch(e){
    return { burger:{}, drink:{}, side:{} };
  }
}

function saveCart(){
  localStorage.setItem("rb_cart_mostrador_v2", JSON.stringify(cart));
}


/* ============================================================
      üî• RENDER DEL CARRITO (ID√âNTICO A INDEX)
============================================================ */
function renderCart(){
  saveCart();

  let html = "";
  let total = 0;

  /* ---------------- HAMBURGUESAS ---------------- */
  for(const key in cart.burger){
    const obj = cart.burger[key];
    const item = obj.item;

    let unit = item.price
      + obj.extras.patty   * EXTRA_PRICE_PATTY
      + obj.extras.cheddar * EXTRA_PRICE_CHEDDAR;

    total += unit * obj.qty;

    let extrasTxt = "";

    extrasTxt += `Papas: ${friesLabel(obj.fries)} ¬∑ `;

    if(obj.extras.patty)   extrasTxt += `+${obj.extras.patty} med ¬∑ `;
    if(obj.extras.cheddar) extrasTxt += `+${obj.extras.cheddar} cheddar ¬∑ `;
    if(obj.notes)          extrasTxt += `Nota: ${obj.notes}`;

    html += `
      <div class="item">
        <div>
          <strong>${obj.qty}√ó ${item.name}</strong><br>
          <span class="muted">${extrasTxt}</span>
        </div>

        <div style="display:flex;align-items:center;gap:10px">
          <button class="btn ghost" onclick="changeQty('burger','${key}',-1)">-</button>
          <span>${obj.qty}</span>
          <button class="btn ghost" onclick="changeQty('burger','${key}',1)">+</button>
        </div>

        <div style="font-weight:700">${money(unit * obj.qty)}</div>
      </div>
    `;
  }

  /* ---------------- BEBIDAS ---------------- */
  for(const key in cart.drink){
    const obj = cart.drink[key];
    const item = obj.item;

    const subtotal = item.price * obj.qty;
    total += subtotal;

    html += `
      <div class="item">
        <div><strong>${obj.qty}√ó ${item.name}</strong></div>

        <div style="display:flex;align-items:center;gap:10px">
          <button class="btn ghost" onclick="changeQty('drink','${key}',-1)">-</button>
          <span>${obj.qty}</span>
          <button class="btn ghost" onclick="changeQty('drink','${key}',1)">+</button>
        </div>

        <div style="font-weight:700">${money(subtotal)}</div>
      </div>
    `;
  }

  /* ---------------- SIDES ---------------- */
  for(const key in cart.side){
    const obj = cart.side[key];
    const item = obj.item;

    const subtotal = item.price * obj.qty;
    total += subtotal;

    html += `
      <div class="item">
        <div><strong>${obj.qty}√ó ${item.name}</strong></div>

        <div style="display:flex;align-items:center;gap:10px">
          <button class="btn ghost" onclick="changeQty('side','${key}',-1)">-</button>
          <span>${obj.qty}</span>
          <button class="btn ghost" onclick="changeQty('side','${key}',1)">+</button>
        </div>

        <div style="font-weight:700">${money(subtotal)}</div>
      </div>
    `;
  }

  $("#cartItems").innerHTML = html || `<span class="muted">Sin √≠tems.</span>`;
  $("#cartTotal").textContent = money(total);
}

function changeQty(type, key, delta){
  const bucket = cart[type];
  if(!bucket[key]) return;

  bucket[key].qty += delta;

  if(bucket[key].qty <= 0){
    delete bucket[key];
  }

  renderCart();
}


/* ============================================================
      üî• AGREGAR BEBIDA
============================================================ */
function addDrink(item){
  if(!cart.drink[item.id]){
    cart.drink[item.id] = { qty:0, item };
  }
  cart.drink[item.id].qty++;

  renderCart();
}


/* ============================================================
      üî• MODAL DE PERSONALIZACI√ìN
============================================================ */
const overlay = document.getElementById("overlayCustomize");

const patVal = document.getElementById("patVal");
const cheVal = document.getElementById("cheVal");

const rowPatties = document.getElementById("rowPatties");
const rowCheddar = document.getElementById("rowCheddar");

let currentItem = null;

function friesLabel(code){
  if(code==="con_sazon") return "Sazonadas";
  if(code==="con_sal")   return "Con sal";
  if(code==="sin_sal")   return "Sin sal";
  return code;
}

function resetModal(){
  document.querySelectorAll("input[name='fries']").forEach(r=>r.checked=false);
  document.getElementById("notes").value = "";
  patVal.textContent = "0";
  cheVal.textContent = "0";
}

function openCustomize(item){
  currentItem = item;
  document.getElementById("modTitle").textContent = "Personalizar: " + item.name;

  resetModal();

  if(item.kind === "double"){
    rowPatties.style.display = "flex";
    rowCheddar.style.display = "flex";
  } else if(item.kind === "chicken"){
    rowPatties.style.display = "none";
    rowCheddar.style.display = "flex";
  } else {
    rowPatties.style.display = "none";
    rowCheddar.style.display = "none";
  }

  updatePreview();
  overlay.style.display = "flex";
}

document.getElementById("btnCancel").onclick = ()=>{
  overlay.style.display = "none";
};


/* ============================================================
      üî• PREVIEW DE PRECIOS
============================================================ */
function updatePreview(){
  const extras = {
    patty: Number(patVal.textContent),
    cheddar: Number(cheVal.textContent)
  };

  const base = currentItem.price;
  const p1 = extras.patty   * EXTRA_PRICE_PATTY;
  const p2 = extras.cheddar * EXTRA_PRICE_CHEDDAR;

  const subtotal = base + p1 + p2;

  document.getElementById("pricePreview").textContent = money(subtotal);
}

patInc.onclick = ()=>{ let v=+patVal.textContent; if(v<2){ patVal.textContent=v+1; updatePreview(); }};
patDec.onclick = ()=>{ let v=+patVal.textContent; if(v>0){ patVal.textContent=v-1; updatePreview(); }};
cheInc.onclick = ()=>{ let v=+cheVal.textContent; if(v<3){ cheVal.textContent=v+1; updatePreview(); }};
cheDec.onclick = ()=>{ let v=+cheVal.textContent; if(v>0){ cheVal.textContent=v-1; updatePreview(); }};


/* ============================================================
      üî• AGREGAR AL CARRITO DEL MOSTRADOR
============================================================ */
document.getElementById("btnAdd").onclick = ()=>{

  const friesEl = document.querySelector("input[name='fries']:checked");
  if(!friesEl){
    alert("Eleg√≠ un tipo de papas");
    return;
  }

  const extras = {
    patty:   Number(patVal.textContent),
    cheddar: Number(cheVal.textContent)
  };

  const notes = document.getElementById("notes").value.trim();

  const key =
    currentItem.id +
    "|f:" + friesEl.value +
    "|p:" + extras.patty +
    "|c:" + extras.cheddar +
    "|n:" + notes;

  if(!cart.burger[key]){
    cart.burger[key] = {
      qty: 1,
      item: currentItem,
      fries: friesEl.value,
      extras,
      notes
    };
  } else {
    cart.burger[key].qty++;
  }

  overlay.style.display = "none";
  renderCart();
};
</script>
<script>
/* ============================================================
      üî• ENV√çO A FIRESTORE ‚Äî MOSTRADOR
============================================================ */
async function sendToFirestore(){

  /* ---------------- VALIDACIONES ---------------- */
  const nombre = $("#inpNombre").value.trim();
  if(!nombre){
    alert("Ingres√° el nombre del cliente");
    return;
  }

  const pago = $("#selPago").value.trim();
  if(!pago){
    alert("Eleg√≠ un m√©todo de pago");
    return;
  }

  if(!window.selectedSlot){
    alert("Eleg√≠ un horario de retiro");
    return;
  }

  const tel  = $("#inpTel").value.trim();
  const slot = window.selectedSlot;

  /* ---------------- ARMAR ITEMS ---------------- */
  const items = [];
  let total = 0;

  /* === Hamburguesas === */
  for(const key in cart.burger){
    const b = cart.burger[key];
    const item = b.item;

    let unit = item.price
      + (b.extras.patty   * EXTRA_PRICE_PATTY)
      + (b.extras.cheddar * EXTRA_PRICE_CHEDDAR);

    total += unit * b.qty;

    items.push({
      type: "burger",
      id: item.id,
      name: item.name,
      qty: b.qty,
      price: unit,
      fries: b.fries,
      extras: b.extras,
      notes: b.notes || ""
    });
  }

  /* === Bebidas === */
  for(const key in cart.drink){
    const d = cart.drink[key];
    const item = d.item;

    const subtotal = item.price * d.qty;
    total += subtotal;

    items.push({
      type: "drink",
      id: item.id,
      name: item.name,
      qty: d.qty,
      price: item.price
    });
  }

  /* === Guarniciones === */
  for(const key in cart.side){
    const s = cart.side[key];
    const item = s.item;

    const subtotal = item.price * s.qty;
    total += subtotal;

    items.push({
      type: "side",
      id: item.id,
      name: item.name,
      qty: s.qty,
      price: item.price
    });
  }

  /* ---------------- OBJETO FINAL ---------------- */
  const order = {
    nombre,
    telefono: tel,
    pago,
    items,
    total,
    pickup_time: slot.iso,
    pickup_pretty: slot.pretty,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    status: "accepted",
    source: "mostrador"
  };

  /* ---------------- GUARDAR EN FIRESTORE ---------------- */
  try{
    await db.collection("orders").add(order);
    alert("Pedido cargado con √©xito ‚úîÔ∏è");

    // limpiar carrito
    cart = { burger:{}, drink:{}, side:{} };
    saveCart();
    renderCart();

    // limpiar campos
    $("#inpNombre").value = "";
    $("#inpTel").value = "";
    $("#selPago").value = "";

  }catch(e){
    console.error(e);
    alert("‚ö†Ô∏è Error cargando el pedido");
  }
}

/* ================= BOT√ìN ================= */
$("#btnCargarPedido").onclick = sendToFirestore;
</script>
