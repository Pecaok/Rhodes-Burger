<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rhodes Burgers - Menú</title>
<link rel="icon" href="images/logo.png"/>

<style>
:root{
  --primary:#2ecc71;
  --text:#111;
  --muted:#666;
  --bg:#f6f6f6;
  --card:#fff;
  --radius:18px;
  --shadow:0 10px 30px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}

/* Header */
header{
  position:sticky; top:0; z-index:20; background:#fff; box-shadow:0 2px 12px rgba(0,0,0,.06)
}
.topbar{
  max-width:1000px; margin:0 auto; padding:10px 12px; display:flex; align-items:center; gap:12px
}
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit}
.brand img{width:40px; height:40px; border-radius:10px; object-fit:contain; background:#fff}
.spacer{flex:1}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:10px;
  border:2px solid var(--primary); padding:10px 16px; border-radius:999px;
  color:var(--primary); background:#fff; font-weight:700; text-decoration:none; cursor:pointer
}
.btn.primary{background:var(--primary); color:#fff}
.btn.ghost{border-color:#e7e7e7; color:#333}

/* Layout */
.container{max-width:1000px; margin:24px auto; padding:0 12px}
h1{font-size:34px; margin:14px 4px 18px}
h2{font-size:26px; margin:24px 4px 14px}
h3{font-size:18px; margin:8px 0 6px}
p{margin:6px 0; color:var(--muted)}

.grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:16px}
.card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; display:flex; flex-direction:column}
.card img{width:100%; height:160px; object-fit:cover; background:#f0f0f0}
.card .content{padding:12px}
.row{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:8px}
.price{font-weight:800}
.actions{display:flex; gap:8px; flex-wrap:wrap}

/* Drawer (CARRITO) */
.drawer{
  position:fixed; top:0; right:-460px; width:460px; max-width:92vw; height:100vh;
  background:#fff; box-shadow:-8px 0 30px rgba(0,0,0,.18);
  transition:right .25s; z-index:30; display:flex; flex-direction:column
}
.drawer.open{right:0}
.drawer header{
  padding:14px 16px; box-shadow:0 2px 12px rgba(0,0,0,.06); display:flex; align-items:center; justify-content:space-between; flex:0 0 auto
}
.drawer .body{flex:1 1 auto; overflow:auto; -webkit-overflow-scrolling:touch; padding:14px 16px}
.drawer-footer{flex:0 0 auto; border-top:1px solid #efefef; background:#fff; padding:12px 16px calc(12px + env(safe-area-inset-bottom)); position:relative; z-index:1}
.drawer-footer .total{display:flex; align-items:center; justify-content:space-between; font-weight:800; font-size:18px}
.drawer-actions{margin-top:12px; display:flex; gap:10px}
.close{width:38px; height:38px; border-radius:999px; border:1px solid #eee; background:#fff; font-weight:900; cursor:pointer}

/* Cart item line */
.cart-item{display:flex; align-items:flex-start; justify-content:space-between; gap:10px; padding:10px 0; border-bottom:1px solid #efefef}
.cart-item .meta{font-size:13px; color:#666}
.qtybox{display:inline-flex; align-items:center; gap:6px; border:1px solid #e5e5e5; border-radius:999px; padding:6px 10px}
.qtybox button{width:26px; height:26px; border:1px solid #e5e5e5; background:#fff; border-radius:999px; font-weight:900; cursor:pointer}

/* Overlay (modal fondo) */
.overlay{position:fixed; inset:0; background:rgba(0,0,0,.25); display:none; align-items:center; justify-content:center; z-index:40}
.overlay.open{display:flex}

/* Modal personalizar */
.modal{
  background:#fff; border-radius:20px; box-shadow:var(--shadow); width:520px; max-width:92vw; padding:16px
}
.modal h3{margin:0 0 8px}
.rowx{display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0}
.muted{color:var(--muted); font-size:14px}
.inline{display:flex; gap:12px; flex-wrap:wrap}
.pill{display:inline-flex; align-items:center; gap:8px; border:1px solid #e7e7e7; border-radius:999px; padding:8px 12px}
textarea{width:100%; min-height:70px; padding:10px; border:1px solid #e7e7e7; border-radius:12px}

/* Toast */
.toast{position:fixed; left:50%; bottom:calc(16px + env(safe-area-inset-bottom)); transform:translateX(-50%); background:#111; color:#fff; padding:10px 14px; border-radius:999px; font-weight:600; z-index:9999; opacity:0}
</style>
</head>
<body>

<header>
  <div class="topbar">
    <a class="brand" href="index.html">
      <img src="images/logo.png" alt="Rhodes Burgers">
    </a>
    <div class="spacer"></div>
    <button class="btn primary" id="btnCart">Ver pedido <span id="cartCount">(0)</span></button>
  </div>
</header>

<main class="container">
  <h1>Menú</h1>

  <h2>Hamburguesas</h2>
  <div id="burgersGrid" class="grid"></div>

  <h2>Bebidas</h2>
  <div id="drinksGrid" class="grid"></div>
</main>

<!-- Drawer Carrito -->
<aside class="drawer" id="drawer">
  <header>
    <strong>Tu pedido</strong>
    <button class="close" id="closeDrawer">✕</button>
  </header>

  <div class="body" id="cartBody">
    <div id="cartItems"></div>
  </div>

  <footer class="drawer-footer">
    <div class="total">
      <span>Total</span>
      <span id="cartTotal">$0</span>
    </div>
    <div class="drawer-actions">
      <button class="btn ghost" id="btnVaciar">Vaciar</button>
      <button class="btn primary" id="btnIrPagar">Ir a pagar</button>
    </div>
  </footer>
</aside>

<!-- Modal Personalizar -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h3 id="modTitle">Personalizar</h3>

    <div class="rowx">
      <div>Cantidad</div>
      <div class="qtybox">
        <button id="qtyDec">-</button>
        <span id="qtyVal">1</span>
        <button id="qtyInc">+</button>
      </div>
    </div>

    <div class="rowx" style="align-items:flex-start; flex-direction:column">
      <div class="muted" style="font-weight:700; color:#111">Papas (obligatorio)</div>
      <div class="inline">
        <label class="pill"><input type="radio" name="modFries" value="con_sazon"> Con sazón</label>
        <label class="pill"><input type="radio" name="modFries" value="sin_sazon"> Sin sazonar</label>
      </div>
    </div>

    <div id="rowPatties" class="rowx" style="display:none">
      <div>
        Medallones extra <span class="muted">(máx. +2)</span> <span class="muted" id="patPrice"></span>
      </div>
      <div class="qtybox">
        <button id="patDec">-</button>
        <span id="patVal">0</span>
        <button id="patInc">+</button>
      </div>
    </div>

    <div id="rowCheddar" class="rowx" style="display:none">
      <div>
        Fetas de cheddar extra <span class="muted" id="cheHint">(máx. +3)</span>
        <span class="muted" id="chePrice"></span>
      </div>
      <div class="qtybox">
        <button id="cheDec">-</button>
        <span id="cheVal">0</span>
        <button id="cheInc">+</button>
      </div>
    </div>

    <div class="rowx" style="align-items:flex-start; flex-direction:column">
      <label>Notas (opcional)</label>
      <textarea id="notes" placeholder="Sin cebolla, extra salsa, etc."></textarea>
    </div>

    <div class="rowx" style="justify-content:flex-end">
      <button class="btn ghost" id="btnCancel">Cancelar</button>
      <button class="btn primary" id="btnAdd">Agregar al carrito</button>
    </div>
  </div>
</div>

<script>
/* ================== CONFIG / DATA ================== */
const EXTRA_PRICE_PATTY   = 1500;  // precio por medallón extra
const EXTRA_PRICE_CHEDDAR = 400;   // precio por feta de cheddar extra

const BURGERS = [
  { id:"bigjohn_simple",  name:"Big John Simple",     price:10900, img:"images/Big John Simple.jpg",   kind:"simple",  desc:"Incluye papas fritas." },
  { id:"bigjohn_doble",   name:"Big John Doble",      price:13900, img:"images/Big John Doble.jpg",    kind:"double",  desc:"Incluye papas fritas." },
  { id:"burguesa_simple", name:"Burguesa Simple",     price:11900, img:"images/Burguesa Simple.jpg",   kind:"simple",  desc:"Incluye papas fritas." },
  { id:"burguesa_doble",  name:"Burguesa Doble",      price:14900, img:"images/Burguesa Doble.jpg",    kind:"double",  desc:"Incluye papas fritas." },
  { id:"cheesebacon_spl", name:"CheeseBacon Simple",  price:10500, img:"images/CheeseBacon Simple.jpg",kind:"simple",  desc:"Incluye papas fritas." },
  { id:"cheesebacon_dbl", name:"CheeseBacon Doble",   price:13500, img:"images/CheeseBacon Doble.jpg", kind:"double",  desc:"Incluye papas fritas." },
  { id:"cheese_simple",   name:"Cheeseburger Simple", price:9500,  img:"images/cheeseburger simple.jpg",kind:"simple",  desc:"Incluye papas fritas." },
  { id:"cheese_doble",    name:"Cheeseburger Doble",  price:12500, img:"images/cheeseburger doble.jpg",kind:"double",  desc:"Incluye papas fritas." },
  { id:"rhodes_simple",   name:"Rhodes Simple",       price:11900, img:"images/Rhodes Simple.jpg",     kind:"simple",  desc:"Incluye papas fritas." },
  { id:"rhodes_doble",    name:"Rhodes Doble",        price:14900, img:"images/Rhodes Doble.jpg",      kind:"double",  desc:"Incluye papas fritas." },
  { id:"morgan_simple",   name:"Morgan Simple",       price:10900, img:"images/Morgan Simple.jpg",     kind:"simple",  desc:"Incluye papas fritas." },
  { id:"morgan_doble",    name:"Morgan Doble",        price:14500, img:"images/Morgan Doble.jpg",      kind:"double",  desc:"Incluye papas fritas." },
  { id:"pollo_crispy",    name:"Pollo Crispy",        price:8900,  img:"images/Pollo crispy.jpg",      kind:"chicken", desc:"Incluye papas fritas." },
  { id:"test_1peso",      name:"Hamburguesa Test $1", price:1,     img:"images/logo.png",              kind:"simple",  desc:"Para pruebas." }
];
const DRINKS = [
  { id:"coca_org",  name:"Coca-Cola 500ml", price:0, img:"images/coca cola original.jpg" },
  { id:"coca_zero", name:"Coca-Cola Zero 500ml", price:0, img:"images/coca cola zero.jpg" },
];

/* ================== UTIL ================== */
const $ = s => document.querySelector(s);
const money = n => (Number(n)||0).toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});
const CART_KEY = "rhodes_cart_v3";
let cart = loadCart();

function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)) || {burger:{},drink:{}}; }catch{ return {burger:{},drink:{}}; } }
function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCount(); }
function cartCount(){
  let n=0; for(const b of Object.values(cart.burger)) n+=b.qty; for(const d of Object.values(cart.drink)) n+=d.qty; return n;
}
function updateCount(){ $("#cartCount").textContent = `(${cartCount()})`; }

/* Calcula total incluyendo extras */
function calcTotal(){
  let t=0;
  for(const b of Object.values(cart.burger)){
    const base=(b.item?.price||0);
    const extrasCost=(b.extras?.patty||0)*EXTRA_PRICE_PATTY + (b.extras?.cheddar||0)*EXTRA_PRICE_CHEDDAR;
    t += (base+extrasCost)*b.qty;
  }
  for(const d of Object.values(cart.drink)) t += (d.item?.price||0)*d.qty;
  return t;
}

/* ================== RENDER CARDS ================== */
const gridBurgers = $("#burgersGrid"), gridDrinks = $("#drinksGrid");
function renderCard(item,type){
  const card=document.createElement("div");
  card.className="card";
  const imgSrc = item.img || "images/logo.png";
  card.innerHTML=`
    <img src="${imgSrc}" alt="${item.name}" onerror="this.onerror=null;this.src='images/logo.png'">
    <div class="content">
      <h3>${item.name}</h3>
      ${item.desc?`<p class="muted" style="margin:4px 0 0">${item.desc}</p>`:""}
      <div class="row">
        <span class="price">${money(item.price)}</span>
        <div class="actions">
          <button class="btn" data-quick>Agregar</button>
          ${type==="burger" ? `<button class="btn" data-custom>Personalizar</button>`:""}
        </div>
      </div>
    </div>`;
  if(type==="drink"){
    card.querySelector("[data-quick]").onclick = ()=> quickAddDrink(item);
  }else{
    // CAMBIO: quick abre modal (para elegir papas, sin abrir carrito)
    card.querySelector("[data-quick]").onclick  = ()=> openCustomize(item, true);
    card.querySelector("[data-custom]").onclick = ()=> openCustomize(item, false);
  }
  return card;
}
function mount(){
  gridBurgers.innerHTML=""; BURGERS.forEach(b=>gridBurgers.appendChild(renderCard(b,"burger")));
  gridDrinks.innerHTML="";  DRINKS.forEach(d=>gridDrinks.appendChild(renderCard(d,"drink")));
  renderCart(); updateCount();
}

/* ================== DRAWER CARRITO ================== */
const drawer   = $("#drawer");
const cartItems= $("#cartItems");
const cartTotal= $("#cartTotal");

function renderCart(){
  const lines=[];
  for(const obj of Object.values(cart.burger)){
    const extrasTxt=[];
    if(obj.extras){
      if(obj.extras.patty) extrasTxt.push(`+${obj.extras.patty} medallón(es)`);
      if(obj.extras.cheddar) extrasTxt.push(`+${obj.extras.cheddar} cheddar`);
    }
    const unit = obj.item.price + (obj.extras?.patty||0)*EXTRA_PRICE_PATTY + (obj.extras?.cheddar||0)*EXTRA_PRICE_CHEDDAR;
    const friesLabel = obj.fries==="con_sazon" ? "Con sazón" : (obj.fries==="sin_sazon" ? "Sin sazonar" : "-");

    lines.push(`
      <div class="cart-item">
        <div>
          <div><strong>${obj.item.name}</strong></div>
          <div class="meta">Papas: ${friesLabel}${extrasTxt.length?` · ${extrasTxt.join(" · ")}`:""}</div>
        </div>
        <div style="display:flex; align-items:center; gap:10px">
          <div class="qtybox">
            <button onclick="changeQty('burger','${obj.item.id}',-1)">-</button>
            <span>${obj.qty}</span>
            <button onclick="changeQty('burger','${obj.item.id}',1)">+</button>
          </div>
          <div>${money(unit*obj.qty)}</div>
        </div>
      </div>
    `);
  }
  for(const obj of Object.values(cart.drink)){
    lines.push(`
      <div class="cart-item">
        <div><strong>${obj.item.name}</strong></div>
        <div style="display:flex; align-items:center; gap:10px">
          <div class="qtybox">
            <button onclick="changeQty('drink','${obj.item.id}',-1)">-</button>
            <span>${obj.qty}</span>
            <button onclick="changeQty('drink','${obj.item.id}',1)">+</button>
          </div>
          <div>${money(obj.item.price*obj.qty)}</div>
        </div>
      </div>
    `);
  }
  cartItems.innerHTML = lines.join("") || `<p class="muted">No hay productos en el carrito.</p>`;
  cartTotal.textContent = money(calcTotal());
}

function changeQty(type,id,delta){
  const bucket = cart[type]; if(!bucket) return;
  const cur = bucket[id]?.qty || 0;
  const next = Math.max(0, cur+delta);
  if(next===0) delete bucket[id]; else bucket[id].qty = next;
  saveCart(); renderCart();
}

function openDrawer(){
  drawer.classList.add("open");
  document.body.style.overflow="hidden";
}
function closeDrawer(){
  drawer.classList.remove("open");
  document.body.style.overflow="";
}
$("#btnCart").onclick = openDrawer;
$("#closeDrawer").onclick = closeDrawer;
$("#btnVaciar").onclick = ()=>{ cart={burger:{},drink:{}}; saveCart(); renderCart(); };
$("#btnIrPagar").onclick = ()=>{ window.location.href = "pedido_cliente.html"; };

/* ================== MODAL PERSONALIZAR ================== */
const overlay=$("#overlay"), modTitle=$("#modTitle");
const qtyVal=$("#qtyVal"), qtyInc=$("#qtyInc"), qtyDec=$("#qtyDec");
const rowPatties=$("#rowPatties"), rowCheddar=$("#rowCheddar");
const cheHint=$("#cheHint"), chePrice=$("#chePrice"), patPrice=$("#patPrice");
const patVal=$("#patVal"), patInc=$("#patInc"), patDec=$("#patDec");
const cheVal=$("#cheVal"), cheInc=$("#cheInc"), cheDec=$("#cheDec");
const notes=$("#notes"), btnAdd=$("#btnAdd"), btnCancel=$("#btnCancel");

let currentItem=null; // {id,name,price,kind}
let quickMode=true;

function openCustomize(item, quick=true){
  quickMode = quick;
  currentItem = item;
  modTitle.textContent = "Personalizar: " + item.name;
  qtyVal.textContent="1"; notes.value="";
  patVal.textContent="0"; cheVal.textContent="0";
  document.querySelectorAll('input[name="modFries"]').forEach(r=>r.checked=false);

  // Configurar extras por tipo
  if(item.kind==="double"){
    rowPatties.style.display="flex";
    rowCheddar.style.display="flex";
    cheHint.textContent="(máx. +3)";
    patPrice.textContent = ` · ${money(EXTRA_PRICE_PATTY)} c/u`;
    chePrice.textContent = ` · ${money(EXTRA_PRICE_CHEDDAR)} c/u`;
  }else if(item.kind==="chicken"){
    rowPatties.style.display="none";
    rowCheddar.style.display="flex";
    cheHint.textContent="(máx. +3)";
    patPrice.textContent = ``;
    chePrice.textContent = ` · ${money(EXTRA_PRICE_CHEDDAR)} c/u`;
  }else{
    rowPatties.style.display="none";
    rowCheddar.style.display="none";
    patPrice.textContent = ``; chePrice.textContent = ``;
  }
  overlay.classList.add("open");
}
function closeCustomize(){ overlay.classList.remove("open"); }

qtyInc.onclick = ()=> qtyVal.textContent = String(Math.min(99,(+qtyVal.textContent||1)+1));
qtyDec.onclick = ()=> qtyVal.textContent = String(Math.max(1,(+qtyVal.textContent||1)-1));
patInc.onclick = ()=> { if(+patVal.textContent < 2) patVal.textContent = (+patVal.textContent)+1; };
patDec.onclick = ()=> { if(+patVal.textContent > 0) patVal.textContent = (+patVal.textContent)-1; };
cheInc.onclick = ()=> { if(+cheVal.textContent < 3) cheVal.textContent = (+cheVal.textContent)+1; };
cheDec.onclick = ()=> { if(+cheVal.textContent > 0) cheVal.textContent = (+cheVal.textContent)-1; };

btnCancel.onclick = closeCustomize;

btnAdd.onclick = ()=>{
  // Validar papas
  const friesEl = document.querySelector('input[name="modFries"]:checked');
  if(!friesEl){ alert("Elegí una opción de papas."); return; }
  const fries = friesEl.value;

  const qty = +qtyVal.textContent || 1;
  const extras = { patty:0, cheddar:0 };
  if(currentItem.kind==="double"){ extras.patty=+patVal.textContent||0; extras.cheddar=+cheVal.textContent||0; }
  else if(currentItem.kind==="chicken"){ extras.patty=0; extras.cheddar=+cheVal.textContent||0; }
  const txt = notes.value.trim();

  const bucket = cart.burger || (cart.burger={});
  const prev = bucket[currentItem.id];
  if(prev){
    // si ya estaba, sumo qty
    prev.qty += qty;
    // al combinar, preservo el máximo de extras (criterio simple)
    prev.extras = {
      patty: Math.max(prev.extras?.patty||0, extras.patty),
      cheddar: Math.max(prev.extras?.cheddar||0, extras.cheddar)
    };
    prev.fries = fries; // la última elección
    if(txt) prev.notes = txt;
  }else{
    bucket[currentItem.id] = { qty, item: currentItem, extras, fries, ...(txt?{notes:txt}:{}) };
  }
  saveCart(); renderCart(); closeCustomize();
  toast('Producto agregado'); // CAMBIO: feedback sin abrir carrito
};

/* ================== DRINKS QUICK ================== */
function quickAddDrink(item){
  const bucket = cart.drink || (cart.drink={});
  if(!bucket[item.id]) bucket[item.id] = { qty:0, item };
  bucket[item.id].qty += 1;
  saveCart(); renderCart();
  toast('Producto agregado'); // CAMBIO: feedback sin abrir carrito
}

/* ================== TOAST ================== */
function toast(msg){
  const t=document.createElement('div');
  t.className='toast'; t.textContent=msg;
  document.body.appendChild(t);
  requestAnimationFrame(()=>{ t.style.transition='opacity .2s'; t.style.opacity=1; });
  setTimeout(()=>{ t.style.opacity=0; setTimeout(()=>t.remove(),200); }, 1300);
}

/* ================== INIT ================== */
mount();
</script>
</body>
</html>
